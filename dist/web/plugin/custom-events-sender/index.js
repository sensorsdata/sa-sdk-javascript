(window.SensorsDataWebJSSDKPlugin=window.SensorsDataWebJSSDKPlugin||{}).CustomEventsSender=function(){"use strict";function n(n,t,r){if(t&&(n.plugin_name=t),r&&n.init){var i=n.init;n.init=function(a,o){function u(){i.call(n,a,o)}return e(a,n,t),a.readyState&&a.readyState.state>=3||!a.on?u():void a.on(r,u)}}return n}function e(n,e,t){function r(e,r){n.logger?n.logger.msg.apply(n.logger,r).module(t+""||"").level(e).log():n.log&&n.log.apply(n,r)}e.log=function(){r("log",arguments)},e.warn=function(){r("warn",arguments)},e.error=function(){r("error",arguments)}}function t(e,t,r){return n(e,t,r),e.plugin_version=s,e}function r(n){var e=[];return u.each(n,function(n){u.isArray(n)?e=e.concat(r(n)):e.push(u.optimizeServerUrl(n))}),e}function i(n,e){e=u.isArray(e)?e:[e];var t=!1;return u.isArray(n)?u.each(n,function(n){u.indexOf(e,n)>-1&&(t=!0)}):u.indexOf(e,n)>-1&&(t=!0),t}function a(n,e){var t=o.kit.encodeTrackData(e);return n.indexOf("?")!==-1?n+"&"+t:n+"?"+t}var o,u,l,s="1.27.10",c={hookFn:null,init:function(n){this.hookFn=n,o.registerInterceptor("sendDataStage",{send:{priority:20,entry:function(n,e){return c.sendData(n,e),n}}})},sendData:function(n,e){var t=n.origin_data,a=t.event,o=n.server_url,l=n.callback,s=this,c=this.hookFn({event_name:a,data:u.extend2Lev({identities:{},lib:{},properties:{}},t),server_url:o});return u.isArray(c)&&c.length?(c=r(c),i(o,c)?l=null:e.cancellationToken.stop(),u.each(c,function(e){if(e&&""!==e&&!i(e,o)){var r=function(e){return function(){s.sendCall({server_url:e,origin_data:t,data:n.data,config:null,callback:l}),l=null,n.callback=null}}(e);setTimeout(r)}}),n):(u.isFunction(l)&&l(),e.cancellationToken.stop(),n)},getInstance:function(n){return"beacon"===o.para.send_type&&u.isSupportBeaconSend()?(n.data=a(n.server_url,n.origin_data),new u.BeaconSend(n)):"ajax"===o.para.send_type&&u.isSupportCors()?(n.data=a(n.server_url,n.origin_data),new u.AjaxSend(n)):(n.origin_data._flush_time=(new Date).getTime(),n.data=a(n.server_url,n.origin_data),new u.ImageSend(n))},sendCall:function(n){var e=this.getInstance(n);e.start()}},d={plugin_name:"CustomEventsSender",init:function(n,e){if(o=n,u=o._,l=o&&o.log||console&&console.log||function(){},u.isFunction(e)){if(o.readyState&&o.readyState.state>=3||!o.on)return c.init(e);o.on("sdkAfterInitPara",function(){c.init(e)})}else l("CustomEventsSender init failed\uff0chookFn error. hookFn:",e)}},f=t(d);return f}();