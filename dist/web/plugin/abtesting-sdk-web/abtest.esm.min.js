var _={};function VerifyStore(e){this.SensorsABTest=e}function Mask(e){this.attr_name="sa-abtest-"+e,this.remove_timer=null,this.is_added=!1,this.is_abort=!1,this.is_timeout=!1,this.style_element=null,this.createMaskStyle()}function initUtility(e){e._.extend(_,e._)}function NormalStore(e){this.SensorsABTest=e,this.para=e.para}function BridgeStore(e){this.SensorsABTest=e,this.para=e.para}function EventInterceptor(e){this.sd=e.sd,this.abTest=e,this.events=[],this.isStart=!1,this.pause_sdk_before_trigger=!1}function Link(e){this.SensorsABTest=e,this.isFirst=!0,this.start_time=null,this.mask_instance=null,this.is_filtered_out=!1,this.para={timeout:500,use_mask:!0,pass_params:!0,control_link_search:"default",experiment_link_search:"default",pause_sdk_before_trigger:!1}}function validateProject(){if(!window.name)return!1;try{var e=JSON.parse(decodeURIComponent(window.name||"")),t=e.is_vabtesting,s=e.source_url,i=e.link_match_type;return!(!0!==t||!_.checkUrlIsMatch(s,i))||(_.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(r){return!1}}function removeElement(e){if(e)try{_.isString(e)&&(e=_.getDomBySelector(e)),e.parentNode&&e.parentNode.removeChild(e)}catch(t){_.logger.log("delete dom error:",t)}}function getDomIndex(e){if(!e.parentNode)return-1;for(var t=0,s=e.tagName,i=e.parentNode.children,r=0;r<i.length;r++)if(i[r].tagName===s){if(e===i[r])return t;t++}return-1}function selector(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:getDomIndex(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~t?":nth-of-type("+(t+1)+")":"")}function getDomSelector(e,t){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var s=e.nodeName.toLowerCase();return e&&"body"!==s&&1==e.nodeType?(t.unshift(selector(e)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?t.join(" > "):getDomSelector(e.parentNode,t)):(t.unshift("body"),t.join(" > "))}function getElementPostion(e){var t=e.getBoundingClientRect(),s=t.top+(document.body.scrollTop||document.documentElement.scrollTop),i=t.left+(document.body.scrollLeft||document.documentElement.scrollLeft),r=_.ry(e).getStyle("z-index")||0;return{width:t.width,height:t.height,top:s,left:i,zIndex:r}}function getElementStyles(e,t){var s={};return _.each(t||[],function(t){var i=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});s[t]=_.ry(e).getStyle(i)}),s}function getElementText(e){var t=e.childNodes,s="",i=!1;return _.each(t,function(e){if(!1===i&&3===e.nodeType){var t=e.textContent||e.innerText||e.nodeValue||"";t&&(s=_.trim(t),i=!0)}}),s}function rgbaToRgb(e){var t=e.match(/[\d.]+/g);return t.length>=3?"rgb("+t[0]+","+t[1]+","+t[2]+")":""}function changeStyle(e,t,s){var i=_.getUA(),r=i.ie&&i.ie<9,n="";_.each(t,function(e,t){r&&e.indexOf("rgba")>-1&&(e=rgbaToRgb(e));var s=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});n+=s+": "+e+" !important;"}),""!==n&&(addStyleToHead({attr_value:s=_.encodeSelector(s),text:n="[sensors_ab_ele_style_id="+s+"]{"+n+"}",attr_key:"sensors_ab_ele_style_id"}),e.setAttribute("sensors_ab_ele_style_id",s))}function changeText(e,t){var s=e.tagName;getElementText(e)!==t&&(e.textContent?e.textContent=t:e.innerText?e.innerText=t:e.innerHTML=t,"input"!==s&&"INPUT"!==s||(e.value=t||""))}function propsFilter(e,t){var s=e.originProps||{},i=t.originProps||{},r=s.attributes||{},n=i.attributes||{},a=!0;return s.text&&s.text!==i.text&&(a=!1),r&&_.each(["src","href","target","srcset"],function(e){r[e]&&r[e]!==n[e]&&(a=!1)}),a}function changeAttribute(e,t,s){e.setAttribute(t,s)}function getElementPropsByAttr(e,t){var s=t.originProps,i={attributes:{}},r=s.attributes;return _.each(r.style||{},function(t,s){i.attributes.style[s]=_.ry(e).getStyle(s)}),Object.hasOwnProperty.call(s,"text")&&(i.attributes.text=getElementText(e)),_.each(["src","href"],function(t){Object.hasOwnProperty.call(r,t)&&(i.attributes[t]=e[t])}),Object.hasOwnProperty.call(r,"target")&&(i.attributes.target=e.getAttribute("target")),i}function changeAttributes(e,t,s){s||(s=getElementPropsByAttr(e,t));var i=propsFilter(t,s);if(i){var r=t.props;_.isObject(r)&&setAttributes(e,r,t)}return i}function setAttributes(e,t,s){if(Object.hasOwnProperty.call(t,"attributes")){var i=t.attributes;Object.hasOwnProperty.call(i,"style")&&changeStyle(e,i.style,s.selector),_.each(["href","target","src","srcset"],function(t){i[t]&&e.getAttribute(t)!==i[t]&&changeAttribute(e,t,i[t])})}Object.hasOwnProperty.call(t,"text")&&"innerHtml"!==s.type&&changeText(e,t.text)}function addStyleToHead(e){try{var t=document.createElement("style");t.innerHTML=e.text,t.setAttribute(e.attr_key,e.attr_value),document.getElementsByTagName("head")[0].append(t)}catch(s){window.sensorsABTestModifyListener&&window.sensorsABTestModifyListener(e,s.stack||s.message)}}function addScriptToBody(e){try{var t=document.createElement("script");t.setAttribute(e.attr_key,e.attr_value),t.innerHTML="try{"+e.text+"}catch(e){ window.sensorsABTestModifyListener && window.sensorsABTestModifyListener("+JSON.stringify(e)+", e.stack || e.message) }",document.body.append(t)}catch(s){window.sensorsABTestModifyListener&&window.sensorsABTestModifyListener(e,s.stack||s.message)}}function loadVtesting(e,t){_.loadScript(_.extend({success:function(){},error:function(){},type:"js",url:e},t))}function addMutationObserver(e){var t=new(0,window.MutationObserver)(e);return t.observe(document.body,{childList:!0,subtree:!0}),t}function removeMutationObserver(e){e&&e.disconnect()}function getInfoByElement(e,t,s){var i=e.tagName.toLowerCase(),r=getElementStyles(e,t),n={selector:getDomSelector(e),originProps:{attributes:{style:r},text:getElementText(e),hasChildren:e.children.length>0},type:"text",tagName:i};"a"===i&&(n.originProps.attributes.href=e.href,e.getAttribute("target")&&(n.originProps.attributes.target=e.getAttribute("target")),n.type="link"),"img"===i&&(n.originProps.attributes.src=e.src,n.originProps.attributes.srcset=e.srcset,n.type="img"),e.hasAttribute("sensors_ab_widget")&&(n.type="innerHtml");var a=e.getAttribute("style");if(s)for(var o=0;o<s.length;o++){var c=s[o],l=e.getAttribute(c);n.originProps.attributes[c]||null===l||l===undefined||(n.originProps.attributes[c]=l)}return{originStyle:a,eleInfo:n,ele:e}}function restoreElement(e){var t=e.eleInfo,s=e.ele;if(s){var i=t.originProps;if(Object.hasOwnProperty.call(i,"attributes")){var r=i.attributes;restoreInsertionElement({attr_value:_.encodeSelector(t.selector),attr_key:"sensors_ab_ele_style_id",ele:s}),_.each(["href","target","src","srcset"],function(e){r[e]&&s.getAttribute(e)!==r[e]&&changeAttribute(s,e,r[e])})}Object.hasOwnProperty.call(i,"text")&&"innerHtml"!==t.type&&changeText(s,i.text)}}function restoreInsertionElement(e){var t=e.attr_value,s=e.attr_key,i=e.ele,r=document.querySelectorAll("["+s+"]");r&&r.length&&_.each(r,function(e){var i=e.getAttribute(s);e.parentElement&&(t===i||!t)&&["style","script"].indexOf(e.tagName.toLowerCase())>-1&&e.parentElement.removeChild(e)}),i&&s&&i.removeAttribute(s)}function addHtmlElement(e,t){var s=_.getDomBySelector(e.base),i=e.props.text,r=e.props.sensors_ab_widget,n=e.operation;if(!s)throw"VABTest: No base element";if(!s.parentNode)throw"base element parentNode not found";var a=document.createElement("font");if("text"===r&&(a.innerText=i),"html"===r&&(a.innerHTML=i),renderConfigAttrs(a,e,t),"BEFORE_INSERTION"===n)s.parentNode.insertBefore(a,s);else{if("AFTER_INSERTION"!==n)throw"operation not supported";s.nextSibling?s.parentNode.insertBefore(a,s.nextSibling):s.parentNode.appendChild(a)}return getDomSelector(a)}function updateHtmlElement(e,t){var s=e.selector,i=e.props.text,r="text"===e.props.sensors_ab_widget;const n=document.querySelector(s);if(!n)throw"element not found:"+s;r?n.innerText=i:n.innerHTML=i,renderConfigAttrs(n,e,t)}function renderInnerHtml(e,t,s){var i=null,r=null,n=_.getDomBySelector(e.selector)||document.querySelector&&document.querySelector(e.selector);if(n&&n.hasAttribute("sensors_ab_widget")){updateHtmlElement(e,t);var a=getElementPostion(document.querySelector(e.selector));s&&s.setSelectElePostion(a)}else{function o(){return i=addHtmlElement(e,t)}s?r=s.getModifiedEleSelectorsWhen(o):o()}return{selector:e.selector,addedEleSelector:i,updatedSelectors:r}}function renderConfigAttrs(e,t,s){if(s&&s.length)for(var i=0;i<s.length;i++)"text"!==s[i]&&t.props[s[i]]!==undefined&&e.setAttribute(s[i],t.props[s[i]]);if(!0===s)for(var r in t.props)"text"!==r&&e.setAttribute(r,t.props[r])}function Vabtesting(e){this.SensorsABTest=e,this.enable_visualize=!1,this.vabtest_url=location.protocol+"//static.sensorsdata.cn/sdk/plugin/vabtest/"+this.SensorsABTest.lib_version+"/vabtest.min.js",this.timeout=500,this.is_editor=!1,this.use_mask=!0,this.originData=[],this.visualExp=null,this.isFirst=!0,this.start_time=null,this.is_have_observer=!1,this.imgLoadingList=[],this.isTrigger=!1,this.isDomReady=!1,this.loadedImages=[],this.dynamicAddedElements=[]}function SensorsABTest(){this.lib_version="1.27.3",this.plugin_version="1.27.3",this.plugin_name="SensorsABTest",this.para={},this.default_para={url:"",path:"",project_key:"",timeout_milliseconds:3e3,update_interval:6e5,collect_bridge_status:!0,encrypt_cookie:!1},this.state={platform:"",storage:{name:"sawebjssdkabtest",latest_name:"sawebjssdkabtestlatest"}},this.bridgeState="",this.codeExpData={},this.results=[],this.out_list=[],this.triggerList={},this.outTriggerList={},this.default_track_config={trigger_switch:!0,property_set_switch:!1,trigger_content_ext:["abtest_experiment_version","abtest_experiment_result_id"]},this.track_config={},this.updateTime=null,this.sd=null,this.link=new Link(this),this.vabtest=new Vabtesting(this),this.normalStore=new NormalStore(this),this.bridgeStore=new BridgeStore(this),this.verifyStore=new _.VerifyStore(this)}function updateTriggerData(e,t){var s=[];_.isArray(e)&&_.each(e,function(t,s){_.isString(t)&&e.splice(s,1,{experiment_id:t})});var i=t.abtest_experiment_id;if(_.isString(i)){var r={experiment_id:i,group_id:t.abtest_experiment_group_id,result_id:t.abtest_experiment_result_id};if(e&&_.isArray(e)){var n=!1;_.each(e,function(t,s){t.experiment_id===i&&(e.splice(s,1,r),n=!0)}),n||e.push(r)}else e=[r];s=e}return s}function FetchData(e){this.SensorsABTest=e}function Store(e){this.SensorsABTest=e}function initSensorsABTest(e,t){return e?(this.sd=e,initUtility(e),_.isObject(t)?(_.localStorage.isSupport()||this.log("localstorage\u5f02\u5e38"),this.abtestingPara=t,this.fetchData=new FetchData(this),this.store=new Store(this),void this.initTest()):(this.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684\u521d\u59cb\u5316\u53c2\u6570!para:",t),!1)):(this.log("A/B Testing \u521d\u59cb\u5316\u5931\u8d25,Web JS SDK \u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1)}_.secCheck={isHttpUrl:function(e){if("string"!=typeof e)return!1;return!1!==/^https?:\/\/.+/.test(e)||(_.log("Invalid URL"),!1)},removeScriptProtocol:function(e){if("string"!=typeof e)return"";for(var t=/^\s*javascript/i;t.test(e);)e=e.replace(t,"");return e}},_.checkUrlIsMatch=function(e,t){var s,i,r=_.URL(e);if("STRICT"===t)return location.href===r.href;if("FUZZY"===t){try{s=_.URL(location.href)}catch(n){return _.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{i=_.URL(e)}catch(n){return _.log("control_url \u89e3\u6790\u5931\u8d25",n),!1}return s.host===i.host&&s.pathname===i.pathname}return _.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",t),!1},_.checkUrlIsRegexp=function(e,t){var s;try{s=_.URL(location.href)}catch(i){return _.log("url \u89e3\u6790\u5931\u8d25",i),!1}try{return!!(t?new RegExp(e,t):new RegExp(e)).exec(s.href)}catch(i){return _.log("control_link\u5b57\u6bb5\u5f02\u5e38",i),!1}},_.log=function(){if("object"==typeof console&&console.log){_.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}},_.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(e){console.error(arguments[0])}},_.encodeSelector=function(e){return _.base64Encode(e).replace(/[+\/=]/g,function(e){return"_"})},VerifyStore.prototype={value_type_list:["Number","String","Object","Boolean"],regName:/^((?!^distinct_id$|^original_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_tag.*|^user_group.*)[a-zA-Z_][a-zA-Z\d_]*)$/i,valueType:function(e,t){switch(t){case"Number":if(_.isNumber(e))return!0;break;case"String":if(_.isString(e))return!0;break;case"Object":if(_.isObject(e))return!0;break;case"Boolean":if(!0===e||!1===e)return!0;break;default:return!1}return!1},para:function(e,t,s){var i=this,r={verify_success:!0,para:null};return _.each(s,function(s,n){if("essential"===s)switch(n){case"param_name":_.isString(t.param_name)&&t.param_name.length>0||(i.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",t.param_name),r.verify_success=!1);break;case"value_type":_.isString(t.value_type)&&-1!==_.indexOf(i.value_type_list,t.value_type)||(i.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",t.value_type),r.verify_success=!1);break;case"default_value":"undefined"==typeof t.default_value?(i.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),r.verify_success=!1):i.valueType(t.default_value,t.value_type)||(i.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",t.default_value,t.value_type),r.verify_success=!1);break;case"callback":_.isFunction(t.callback)||(i.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),r.verify_success=!1);break;default:r.verify_success=!1}else if("not_essential"===s)switch(n){case"timeout_milliseconds":t.timeout_milliseconds=t.timeout_milliseconds||i.SensorsABTest.para.timeout_milliseconds||i.SensorsABTest.default_para.timeout_milliseconds,(!_.isNumber(t.timeout_milliseconds)||_.isNumber(t.timeout_milliseconds)&&t.timeout_milliseconds<=0)&&(i.SensorsABTest.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",t.timeout_milliseconds),t.timeout_milliseconds=i.SensorsABTest.para.timeout_milliseconds),t.timeout_milliseconds<200&&(t.timeout_milliseconds=200);break;case"properties":t.properties=_.isObject(t.properties)?t.properties:{}}}),r.para=t,r},resolveCustomProperties:function(e){var t=this,s={verify_success:!0,para:null},i=e.custom_properties;if(!_.isObject(i)||_.isEmptyObject(i))return delete e.custom_properties,s.para=e,s;if(_.each(i,function(e,i){if((!_.isString(i)||!t.regName.test(i)||i.length>100)&&(t.SensorsABTest.log(" property name [ "+i+" ] is not invalid "),s.verify_success=!1),(_.isString(e)||_.isNumber(e)||_.isBoolean(e)||_.isArray(e)||_.isDate(e))&&!(_.isString(e)&&e.length>500)||(t.SensorsABTest.log("property [ "+i+" ] of value [ "+JSON.stringify(e)+" ] is not invalid"),s.verify_success=!1),_.isArray(e)){var r=!0;_.each(e,function(e){!1!==r&&(_.isString(e)||(r=!1))}),r||(t.SensorsABTest.log("property  value type can be array, but only allow string item. property [ "+i+" ] of value  "+JSON.stringify(e)+"  is not invalid"),s.verify_success=!1)}}),!0===s.verify_success){var r={};_.each(i,function(e,t){_.isDate(e)?r[t]=_.formatDate(e):_.isString(e)?r[t]=e:r[t]=JSON.stringify(e)}),e.custom_properties=r}return s.para=e,s}},_.VerifyStore=VerifyStore,_.listenPageState=function(e){({visibleHandle:_.isFunction(e.visible)?e.visible:function(){},hiddenHandler:_.isFunction(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(e.visibilityChange,function(){document[e.hidden]?e.hiddenHandler():e.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}}).init()},_.listenPageState=function(e){({visibleHandle:_.isFunction(e.visible)?e.visible:function(){},hiddenHandler:_.isFunction(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(e.visibilityChange,function(){document[e.hidden]?e.hiddenHandler():e.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}}).init()},_.getStorageData=function(e,t){var s=_.localStorage.get(e);_.isString(s)&&(s=t.kit.userDecryptIfNeeded(s));try{s=JSON.parse(s)}catch(i){_.log(i)}return s},_.setStorageData=function(e,t,s){e=JSON.stringify(e),s&&(e=_.userEncrypt(e)),_.localStorage.set(t,e)},Mask.prototype={createMaskStyle:function(){var e="["+this.attr_name+"],["+this.attr_name+"] body{opacity:0 !important;-khtml-opacity:0 !important;-moz-opacity:0;filter:alpha(opacity=0);}",t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e))}catch(s){t.styleSheet.cssText=e}try{this.style_element=t,document.getElementsByTagName("head")[0].appendChild(t)}catch(s){_.log("error when create calls")}},show:function(e){try{var t=this;if(this.is_abort)return!1;var s=null;if(s=document.getElementsByTagName("html")[0],!_.isElement(s))return;s.setAttribute(this.attr_name,"1"),this.is_added=!0,_.isNumber(e)&&(this.remove_timer=setTimeout(function(){t.is_timeout=!0,t.remove()},e))}catch(i){_.log("error when show calls")}},remove:function(){try{if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var e=null;if(e=document.getElementsByTagName("html")[0],!_.isElement(e))return;e.removeAttribute(this.attr_name),this.style_element&&(document.getElementsByTagName("head")[0].removeChild(this.style_element),this.style_element=null)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null)}catch(t){_.log("error when remove calls")}}},_.Mask=Mask,NormalStore.prototype={init:function(e){if(!this.setPara(e))return!1;this.bridgeState="ab_no_host_bridge",/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?this.SensorsABTest.state.platform="H5":this.SensorsABTest.state.platform="Web",this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f\uff0c\u8bd5\u9a8c URL\uff1a",e.url),this.SensorsABTest.checkSADebug(),this.SensorsABTest.store.init(this.getResultFromServer,this)},setPara:function(e){if(!_.isString(e.url)||"http"!==e.url.slice(0,4))return this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;if("https"===location.protocol.slice(0,5)&&"http:"===e.url.slice(0,5))return this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0chttps \u9875\u9762\u5fc5\u987b\u4f7f\u7528 https \u7684 URL"),!1;var t=_.getQueryParam(e.url,"project-key");if(!t)return this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1;e.project_key=t;var s=this.SensorsABTest.verifyStore.para("A/B Testing SDK \u521d\u59cb\u5316",e,{timeout_milliseconds:"not_essential"});return this.SensorsABTest.para=_.extend({},this.SensorsABTest.default_para,s.para),_.isBoolean(this.SensorsABTest.para.collect_bridge_status)||(this.SensorsABTest.para.collect_bridge_status=!0),_.isNumber(this.SensorsABTest.para.update_interval)||(this.SensorsABTest.para.update_interval=6e5),!0===this.SensorsABTest.sd.para.encrypt_cookie&&(this.SensorsABTest.para.encrypt_cookie=!0),this.SensorsABTest.sd.para.sdk_id&&(this.SensorsABTest.state.storage.name+="_"+this.SensorsABTest.sd.para.sdk_id),!0},asyncFetch:function(e){var t=this;this.SensorsABTest.normalStore.getCodeExpResultFromServer({para:e,suc:function(s){if(_.isObject(s)&&"SUCCESS"===s.status){var i=t.SensorsABTest.getExpResult(e);e.callback(i)}else e.callback(e.default_value)},err:function(){e.callback(e.default_value)}})},creatRequestData:function(e){var t="";_.isEmptyObject(this.SensorsABTest.sd.store._state)||(t=this.SensorsABTest.sd.store._state._first_id||this.SensorsABTest.sd.store._state.first_id||this.SensorsABTest.sd.store._state._distinct_id||this.SensorsABTest.sd.store._state.distinct_id);var s={anonymous_id:t,platform:this.SensorsABTest.state.platform,abtest_lib_version:this.SensorsABTest.lib_version,properties:{$is_first_day:this.SensorsABTest.sd._.cookie.getNewUser()}};return _.isObject(e.properties)&&(s.properties=_.extend({},s.properties,e.properties)),_.isObject(e.custom_properties)&&(s.custom_properties=_.extend({},e.custom_properties),s.param_name=e.param_name),this.SensorsABTest.sd.store._state.first_id&&(s.login_id=this.SensorsABTest.sd.store.getDistinctId()),s},getCodeExpResultFromServer:function(e){this.getResultFromServer(e,!0)},getResultFromServer:function(e,t){var s=this,i=(e=_.isObject(e)?e:{}).para||{};i.custom_properties=t?_.extend({},this.SensorsABTest.abtestingPara.custom_properties,i.custom_properties):this.SensorsABTest.abtestingPara.custom_properties;var r,n=e.suc,a=e.err,o=this.creatRequestData(i);this.SensorsABTest.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),r=s.SensorsABTest.sd.store.getDistinctId(),s.SensorsABTest.sd._.ajax({url:s.SensorsABTest.para.url,type:"POST",data:JSON.stringify(o),credentials:!1,contentType:"application/json",timeout:i.timeout_milliseconds||s.SensorsABTest.para.timeout_milliseconds,cors:!0,success:function(e){t?s.SensorsABTest.dealCodeExpResponseData(e,r):s.SensorsABTest.dealResponseData(e,r),n&&n(e),s.SensorsABTest.fetchData.setNextFetch()},error:function(e){s.SensorsABTest.log("\u670d\u52a1\u7aef\u8bf7\u6c42\u53d1\u9001\u5931\u8d25",e),a&&a(),s.SensorsABTest.fetchData.setNextFetch()}})}},NormalStore.prototype.methods={asyncFetchABTest:function(e){if(!_.isObject(e))return this.SensorsABTest.log("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=this.SensorsABTest.verifyStore.para("asyncFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(t.verify_success){e=t.para;var s=this.SensorsABTest.verifyStore.resolveCustomProperties(e);s.verify_success?(e=s.para,this.SensorsABTest.normalStore.asyncFetch(e)):e.callback(e.default_value)}},fastFetchABTest:function(e){if(!_.isObject(e))return this.SensorsABTest.log("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=this.SensorsABTest.verifyStore.para("fastFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(t.verify_success){e=t.para;var s=this.SensorsABTest.searchLocalExp(e.param_name);if(_.isObject(s)){var i=this.SensorsABTest.getExpResult(e,s);e.callback(i)}else{var r=this.SensorsABTest.verifyStore.resolveCustomProperties(e);r.verify_success?(e=r.para,this.SensorsABTest.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),this.SensorsABTest.normalStore.asyncFetch(e)):e.callback(e.default_value)}}},fetchCacheABTest:function(e){if(_.isObject(e)){var t=this.SensorsABTest.verifyStore.para("fetchCacheABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential"});if(t.verify_success)return this.SensorsABTest.getExpResult(t.para)}else this.SensorsABTest.log("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e")}},BridgeStore.prototype={init:function(e){var t=this;if(this.SensorsABTest.state.storage.name="sawebjssdkabtest_bridge",!this.setPara(e))return!1;this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f"),this.abBridge=new this.SensorsABTest.sd.JSBridge({type:"abtest",app_call_js:function(e){try{e=_.base64Decode(e)}catch(s){t.SensorsABTest.log("App\u6570\u636ebase64\u89e3\u7801\u5f02\u5e38",e)}try{(e=JSON.parse(e)).message_id&&this.double(e)}catch(s){t.SensorsABTest.log("App\u6570\u636e\u89e3\u6790\u5f02\u5e38",e)}}}),_.isObject(window.SensorsData_iOS_JS_Bridge)&&window.SensorsData_iOS_JS_Bridge.sensorsdata_abtest_module&&this.abBridge.hasAppBridge()?this.SensorsABTest.bridgeState="ab_bridge_ok":_.isObject(window.SensorsData_APP_New_H5_Bridge)&&_.isFunction(window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module)&&window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module()&&this.abBridge.hasAppBridge()?this.SensorsABTest.bridgeState="ab_bridge_ok":this.SensorsABTest.bridgeState="ab_no_abtest_bridge",this.SensorsABTest.store.init(this.getResultFromApp,this)},setPara:function(e){var t=this.SensorsABTest.verifyStore.para("\u6253\u901a\u521d\u59cb\u5316",e,{timeout_milliseconds:"not_essential"});return this.SensorsABTest.para=_.extend({},this.SensorsABTest.default_para,t.para),_.isBoolean(this.SensorsABTest.para.collect_bridge_status)||(this.SensorsABTest.para.collect_bridge_status=!0),_.isNumber(this.SensorsABTest.para.update_interval)||(this.SensorsABTest.para.update_interval=6e5),!0===this.SensorsABTest.sd.para.encrypt_cookie&&(this.SensorsABTest.para.encrypt_cookie=!0),this.SensorsABTest.sd.para.sdk_id&&(this.SensorsABTest.state.storage.name+="_"+this.SensorsABTest.sd.para.sdk_id),!0},getResultFromApp:function(e,t){var s=this,i=(e=_.isObject(e)?e:{}).para||{};i.custom_properties=t?_.extend({},this.SensorsABTest.abtestingPara.custom_properties,i.custom_properties):this.SensorsABTest.abtestingPara.custom_properties;var r=e.suc,n=e.err,a=i.timeout_milliseconds||this.SensorsABTest.para.timeout_milliseconds,o={origin_platform:"H5"};_.isObject(i.custom_properties)&&(o=_.extend(o,{custom_properties:i.custom_properties,param_name:i.param_name})),this.SensorsABTest.log("\u5411App\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),"ab_bridge_ok"===s.SensorsABTest.bridgeState?s.abBridge.requestToApp({data:{properties:i.properties,timeout:a,request_body:o},callback:function(e){_.isObject(e)&&_.isObject(e.data)?(s.SensorsABTest.log("\u6210\u529f\u83b7\u53d6\u5230 App \u7aef\u8fd4\u56de\u7684\u8bd5\u9a8c\u6570\u636e","data:",e),s.SensorsABTest.dealResponseData(e.data),r&&r(e)):(s.SensorsABTest.log("App \u7aef\u8bf7\u6c42\u5931\u8d25"),n&&n()),s.SensorsABTest.fetchData.setNextFetch()},timeout:{time:a,callback:function(){s.SensorsABTest.log("\u83b7\u53d6App\u7aef\u6570\u636e\u5931\u8d25"),n&&n(),s.SensorsABTest.fetchData.setNextFetch()}}}):n&&(s.SensorsABTest.log("A/B Testing \u6253\u901a\u5931\u8d25\uff0c",s.SensorsABTest.bridgeState),n())},asyncFetch:function(e){var t=this;this.SensorsABTest.bridgeStore.getResultFromApp({para:e,suc:function(s){if(_.isObject(s.properties)&&(e.properties=_.extend(s.properties,e.properties)),"SUCCESS"===s.data.status){var i=t.SensorsABTest.getExpResult(e);e.callback(i)}else e.callback(e.default_value)},err:function(){e.callback(e.default_value)}},!0)}},BridgeStore.prototype.methods={asyncFetchABTest:function(e){if(!_.isObject(e))return this.SensorsABTest.log("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=this.SensorsABTest.verifyStore.para("asyncFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(t.verify_success){e=t.para;var s=this.SensorsABTest.verifyStore.resolveCustomProperties(e);s.verify_success?(e=s.para,"ab_bridge_ok"===this.SensorsABTest.bridgeState?this.SensorsABTest.bridgeStore.asyncFetch(e):e.callback(e.default_value)):e.callback(e.default_value)}},fastFetchABTest:function(e){if(!_.isObject(e))return this.SensorsABTest.log("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var t=this.SensorsABTest.verifyStore.para("fastFetchABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(t.verify_success){e=t.para;var s=this.SensorsABTest.searchLocalExp(e.param_name);if(_.isObject(s)){var i=this.SensorsABTest.getExpResult(e,s);e.callback(i)}else{var r=this.SensorsABTest.verifyStore.resolveCustomProperties(e);r.verify_success?(e=r.para,"ab_bridge_ok"===this.SensorsABTest.bridgeState?(this.SensorsABTest.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),this.SensorsABTest.bridgeStore.asyncFetch(e)):e.callback(e.default_value)):e.callback(e.default_value)}}},fetchCacheABTest:function(e){if(_.isObject(e)){var t=this.SensorsABTest.verifyStore.para("fetchCacheABTest",e,{param_name:"essential",value_type:"essential",default_value:"essential"});if(t.verify_success)return this.SensorsABTest.getExpResult(t.para)}else this.SensorsABTest.log("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e")}},EventInterceptor.prototype.init=function(e){if(this.pause_sdk_before_trigger=e.pause_sdk_before_trigger||!1,!0===e.pause_sdk_before_trigger){var t=this;this.sd.registerInterceptor("sendDataStage",{send:{priority:0,entry:function(e,s){t.sendInterceptor(e,s)}}})}},EventInterceptor.prototype.start=function(){!1!==this.pause_sdk_before_trigger&&(this.events=[],this.isStart=!0)},EventInterceptor.prototype.stop=function(){if(!1!==this.pause_sdk_before_trigger){this.isStart=!1;var e=this;_.each(this.events,function(t){t._flush_time=(new Date).getTime(),e.sd.kit.sendData(t)}),this.events=[]}},EventInterceptor.prototype.sendInterceptor=function(e,t){var s=e.data,i=s.event,r=s.type;return!0===this.isStart&&"track"===r&&["$ABTestTrigger","WebABTestTrigger"].indexOf(i)<0&&(this.events.push(s),t.cancellationToken.stop()),e},Link.prototype.init=function(e){return this.initPara(e),this.para?(this.eventInterceptor=new EventInterceptor(this.SensorsABTest),this.eventInterceptor.init(this.para),this.eventInterceptor.start(),_.getQueryParam(location.href,"saSDKMultilink")?(this.is_filtered_out=!0,!1):(this.start_time=(new Date).getTime(),this.para.use_mask&&this.initMask(),void this.addSinglePageListener())):(this.SensorsABTest.log("multilink is closed"),!1)},Link.prototype.addSinglePageListener=function(){var e=this;this.SensorsABTest.sd.ee.spa.prepend("switch",function(t){return t!==location.href&&(e.is_filtered_out=!1,e.isFirst=!0,e.mask_instance&&e.mask_instance.remove(),_.getQueryParam(location.href,"saSDKMultilink")?(e.is_filtered_out=!0,!1):(e.eventInterceptor&&e.eventInterceptor.start(),e.start_time=(new Date).getTime(),e.para.use_mask&&e.initMask(),void e.resolve()))})},Link.prototype.initMask=function(){this.mask_instance=new _.Mask("link_"+this.SensorsABTest.sd.para.sdk_id),this.mask_instance.show(this.para.timeout)},Link.prototype.initPara=function(e){if(_.isFunction(e))try{e=e()}catch(t){return this.SensorsABTest.log("link para error!"),void(this.para=!1)}!1===e?this.para=!1:_.isObject(e)&&(this.para.timeout=_.isNumber(e.timeout)&&e.timeout>=0?e.timeout:500,this.para.use_mask=_.isBoolean(e.use_mask)?e.use_mask:this.para.use_mask,this.para.control_link_search=_.isString(e.control_link_search)?e.control_link_search:"default",this.para.experiment_link_search=_.isString(e.experiment_link_search)?e.experiment_link_search:"default",this.para.pass_params=!_.isBoolean(e.pass_params)||e.pass_params,this.para.onRedirect=_.isFunction(e.onRedirect)?e.onRedirect:null,this.para.pause_sdk_before_trigger=!!_.isBoolean(e.pause_sdk_before_trigger)&&e.pause_sdk_before_trigger)},Link.prototype.resolve=function(){var e=this.SensorsABTest.results,t=this;if(!this.para||!_.isArray(e)||this.is_filtered_out||!this.isFirst||0===this.para.timeout)return this.eventInterceptor&&this.eventInterceptor.stop(),!1;if((new Date).getTime()-this.start_time>this.para.timeout)return this.SensorsABTest.log("The multilink was stopped because the request timeout"),this.eventInterceptor&&this.eventInterceptor.stop(),!1;this.isFirst=!1;var s=!1;_.each(e,function(e){if(!_.isObject(e)||s||"LINK"!==e.experiment_type)return!1;t.isTriggerLinkExp(e)&&(s=!0,t.SensorsABTest.trackOutTestTrigger("LINK"),t.redirectUrl(e))}),!s&&this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),!s&&this.eventInterceptor&&this.eventInterceptor.stop()},Link.prototype.stopTrigger=function(){!1!==this.isFirst&&(this.isFirst=!1,this.SensorsABTest.log("The multilink was stopped because the request failed"),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),this.eventInterceptor&&this.eventInterceptor.stop())},Link.prototype.isTriggerLinkExp=function(e){return _.isString(e.control_link)&&_.isString(e.link_match_type)?"REGEXP"===e.link_match_type?!!_.checkUrlIsRegexp(e.control_link,e.regexp_flags)||(this.SensorsABTest.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):!!_.checkUrlIsMatch(e.control_link,e.link_match_type)||(this.SensorsABTest.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):(this.SensorsABTest.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",e.abtest_experiment_id),!1)},Link.prototype.redirectUrl=function(e){if(!e.experiment_link||!_.isString(e.experiment_link))return this.SensorsABTest.log("\u9875\u9762\u8df3\u8f6c\u5931\u8d25\uff0cexperiment_link\u5b57\u6bb5\u5f02\u5e38",e.abtest_experiment_id),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),void(this.eventInterceptor&&this.eventInterceptor.stop());if(!0===e.is_control_group&&("STRICT"===e.link_match_type||"REGEXP"===e.link_match_type))return this.SensorsABTest.triggerHandle(e),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),void(this.eventInterceptor&&this.eventInterceptor.stop());function t(e){return _.secCheck.isHttpUrl(e)?_.secCheck.removeScriptProtocol(e):(this.SensorsABTest.log("\u975e\u6cd5URL"),!1)}var s,i=location.href,r=e.experiment_link;if("REGEXP"===e.link_match_type&&/\$\d+/.test(r)){var n=e.regexp_flags?new RegExp(e.control_link,e.regexp_flags):new RegExp(e.control_link);r=i.replace(n,r)}if(s=this.para.pass_params?t(this.getMergedUrl(e.is_control_group,r,i)):t(this.getMergedUrl(e.is_control_group,r))){var a=this.SensorsABTest.triggerHandle(e)?80:0;this.para.onRedirect?(this.para.onRedirect(s),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove()):this.redirect(s,a),this.mask_instance&&this.mask_instance.remove_timer&&clearTimeout(this.mask_instance.remove_timer)}},Link.prototype.redirect=function(e,t){setTimeout(function(){location.href=e},t)},Link.prototype.getMergedUrl=function(e,t,s){var i="",r="",n="",a={parse_url:null,search:""},o={parse_url:null,search:"",hash:""};function c(e){var t=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(e);if(t)return{host:t[1]||"",search:t[2]||"",hash:t[3]||""}}if(!s||(a.parse_url=c(s),a.parse_url)){if(o.parse_url=c(t),o.parse_url)return s&&("after_hash"===this.para.control_link_search?a.search=l(a.parse_url.hash).search:a.search=a.parse_url.search),e?"after_hash"===this.para.control_link_search?(o.search=l(o.parse_url.hash).search,o.hash=l(o.parse_url.hash).hash):o.search=o.parse_url.search:"after_hash"===this.para.experiment_link_search?(o.search=l(o.parse_url.hash).search,o.hash=l(o.parse_url.hash).hash):o.search=o.parse_url.search,r=s?this.getSearchStr(a.search,o.search):this.getSearchStr(o.search),e&&"after_hash"===this.para.control_link_search||!e&&"after_hash"===this.para.experiment_link_search?i=o.hash.length>0?o.parse_url.host+o.parse_url.search+o.hash+r:o.parse_url.search.length>0?o.parse_url.host+o.parse_url.search+"&"+r.substring(1):o.parse_url.host+r:(n="after_hash"===this.para.control_link_search?o.parse_url.hash:s?o.parse_url.hash||a.parse_url.hash:o.parse_url.hash,i=o.parse_url.host+r+n),i;this.SensorsABTest.log("url \u89e3\u6790\u5931\u8d25",t)}else this.SensorsABTest.log("url \u89e3\u6790\u5931\u8d25",s);function l(e){var t={hash:"",search:""};if(!_.isString(e))return t;var s=e.indexOf("?");return s>-1?(t.search=e.slice(s),t.hash=e.slice(0,s)):t.hash=e,t}},Link.prototype.getSearchStr=function(e,t){var s=_.getQueryParamsFromUrl(e),i=_.getQueryParamsFromUrl(t),r=_.extend(s,i),n="";if(_.isEmptyObject(r))return"?saSDKMultilink=true";var a=!0;for(var o in r)a?(n+="?",a=!1):n+="&",null!==r[o]?n=n+o+"="+r[o]:n+=o;return n+"&saSDKMultilink=true"},window.MutationObserver||(window.MutationObserver=function(e){function t(e){this._watched=[],this._listener=e}function s(t){var s={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null};for(var i in t)d(s,i)&&t[i]!==e&&(s[i]=t[i]);return s}function i(t,i){var r=o(t,i);return function(n){var l,u=n.length;i.charData&&3===t.nodeType&&t.nodeValue!==r.charData&&n.push(new s({type:"characterData",target:t,oldValue:r.charData})),i.attr&&r.attr&&a(n,t,r.attr,i.afilter),(i.kids||i.descendents)&&(l=function(t,i,r,n){var o;function l(e,i,r,o,c){for(var l,h,_,p=e.length-1,d=-~((p-c)/2);_=e.pop();)l=r[_.i],h=o[_.j],n.kids&&d&&Math.abs(_.i-_.j)>=p&&(t.push(s({type:"childList",target:i,addedNodes:[l],removedNodes:[l],nextSibling:l.nextSibling,previousSibling:l.previousSibling})),d--),n.attr&&h.attr&&a(t,l,h.attr,n.afilter),n.charData&&3===l.nodeType&&l.nodeValue!==h.charData&&t.push(s({type:"characterData",target:l,oldValue:h.charData})),n.descendents&&u(l,h)}function u(i,r){for(var _,d,g,f,m,S,v,b=i.childNodes,y=r.kids,T=b.length,A=y?y.length:0,B=0,k=0,x=0;k<T||x<A;)S=b[k],m=y[x],v=m&&m.node,S===v?(n.attr&&m.attr&&a(t,S,m.attr,n.afilter),n.charData&&m.charData!==e&&S.nodeValue!==m.charData&&t.push(s({type:"characterData",target:S,oldValue:m.charData})),d&&l(d,i,b,y,B),n.descendents&&(S.childNodes.length||m.kids&&m.kids.length)&&u(S,m),k++,x++):(o=!0,_||(_={},d=[]),S&&(_[g=h(S)]||(_[g]=!0,-1===(f=c(y,S,x))?n.kids&&(t.push(s({type:"childList",target:i,addedNodes:[S],nextSibling:S.nextSibling,previousSibling:S.previousSibling})),B++):d.push({i:k,j:f})),k++),v&&v!==b[k]&&(_[g=h(v)]||(_[g]=!0,-1===(f=p(b,v,k))?n.kids&&(t.push(s({type:"childList",target:r.node,removedNodes:[v],nextSibling:y[x+1],previousSibling:y[x-1]})),B--):d.push({i:f,j:x})),x++));d&&l(d,i,b,y,B)}return u(i,r),o}(n,t,r,i)),(l||n.length!==u)&&(r=o(t,i))}}t._period=30,t.prototype={observe:function(e,s){for(var r,n={attr:!!(s.attributes||s.attributeFilter||s.attributeOldValue),kids:!!s.childList,descendents:!!s.subtree,charData:!(!s.characterData&&!s.characterDataOldValue)},a=this._watched,o=0;o<a.length;o++)a[o].tar===e&&a.splice(o,1);s.attributeFilter&&(n.afilter=_(s.attributeFilter,function(e,t){return e[t]=!0,e},{})),a.push({tar:e,fn:i(e,n)}),this._timeout||(r=this,function c(){var e=r.takeRecords();e.length&&r._listener(e,r),r._timeout=setTimeout(c,t._period)}())},takeRecords:function(){for(var e=[],t=this._watched,s=0;s<t.length;s++)t[s].fn(e);return e},disconnect:function(){this._watched=[],clearTimeout(this._timeout),this._timeout=null}};var r=document.createElement("i");r.style.top=0;var n=(r="null"!=r.attributes.style.value)?function(e,t){return t.value}:function(e,t){return"style"!==t.name?t.value:e.style.cssText};function a(e,t,i,r){for(var a,o,c={},l=t.attributes,u=l.length;u--;)o=(a=l[u]).name,r&&!d(r,o)||(n(t,a)!==i[o]&&e.push(s({type:"attributes",target:t,attributeName:o,oldValue:i[o],attributeNamespace:a.namespaceURI})),c[o]=!0);for(o in i)c[o]||e.push(s({target:t,type:"attributes",attributeName:o,oldValue:i[o]}))}function o(e,t){var s=!0;return function i(e){var r={node:e};return!t.charData||3!==e.nodeType&&8!==e.nodeType?(t.attr&&s&&1===e.nodeType&&(r.attr=_(e.attributes,function(s,i){return t.afilter&&!t.afilter[i.name]||(s[i.name]=n(e,i)),s},{})),s&&(t.kids||t.charData||t.attr&&t.descendents)&&(r.kids=function(e,t){for(var s=[],i=0;i<e.length;i++)s[i]=t(e[i],i,e);return s}(e.childNodes,i)),s=t.descendents):r.charData=e.nodeValue,r}(e)}function c(e,t,s){return p(e,t,s,"node")}var l=1,u="mo_id";function h(e){try{return e.id||(e[u]=e[u]||l++)}catch(t){try{return e.nodeValue}catch(s){return l++}}}function _(e,t,s){for(var i=0;i<e.length;i++)s=t(s,e[i],i,e);return s}function p(e,t,s,i){for(;s<e.length;s++)if((i?e[s][i]:e[s])===t)return s;return-1}function d(t,s){return t[s]!==e}return t}(void 0)),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),s=this,i=function(){},r=function(){return s.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r}),Vabtesting.prototype.init=function(e){var t=this;this.initPara(e),!1!==this.enable_visualize&&(window.self!==window.top&&validateProject()?(this.is_editor=!0,this.SensorsABTest.link.mask_instance&&this.SensorsABTest.link.mask_instance.remove(),document.getElementById("sa-abtesting-vabtest-script")||loadVtesting(this.vabtest_url,{id:"sa-abtesting-vabtest-script",success:function(){setTimeout(function(){t.SensorsABTest.sd.use("VABTest",{SensorsABTest:t.SensorsABTest})},0)}})):(this.start_time=(new Date).getTime(),this.use_mask&&this.initMask(),this.addSinglePageListener()))},Vabtesting.prototype.initPara=function(e){if(_.isFunction(e))try{e=e()}catch(s){return this.SensorsABTest.log("ABTesting SDK  !"),void(this.para=!1)}if(_.isObject(e)){Object.prototype.hasOwnProperty.call(e,"enable_visualize")&&_.isBoolean(e.enable_visualize)?this.enable_visualize=e.enable_visualize:this.SensorsABTest.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 enable_visualize \u683c\u5f0f\u4e0d\u6b63\u786e\u3002 \u7c7b\u578b\u5e94\u4e3a Boolean"),this.use_mask=_.isBoolean(e.use_mask)?e.use_mask:this.use_mask,this.timeout=_.isNumber(e.timeout)&&e.timeout>=0?e.timeout:this.timeout;var t=_.isString(e.vabtest_url)?e.vabtest_url:"";t&&("https:"===location.protocol?"https:"===t.slice(0,6)?this.vabtest_url=t:this.SensorsABTest.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u534f\u8bae\u5934\u5e94\u8bbe\u7f6e\u4e3a https"):"http:"===t.slice(0,5)||"https:"===t.slice(0,6)?this.vabtest_url=t:this.SensorsABTest.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u5e94\u8bbe\u7f6e\u4e3a\u6709\u6548 URL"))}else this.para=!1},Vabtesting.prototype.resolve=function(){var e=this.SensorsABTest.results;if(!1!==this.enable_visualize&&!0!==this.is_editor&&!1!==this.isFirst){if((new Date).getTime()-this.start_time>this.timeout)return this.SensorsABTest.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),!1;var t=this;this.isFirst=!1;var s=!1;_.each(e,function(e){if(!_.isObject(e)||"VISUAL"!==e.experiment_type)return!1;if(s)return!1;var i=e.experiment_value;if(!_.isArray(i))try{i=JSON.parse(e.experiment_value),e.experiment_value=i}catch(r){return!1}t.isTriggerVisualExp(e)&&(s=!0,t.renderGlobalElement(e),t.prepareResource(e,t.render.bind(t)),t.visualExp=e,t.SensorsABTest.trackOutTestTrigger("VISUAL"))}),!s&&this.use_mask&&this.destroyMask()}},Vabtesting.prototype.initMask=function(){this.mask_instance=new _.Mask("vabtest_"+this.SensorsABTest.sd.para.sdk_id),this.mask_instance.show(this.timeout)},Vabtesting.prototype.destroyMask=function(){this.mask_instance&&this.mask_instance.remove()},Vabtesting.prototype.prepareResource=function(e,t){var s=this,i=e.experiment_value;_.isArray(i)&&(_.each(i,function(i){var r=i.tagName,n=i.props;function a(i,r){if(s.imgLoadingList.push(i),s.loadedImages.indexOf(i)>-1){var n=s.imgLoadingList.indexOf(i);return n>-1&&s.imgLoadingList.splice(n,1),void(0===s.imgLoadingList.length&&t(e))}function a(){var r=s.imgLoadingList.indexOf(i);s.loadedImages.push(i),r>-1&&s.imgLoadingList.splice(r,1),0===s.imgLoadingList.length&&t(e)}var o=document.createElement("img");o.width=1,o.height=1,o.onload=a,o.onerror=a,o.onabort=a,o[r]=i}"img"===r&&n&&n.attributes&&(_.isString(n.attributes.srcset)?a(n.attributes.srcset,"srcset"):_.isString(n.attributes.src)&&a(n.attributes.src,"src"))}),0===this.imgLoadingList.length&&t(e))},Vabtesting.prototype.render=function(e){this.removeDomChangeListener();var t=this,s=function(){if(t.isDomReady=!0,t.use_mask&&t.mask_instance&&!0===t.mask_instance.is_timeout)t.SensorsABTest.log("\u6e32\u67d3\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01");else{t.isTrigger||(t.SensorsABTest.triggerHandle(e),t.isTrigger=!0),_.isArray(t.originData)&&(_.each(t.originData,function(e){restoreElement(e)}),t.originData=[]),_.each(t.dynamicAddedElements,function(e){removeElement(e)}),t.dynamicAddedElements=[];var s=e.experiment_value;_.isArray(s)&&_.each(s,function(e){var s=e.selector,i=e.type;if("innerHtml"===e.type){var r=renderInnerHtml(e,!0,t.domEditor);r.addedEleSelector&&t.dynamicAddedElements.push(r.addedEleSele)}if("img"===i||"link"===i||"text"===i||"innerHtml"===i){var n=_.getDomBySelector(s);if(n)try{var a=getInfoByElement(n,[]);changeAttributes(n,e,a.eleInfo)&&t.originData.push(a)}catch(o){_.logger.log("render vabtest error")}}}),t.use_mask&&t.destroyMask(),t.addDomChangeListener()}};this.isDomReady?s():_.bindReady(s)},Vabtesting.prototype.restoreElements=function(){_.each(this.originData,function(e){restoreElement(e)}),_.each(this.dynamicAddedElements,function(e){removeElement(e)}),this.dynamicAddedElements=[],this.visualExp=null,this.isFirst=!0,this.start_time=(new Date).getTime(),this.originData=[],this.isTrigger=!1,restoreInsertionElement({attr_key:"sensors_ab_style_id"}),restoreInsertionElement({attr_key:"sensors_ab_script_id"})},Vabtesting.prototype.addDomChangeListener=function(){var e=this;_.bindReady(function(){e.isDomReady=!0,e.domChangeObserver=addMutationObserver(e.observerCallback.bind(e))})},Vabtesting.prototype.removeDomChangeListener=function(){removeMutationObserver(this.domChangeObserver),this.domChangeObserver=null},Vabtesting.prototype.addSinglePageListener=function(){var e=this;this.SensorsABTest.sd.ee.spa.on("switch",function(t){if(t===location.href)return!1;e.mask_instance&&e.destroyMask(),e.start_time=(new Date).getTime(),e.use_mask&&e.initMask(),e.restoreElements(),e.resolve()})},Vabtesting.prototype.observerCallback=function(){this.visualExp&&this.prepareResource(this.visualExp,this.render.bind(this))},Vabtesting.prototype.stopTrigger=function(){this.isFirst=!1,this.SensorsABTest.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u5931\u8d25\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),this.use_mask&&this.destroyMask()},Vabtesting.prototype.isTriggerVisualExp=function(e){return _.isString(e.control_link)&&_.isString(e.link_match_type)?!!_.checkUrlIsMatch(e.control_link,e.link_match_type)||(this.SensorsABTest.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",e.abtest_experiment_id),!1):(this.SensorsABTest.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",e.abtest_experiment_id),!1)},Vabtesting.prototype.renderGlobalElement=function(e){var t=e.experiment_value;_.isArray(t)&&_.each(t,function(e){switch(e.type){case"globalScript":_.bindReady(function(){addScriptToBody({attr_value:e.id,text:e.props.text,attr_key:"sensors_ab_script_id"})});break;case"globalStyle":addStyleToHead({attr_value:e.id,text:e.props.text,attr_key:"sensors_ab_style_id"})}})},SensorsABTest.prototype.asyncFetchABTest=function(){_.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},SensorsABTest.prototype.fastFetchABTest=function(){_.error("fastFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},SensorsABTest.prototype.fetchCacheABTest=function(){_.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},SensorsABTest.prototype.setCustomProperties=function(e){_.isObject(e)&&!_.isEmptyObject(e)&&(this.abtestingPara.custom_properties=e,this.fetchData&&this.fetchData.fetchNow&&this.fetchData.fetchNow())},SensorsABTest.prototype.searchLocalExp=function(e){return this.codeExpData[e]?this.codeExpData[e]:null},SensorsABTest.prototype.getExpResult=function(e,t){var s=e.default_value,i=t||this.searchLocalExp(e.param_name);return _.isObject(i)?_.isObject(i.js_config)&&(i.js_config.type===e.value_type?(s=i.js_config.value,this.triggerHandle(i,e)):this.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+e.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+i.js_config.type+"\uff0c\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+e.value_type)):this.log("localdata\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+e.param_name),this.trackOutTestTrigger("CODE",e),s},SensorsABTest.prototype.resolveVariables=function(){this.codeExpData={};var e=this,t=this.results;_.each(t,function(t){_.isObject(t)&&t.variables&&_.isArray(t.variables)&&_.each(t.variables,function(s){_.isObject(s)&&!e.codeExpData[s.name]&&(e.codeExpData[s.name]=_.extend({},t),e.codeExpData[s.name].js_config=e.getRelativeValue(s.value,s.type))})})},SensorsABTest.prototype.getRelativeValue=function(e,t){var s=this,i={},r={INTEGER:function(e){var t=parseFloat(e);isNaN(t)?s.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e):(i.value=t,i.type="Number")},STRING:function(e){_.isString(e)?(i.value=e,i.type="String"):s.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)},JSON:function(e){var t=JSON.parse(e);_.isObject(t)?(i.value=t,i.type="Object"):s.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)},BOOLEAN:function(e){"true"===e?(i.value=!0,i.type="Boolean"):"false"===e?(i.value=!1,i.type="Boolean"):s.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",e)}};try{r[t]?r[t](e):s.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",t,e)}catch(n){s.log(n,e,t)}return i},SensorsABTest.prototype.dealResponseData=function(e,t){_.isObject(e)?"SUCCESS"===e.status?_.isArray(e.results)&&(this.fetchData.updateExpsCache(e),this.updateLocalData(t)):"FAILED"===e.status&&this.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+e.error_type+",error\uff1a"+e.error):this.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",e)},SensorsABTest.prototype.dealCodeExpResponseData=function(e,t){_.isObject(e)?"SUCCESS"===e.status?_.isArray(e.results)&&(this.fetchData.updateExpsCache(e),this.updateCodeExpLocalData(t)):"FAILED"===e.status&&this.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+e.error_type+",error\uff1a"+e.error):this.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",e)},SensorsABTest.prototype.updateCodeExpLocalData=function(e){this.analyzeCodeExpData(),this.updateStorage(e),this.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},SensorsABTest.prototype.analyzeCodeExpData=function(){var e=this.results;if(!_.isArray(e))return this.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",e),!1;this.resolveVariables(),this.registerProperty()},SensorsABTest.prototype.updateLocalData=function(e){this.analyzeData(),this.updateStorage(e),this.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},SensorsABTest.prototype.updateStorage=function(e){var t=(new Date).getTime(),s={results:this.results,updateTime:t,triggerList:this.triggerList,distinct_id:e||this.sd.store.getDistinctId(),outTriggerList:this.outTriggerList,out_list:this.out_list,track_config:this.track_config},i=this.state.storage.name,r=this.para.encrypt_cookie;_.setStorageData(s,i,r),this.updateTime=t},SensorsABTest.prototype.analyzeData=function(){var e=this.results;if(!_.isArray(e))return this.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",e),!1;this.link.resolve(),this.vabtest.resolve(),this.resolveVariables(),this.registerProperty()},SensorsABTest.prototype.trackOutTestTrigger=function(e,t){var s=this.out_list,i=this,r=!1,n={};if(_.isArray(s)&&s.length>0&&(_.each(s,function(s){_.isObject(s)&&!r&&("CODE"===e?_.isObject(s)&&s.variables&&_.isArray(s.variables)&&_.each(s.variables,function(e){var a=i.getRelativeValue(e.value,e.type);!r&&a&&_.isObject(e)&&t.param_name===e.name&&a.type===t.value_type&&(r=!0,n=s)}):"LINK"===e?_.isString(s.control_link)&&_.isString(s.link_match_type)&&("REGEXP"===s.link_match_type?_.checkUrlIsRegexp(s.control_link,s.regexp_flags)&&(r=!0,n=s):_.checkUrlIsMatch(s.control_link,s.link_match_type)&&(r=!0,n=s)):"VISUAL"===e&&_.isString(s.control_link)&&_.isString(s.link_match_type)&&_.checkUrlIsMatch(s.control_link,s.link_match_type)&&(r=!0,n=s))}),r)){var a=i.sd.store.getDistinctId();n.subject_id&&n.subject_name&&(a=n.subject_name+n.subject_id),i.sendTriggerEvent("outTriggerList",a,n,{})}},SensorsABTest.prototype.registerProperty=function(){if(this.track_config.property_set_switch){var e=this.sd.store.getUnionId(),t=["USER"+(e.login_id||e.anonymous_id),"DEVICE"+e.anonymous_id],s=this.sd.bridge.is_verify_success?this.getLatestSubject():[],i=[],r=[];_.each(this.triggerList,function(e,r){t.indexOf(r)<0&&s.indexOf(r)<0||_.isArray(e)&&_.each(e,function(e){e.result_id&&i.push(e.result_id)})}),_.isArray(this.results)&&_.each(this.results,function(e){e.abtest_experiment_result_id&&r.push(e.abtest_experiment_result_id)}),i.length>0&&this.sd.registerPage({abtest_result:i}),r.length>0&&this.sd.registerPage({abtest_dispatch_result:r})}else this.sd.clearPageRegister(["abtest_result","abtest_dispatch_result"])},SensorsABTest.prototype.saveLatestSubject=function(e){var t=this.getLatestSubject()||[];t.indexOf(e)<0&&t.push(e);var s=this.state.storage.latest_name,i=this.para.encrypt_cookie;_.setStorageData(t,s,i)},SensorsABTest.prototype.getLatestSubject=function(){var e=this.state.storage.latest_name;return _.getStorageData(e,this.sd)||[]},SensorsABTest.prototype.triggerHandle=function(e,t){var s=this.sd.store.getDistinctId();return e.subject_id&&e.subject_name&&(s=e.subject_name+e.subject_id),this.sd.bridge.is_verify_success&&this.saveLatestSubject(s),this.trackTestTrigger(s,e,t)},SensorsABTest.prototype.getTriggerProps=function(e,t){var s={},i=_.isObject(t)&&_.isObject(t.properties)?t.properties:{};if("{}"!==JSON.stringify(this.triggerList)){var r="web_abtesting:"+this.lib_version;s.$lib_plugin_version=[r]}this.para.collect_bridge_status&&(s.$sdk_bridge_status=this.bridgeState);var n={$abtest_experiment_id:e.abtest_experiment_id,$abtest_experiment_group_id:e.abtest_experiment_group_id},a=this.track_config.trigger_content_ext;return _.each(a,function(t){void 0!==e[t]&&(s["$"+t]=e[t])}),s=_.extend(n,s,i)},SensorsABTest.prototype.sendTriggerEvent=function(e,t,s,i){var r=this.track_config.trigger_switch,n=!0,a=this[e];a&&_.isObject(a)&&a[t]&&_.each(a[t],function(e){e.experiment_id===s.abtest_experiment_id&&e.group_id===s.abtest_experiment_group_id&&e.result_id===s.abtest_experiment_result_id&&(n=!1)}),this[e][t]=updateTriggerData(a[t],s),this.updateStorage(),this.registerProperty();var o=this.getTriggerProps(s,i);return n&&r&&this.sd.track("$ABTestTrigger",o),n},SensorsABTest.prototype.trackTestTrigger=function(e,t,s){if(t.is_white_list)return!1;var i=this.sendTriggerEvent("triggerList",e,t,s),r=this.getTriggerProps(t,s);return this.sd.track("WebABTestTrigger",r),i},SensorsABTest.prototype.checkSADebug=function(){var e=this,t=_.getQueryParam(location.href,"sensors_abtest_url"),s=_.getQueryParam(location.href,"feature_code"),i=+_.getQueryParam(location.href,"account_id");if(t.length&&s.length&&_.isNumber(i)&&0!==i){var r={distinct_id:this.sd.store.getDistinctId(),feature_code:s,account_id:i};this.sd._.ajax({url:t,type:"POST",data:JSON.stringify(r),credentials:!1,contentType:"application/json",timeout:this.para.timeout_milliseconds,cors:!0,success:function(){},error:function(t){e.log("distinct_id\u53d1\u9001\u5931\u8d25,err:",t)}})}},SensorsABTest.prototype.initMethods=function(e){var t=this;_.each(["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"],function(s){t[s]=e.methods[s].bind(e)})},FetchData.prototype={timer:null,method:null,context:null,init:function(e,t){this.method=e,this.context=t,this.start(!0)},getServerData:function(e){var t=this;e?this.method.call(this.context,{suc:function(s){e&&("ab_bridge_ok"===t.SensorsABTest.bridgeState&&(s=s.data),_.isObject(s)&&"SUCCESS"===s.status&&_.isArray(s.results)||(t.SensorsABTest.link.stopTrigger(),t.SensorsABTest.vabtest.stopTrigger()))},err:function(){e&&(t.SensorsABTest.link.stopTrigger(),t.SensorsABTest.vabtest.stopTrigger())}}):this.method.call(this.context)},setNextFetch:function(e){var t=this,s=e||this.SensorsABTest.para.update_interval;this.clearFetchTimer(this.timer),this.timer=setTimeout(function(){t.getServerData()},s)},fetchNow:function(){this.clearFetchTimer(this.timer),this.getServerData()},updateExpsCache:function(e){this.SensorsABTest.results=e.results||e.data||[];var t=e.triggerList,s=e.out_list,i=e.outTriggerList;_.isArray(s)&&(this.SensorsABTest.out_list=s),_.isObject(t)&&(this.SensorsABTest.triggerList=e.triggerList),_.isObject(i)&&(this.SensorsABTest.outTriggerList=i),_.isObject(e.track_config)?this.SensorsABTest.track_config=e.track_config:this.SensorsABTest.track_config=this.SensorsABTest.default_track_config},clearExpsCache:function(){this.SensorsABTest.codeExpData={},this.SensorsABTest.results=[],this.SensorsABTest.out_list=[],this.SensorsABTest.track_config=this.SensorsABTest.default_track_config},start:function(e){var t=null,s=(new Date).getTime(),i=_.getStorageData(this.SensorsABTest.state.storage.name,this.SensorsABTest.sd),r=this.SensorsABTest.sd.store.getDistinctId();if(i&&_.isObject(i)&&i.distinct_id===r)if(t=i.updateTime,e&&this.updateExpsCache(i),t&&_.isNumber(t)&&s-t>0&&s-t<this.SensorsABTest.para.update_interval){e&&this.SensorsABTest.analyzeData(),this.SensorsABTest.log("\u6570\u636e\u4e0d\u66f4\u65b0",t,s);var n=s-t,a=this.SensorsABTest.para.update_interval-n;this.setNextFetch(a)}else this.SensorsABTest.log("\u7f13\u5b58\u6570\u636e\u8d85\u65f6",t,s),this.getServerData(e);else(t=this.SensorsABTest.updateTime)&&_.isNumber(t)&&s-t>0&&s-t<this.SensorsABTest.para.update_interval?this.SensorsABTest.log("\u6570\u636e\u4e0d\u66f4\u65b0",t,s):this.getServerData(e)},stop:function(){this.SensorsABTest.log("\u6e05\u7a7a\u62c9\u53d6\u5b9a\u65f6\u5668"),this.clearFetchTimer()},clearFetchTimer:function(){clearTimeout(this.timer),this.timer=null}},Store.prototype={init:function(e,t){var s=this;this.SensorsABTest.fetchData.init(e,t),this.SensorsABTest.initMethods(t),_.listenPageState({visible:function(){s.SensorsABTest.log("\u9875\u9762\u663e\u793a"),s.SensorsABTest.fetchData.start()},hidden:function(){s.SensorsABTest.fetchData.stop()}}),this.SensorsABTest.sd.events.on("changeDistinctId",function(){s.SensorsABTest.abtestingPara.custom_properties={},s.SensorsABTest.fetchData.clearExpsCache(),s.SensorsABTest.vabtest.restoreElements(),s.SensorsABTest.updateStorage(),s.SensorsABTest.fetchData.getServerData()}),this.SensorsABTest.sd.events.isReady()}},SensorsABTest.prototype.init=function(e,t){if(this.sd)return this.log("A/B Testing SDK \u91cd\u590d\u521d\u59cb\u5316\uff01\u53ea\u6709\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u6709\u6548\uff01"),!1;if(e.readyState&&e.readyState.state>=3||!e.on)initSensorsABTest.call(this,e,t);else{var s=this;e.on("sdkReady",function(){initSensorsABTest.call(s,e,t)})}},SensorsABTest.prototype.initTest=function(){this.link.init(this.abtestingPara.multilink),this.vabtest.init(this.abtestingPara.visualize),this.sd.bridge.is_verify_success?this.bridgeStore.init(this.abtestingPara):this.normalStore.init(this.abtestingPara),this.registerProperty()},SensorsABTest.prototype.log=function(){return _.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]),this.sd&&this.sd.log.apply(this,arguments)};var instance=new SensorsABTest;instance.__constructor__=SensorsABTest,window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SensorsABTest=window.SensorsDataWebJSSDKPlugin.SensorsABTest||instance:window.SensorsDataWebJSSDKPlugin={SensorsABTest:instance};export default SensorsABTest;