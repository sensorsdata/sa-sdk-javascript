!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var t,n,o=function(){function e(){var e=this;this.eventPool=new Map,this.on=function(t,n){var o=e.eventPool,r=o.get(t);r?o.set(t,[].concat(r,[n])):o.set(t,[n])},this.remove=function(t,n){var o=e.eventPool,r=o.get(t);if(r)return n?o.set(t,r.filter(function(e){return n!==e})):o["delete"](t)}}var t=e.prototype;return t.emit=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var r=this.eventPool.get(e);r&&r.forEach(function(e){e.apply(void 0,n)})},t.get=function(){var e;return(e=this.eventPool).get.apply(e,arguments)},t.has=function(){var e;return(e=this.eventPool).has.apply(e,arguments)},t["delete"]=function(){var e;return(e=this.eventPool)["delete"].apply(e,arguments)},t.forEach=function(){var e;return(e=this.eventPool).forEach.apply(e,arguments)},t.keys=function(){return this.eventPool.keys()},t.set=function(){var e;return(e=this.eventPool).set.apply(e,arguments)},e}();!function(e){e[e.connect=0]="connect",e[e.dispose=1]="dispose"}(t||(t={})),function(e){e.SUCCESS="SUCCESS",e.PENDING="PENDING",e.ERROR="ERROR",e.TIMEOUT="TIMEOUT"}(n||(n={}));var r,i,s,a,l,c=(r=(new Date).getTime(),function(e){return Math.ceil((r=(9301*r+49297)%233280)/233280*e)}),u=function(e,t){return function(){if("function"==typeof Uint32Array){var e="";if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof msCrypto&&(e=msCrypto),"object"==typeof e&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/Math.pow(2,32)}}return c(1e19)/1e19}()*(t-e)+e},d=function(){function t(r){var i=this;this.iframe=void 0,this.ENV="IFRAME",this.config={source:"",frameSource:""},this.context=void 0,this.messagePool=new o,this.receiveMessageHandle=function(o){var r=t.MessageDecode(null==o?void 0:o.data);if(i.config.debug&&console.log("[@FrameBridge:"+i.ENV+" receiveMessage type:"+(null==r?void 0:r.type)+" id:"+(null==r?void 0:r.$id)+" ]=>",r),null!=r&&r.$id){var s=r.$id,a=void 0===s?"":s,l=r.type,c=void 0===l?"":l;if(r.source===i.config.frameSource){var u=i.messagePool.has(a),d=i.messagePool.has(c);u&&i.messagePool.emit(a,{status:n.SUCCESS,payload:r}),d&&i.messagePool.emit(c,e({},r,{status:n.SUCCESS}))}}},this.iframeLoadHandle=function(){var e;(null==(e=i.iframe)?void 0:e.contentWindow)&&console.log("load success")},this.config=r,this.init()}t.MessageEncode=function(e,t){void 0===e&&(e={}),void 0===t&&(t=JSON.stringify({}));var n=t;try{n=encodeURIComponent(JSON.stringify(e))}catch(o){console.error("[@FrameBridge:error] MessageDecode error",o)}return n},t.MessageDecode=function(e,t){void 0===t&&(t=null);var n=t;try{n=JSON.parse(decodeURIComponent(e||""))}catch(o){n=t,console.warn("@FrameBridge MessageDecode error",o)}return n};var r=t.prototype;return r.emit=function(e,o,r){var i,s,a=this,l=(r||{}).timeout,c=void 0===l?51e3:l,d=this.config.source,h=function(e){return void 0===e&&(e=""),e+"@"+Date.now()+"@"+u(0,10)}(this.ENV),m={$id:h,type:e,status:n.PENDING,payload:o,source:d};"IFRAME"===this.ENV?this.context=null==(i=window)?void 0:i.parent:this.context=null==(s=this.iframe)?void 0:s.contentWindow;return this.context?new Promise(function(e){var o,r;a.messagePool.on(h,function(t){e(t),a.messagePool.remove(h)}),c&&setTimeout(function(){a.messagePool.has(h)&&a.messagePool.emit(h,{status:n.TIMEOUT})},c),a.config.debug&&console.log("[@FrameBridge:"+a.ENV+" emit] => ",m),null==(o=a.context)||o.postMessage(t.MessageEncode(m),(null==(r=a.config)?void 0:r.origin)||"*")}):Promise.resolve({status:n.ERROR,message:"No communication environment,Please check config!"})},r.on=function(e,t){var n=this;this.messagePool.on(e,function(e){var o=e.$id;return t({reply:function(e){n.emit(o,e)}},e,n.config)})},r.destroy=function(){var e;window.removeEventListener("message",this.receiveMessageHandle),null==this||null==(e=this.iframe)||null==e.removeEventListener||e.removeEventListener("load",this.iframeLoadHandle)},r.init=function(){var e,t=this.config.container;if(t){this.ENV="CONTAINER";var n="string"===((e=t)===undefined?"undefined":null===e?"null":e.constructor.name.toLowerCase())?document.querySelector(t):t;if(this.iframe=n,!(n&&n instanceof HTMLIFrameElement))return console.error("[@FrameBridge:error]container is not IFRAME element!"),this;n.addEventListener("load",this.iframeLoadHandle)}else this.ENV="IFRAME";window.addEventListener("message",this.receiveMessageHandle,!1)},t}();!function(e){e.address="address",e.article="article",e.aside="aside",e.footer="footer",e.header="header",e.h1="h1",e.h2="h2",e.h3="h3",e.h4="h4",e.h5="h5",e.h6="h6",e.main="main",e.nav="nav",e.section="section",e.blockquote="blockquote",e.dd="dd",e.div="div",e.dl="dl",e.dt="dt",e.figcaption="figcaption",e.figure="figure",e.hr="hr",e.li="li",e.ol="ol",e.p="p",e.pre="pre",e.ul="ul",e.a="a",e.abbr="abbr",e.b="b",e.bdi="bdi",e.bdo="bdo",e.br="br",e.cite="cite",e.code="code",e.data="data",e.dfn="dfn",e.em="em",e.i="i",e.kbd="kbd",e.mark="mark",e.q="q",e.rp="rp",e.rt="rt",e.ruby="ruby",e.s="s",e.samp="samp",e.small="small",e.span="span",e.strong="strong",e.sub="sub",e.sup="sup",e.time="time",e.u="u",e["var"]="var",e.wbr="wbr",e.img="img",e.area="area",e.audio="audio",e.base="base",e.body="body",e.button="button",e.canvas="canvas",e.caption="caption",e.col="col",e.colgroup="colgroup",e.datalist="datalist",e.del="del",e.details="details",e.dialog="dialog",e.embed="embed",e.fieldset="fieldset",e.form="form",e.head="head",e.hgroup="hgroup",e.html="html",e.iframe="iframe",e.input="input",e.ins="ins",e.label="label",e.legend="legend",e.link="link",e.map="map",e.math="math",e.menu="menu",e.menuitem="menuitem",e.meta="meta",e.meter="meter",e.noscript="noscript",e.object="object",e.optgroup="optgroup",e.option="option",e.output="output",e.param="param",e.picture="picture",e.progress="progress",e.rb="rb",e.rtc="rtc",e.script="script",e.select="select",e.slot="slot",e.source="source",e.style="style",e.summary="summary",e.svg="svg",e.table="table",e.tbody="tbody",e.td="td",e.template="template",e.textarea="textarea",e.tfoot="tfoot",e.th="th",e.thead="thead",e.title="title",e.tr="tr",e.track="track",e.video="video"}(s||(s={})),function(e){e.connect="CONNECT",e.dispose="DISPOSE",e.setDevice="SET_DEVICE",e.setMode="SET_MODE",e.markElement="MARK_ELEMENT",e.cancelMarkElement="CANCEL_MARK_ELEMENT",e.selectElement="SELECT_ELEMENT",e.cancelSelectElement="CANCEL_SELECT_ELEMENT",e.addElementSnapshot="ADD_ELEMENT_SNAPSHOT",e.resetElementSnapshot="RESET_ELEMENT_SNAPSHOT",e.deleteElementSnapshot="DELETE_ELEMENT_SNAPSHOT",e.updateElementSnapshot="UPDATE_ELEMENT_SNAPSHOT",e.getElementSnapshot="GET_ELEMENT_SNAPSHOT",e.keydownEvent="KEY_DOWN",e.mouseupEvent="MOUSE_UP",e.mousemoveEvent="MOUSE_MOVE",e.wheelEvent="WHEEL_EVENT",e.getHtml="GET_HTML",e.checkUrl="CHECK_URL"}(a||(a={})),function(e){e.VIEW="VIEW",e.EDIT="EDIT"}(l||(l={}));var h=[s.img,s.a,s.h1,s.h2,s.h3,s.h4,s.h5,s.h6,s.span,s.div,s.li,s.ol,s.p,s.pre,s.ul,s.dd,s.i,s.dt,s.dl,s.b,s.dl,s.cite,s.em,s.mark,s.small,s.strong,s.sub,s.sup,s.u,s.button,s.td,s.title,s.label];(i={})[a.keydownEvent]={eventValues:["key","keyCode","ctrlKey","metaKey"],preventDefault:!0},i[a.mouseupEvent]={eventValues:[]},i[a.wheelEvent]={eventValues:["ctrlKey","metaKey","deltaY"],preventDefault:!0},i[a.mousemoveEvent]={eventValues:["clientX","clientY"]};var m={},f=Array.prototype,p=Object.prototype,g=f.slice,v=p.toString,E=p.hasOwnProperty,y=f.forEach,b=Array.isArray,S={};function _(){if(!window.name)return!1;try{var e=JSON.parse(decodeURIComponent(window.name||"")),t=e.is_vabtesting,n=e.source_url,o=e.link_match_type;return!(!0!==t||!m.checkUrlIsMatch(n,o))||(m.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(r){return!1}}function w(e,t){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var n=e.nodeName.toLowerCase();return e&&"body"!==n&&1==e.nodeType?(t.unshift(function(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:function(e){if(!e.parentNode)return-1;for(var t=0,n=e.tagName,o=e.parentNode.children,r=0;r<o.length;r++)if(o[r].tagName===n){if(e===o[r])return t;t++}return-1}(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~t?":nth-of-type("+(t+1)+")":"")}(e)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?t.join(" > "):w(e.parentNode,t)):(t.unshift("body"),t.join(" > "))}function D(e,t){return e.currentStyle?e.currentStyle[t]:e.ownerDocument.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function P(e){var t=e.getBoundingClientRect(),n=t.top+(document.body.scrollTop||document.documentElement.scrollTop),o=t.left+(document.body.scrollLeft||document.documentElement.scrollLeft);return{width:t.width,height:t.height,top:n,left:o,x:t.top,y:t.left}}function O(e){var t=e.childNodes,n="",o=!1;return m.each(t,function(e){!1===o&&3===e.nodeType&&(m.isString(e.textContent)||m.isString(e.innerText)||m.isString(e.nodeValue))&&(n=m.trim(e.textContent||e.innerText||e.nodeValue||""),o=!0)}),n}function N(e){if(!m.isString(e))return null;var t,n=e.split(">");return(t=function o(e){var t,r=n.shift();if(!r)return e;try{t=function(e,t){var n;if("body"===(e=m.trim(e)))return document.getElementsByTagName("body")[0];if(0===e.indexOf("#"))e=e.slice(1),n=document.getElementById(e);else if(e.indexOf(":nth-of-type")>-1){var o=e.split(":nth-of-type");if(!o[0]||!o[1])return null;var r=o[0],i=o[1].match(/\(([0-9]+)\)/);if(!i||!i[1])return null;var s=Number(i[1]);if(!(m.isElement(t)&&t.children&&t.children.length>0))return null;for(var a=t.children,l=0;l<a.length;l++)if(m.isElement(a[l])&&a[l].tagName.toLowerCase()===r&&0==--s){n=a[l];break}if(s>0)return null}return n||null}(r,e)}catch(i){t=null}return t&&m.isElement(t)?o(t):null}())&&m.isElement(t)?t:null}function C(e,t){var n=function(){var e,t={},n=navigator.userAgent.toLowerCase();return(e=n.match(/opera.([\d.]+)/))?t.opera=Number(e[1].split(".")[0]):(e=n.match(/msie ([\d.]+)/))?t.ie=Number(e[1].split(".")[0]):(e=n.match(/edge.([\d.]+)/))?t.edge=Number(e[1].split(".")[0]):(e=n.match(/firefox\/([\d.]+)/))?t.firefox=Number(e[1].split(".")[0]):(e=n.match(/chrome\/([\d.]+)/))?t.chrome=Number(e[1].split(".")[0]):(e=n.match(/version\/([\d.]+).*safari/))?t.safari=Number(e[1].match(/^\d*.\d*/)):(e=n.match(/trident\/([\d.]+)/))&&(t.ie=11),t}(),o=n.ie&&n.ie<9,r="";if(m.each(t,function(e,t){var n;o&&e.indexOf("rgba")>-1&&(e=(n=e.match(/[\d.]+/g)).length>=3?"rgb("+n[0]+","+n[1]+","+n[2]+")":"");var i=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});r+=";"+i+": "+e}),""!==r){var i,s,a,l=e.style,c=l.cssText||"";!c||(s=";",(a=(i=c).length-s.length)>=0&&i.indexOf(s,a)==a)||(c+=";"),l.cssText=c+r}}function T(e,t,n){n||(n=function(e,t){var n=t.originProps,o={attributes:{}},r=n.attributes;return m.each(r.style||{},function(t,n){o.attributes.style[n]=D(e,n)}),Object.hasOwnProperty.call(n,"text")&&(o.attributes.text=O(e)),m.each(["src","href"],function(t){Object.hasOwnProperty.call(r,t)&&(o.attributes[t]=e[t])}),Object.hasOwnProperty.call(r,"target")&&(o.attributes.target=e.getAttribute("target")),o}(e,t));var o=function(e,t){var n=e.originProps,o=t.originProps,r=n.attributes,i=o.attributes,s=!0;return n.text&&n.text!==o.text&&(s=!1),r&&m.each(["src","href","target"],function(e){r[e]&&r[e]!==i[e]&&(s=!1)}),s}(t,n);if(o){var r=t.props;m.isObject(r)&&U(e,r)}return o}function U(e,t){if(Object.hasOwnProperty.call(t,"attributes")){var n=t.attributes;Object.hasOwnProperty.call(n,"style")&&C(e,n.style),m.each(["href","target","src"],function(t){n[t]&&e.getAttribute(t)!==n[t]&&function(e,t,n){e.setAttribute(t,n)}(e,t,n[t])})}Object.hasOwnProperty.call(t,"text")&&function(e,t){var n=e.childNodes,o=!1;m.each(n,function(e){3===e.nodeType&&(o||(e.textContent?e.textContent=t:e.innerText?e.innerText=t:e.nodeValue=t,o=!0))})}(e,t.text)}function M(e){var t=e.getBoundingClientRect(),n=window.innerWidth?{w:window.innerWidth,h:window.innerHeight}:(document.compatMode="BackCompat")?{w:document.body.clientWidth,h:document.body.clientHeigth}:{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},o=document.documentElement.scrollTop||document.body.scrollTop,r=document.documentElement.scrollLeft||document.body.scrollLeft,i=t.width,s=t.height,a=t.left+n.w/2-i/2+r,l=t.top-n.h/2+s/2+o;window.scrollTo(a,l)}function L(e,t){var n=e.tagName.toLowerCase(),o=function(e,t){var n={};return m.each(t||[],function(t){var o=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});n[t]=D(e,o)}),n}(e,t),r={selector:w(e),originProps:{attributes:{style:o},text:O(e)},type:"text",tagName:n};return"a"===n&&(r.originProps.attributes.href=e.href,e.getAttribute("target")&&(r.originProps.attributes.target=e.getAttribute("target")),r.type="link"),"img"===n&&(r.originProps.attributes.src=e.src,r.type="img"),{originStyle:e.getAttribute("style"),eleInfo:r,ele:e}}function R(e){var t=e.eleInfo,n=e.ele;if(n){var o=e.originStyle;U(n,t.originProps),n.style.cssText=o||""}}m.each=function(e,t,n){if(null==e)return!1;if(y&&e.forEach===y)e.forEach(t,n);else if(m.isArray(e)&&e.length===+e.length){for(var o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o,e)===S)return!1}else for(var i in e)if(E.call(e,i)&&t.call(n,e[i],i,e)===S)return!1},m.extend=function(e){return m.each(g.call(arguments,1),function(t){for(var n in t)E.call(t,n)&&void 0!==t[n]&&(e[n]=t[n])}),e},m.isArray=b||function(e){return"[object Array]"===v.call(e)},m.isObject=function(e){return null!=e&&"[object Object]"==v.call(e)},m.isElement=function(e){return!(!e||1!==e.nodeType)},m.isString=function(e){return"[object String]"==v.call(e)},m.isBoolean=function(e){return"[object Boolean]"==v.call(e)},m.isNumber=function(e){return"[object Number]"==v.call(e)&&/[\d\.]+/.test(String(e))},m.unique=function(e){for(var t,n=[],o={},r=0;r<e.length;r++)(t=e[r])in o||(o[t]=!0,n.push(t));return n},m.decodeURIComponent=function(e){var t=e;try{t=decodeURIComponent(e)}catch(n){t=e}return t},m.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=m.decodeURIComponent(e);var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n||n&&"string"!=typeof n[1]&&n[1].length?"":m.decodeURIComponent(n[1])},m.indexOf=function(e,t){var n=e.indexOf;if(n)return n.call(e,t);for(var o=0;o<e.length;o++)if(t===e[o])return o;return-1},m.isFunction=function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},m.isEmptyObject=function(e){if(m.isObject(e)){for(var t in e)if(E.call(e,t))return!1;return!0}return!1},m.map=function(e,t){var n=[];return null==e?n:Array.prototype.map&&e.map===Array.prototype.map?e.map(t):(m.each(e,function(e,o,r){n.push(t(e,o,r))}),n)},m.base64Decode=function(e){var t=m.map(atob(e).split(""),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)});return decodeURIComponent(t.join(""))},m.getURLSearchParams=function(e){for(var t=function(e){return decodeURIComponent(e)},n={},o=(e=e||"").substring(1).split("&"),r=0;r<o.length;r++){var i=o[r].indexOf("=");if(-1!==i){var s=o[r].substring(0,i),a=o[r].substring(i+1);s=t(s),a=t(a),n[s]=a}}return n},m.urlParse=function(e){var t=function(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Path:8,URL:0,QueryString:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,void 0!==e&&this._parse(e)};return t.prototype.setUrl=function(e){this._parse(e)},t.prototype._initValues=function(){for(var e in this._fields)this._values[e]=""},t.prototype.addQueryString=function(e){if("object"!=typeof e)return!1;var t=this._values.QueryString||"";for(var n in e)t=new RegExp(n+"[^&]+").test(t)?t.replace(new RegExp(n+"[^&]+"),n+"="+e[n]):"&"===t.slice(-1)?t+n+"="+e[n]:""===t?n+"="+e[n]:t+"&"+n+"="+e[n];this._values.QueryString=t},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:"",e+=this._values.Fragment?"#"+this._values.Fragment:""},t.prototype.getUrl=function(){var e="";return e+=this._values.Origin,e+=this._values.Port?":"+this._values.Port:"",e+=this._values.Path,e+=this._values.QueryString?"?"+this._values.QueryString:""},t.prototype._parse=function(e){this._initValues();var t=this._regex.exec(e);for(var n in t||m.log("DPURLParser::_parse -> Invalid URL"),this._fields)"undefined"!=typeof t[this._fields[n]]&&(this._values[n]=t[this._fields[n]]);this._values.Hostname=this._values.Host.replace(/:\d+$/,""),this._values.Origin=this._values.Protocol+"://"+this._values.Hostname},new t(e)},m.URL=function(e){var t,n={};if("function"==typeof window.URL&&function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}}())(n=new URL(e)).searchParams||(n.searchParams=(t=m.getURLSearchParams(n.search),{get:function(e){return t[e]}}));else{!1===/^https?:\/\/.+/.test(e)&&m.log("Invalid URL");var o=m.urlParse(e);n.hash="",n.host=o._values.Host?o._values.Host+(o._values.Port?":"+o._values.Port:""):"",n.href=o._values.URL,n.password=o._values.Password,n.pathname=o._values.Path,n.port=o._values.Port,n.search=o._values.QueryString?"?"+o._values.QueryString:"",n.username=o._values.Username,n.hostname=o._values.Hostname,n.protocol=o._values.Protocol?o._values.Protocol+":":"",n.origin=o._values.Origin?o._values.Origin+(o._values.Port?":"+o._values.Port:""):"",n.searchParams=function(){var e=m.getURLSearchParams("?"+o._values.QueryString);return{get:function(t){return e[t]}}}()}return n},m.getQueryParam=function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=m.decodeURIComponent(e);var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n||n&&"string"!=typeof n[1]&&n[1].length?"":m.decodeURIComponent(n[1])},m.isEmptyObject=function(e){if(m.isObject(e)){for(var t in e)if(E.call(e,t))return!1;return!0}return!1},m.contentLoaded=function(e,t){var n=!1,o=!0,r=e.document,i=r.documentElement,s=r.addEventListener,a=s?"addEventListener":"attachEvent",l=s?"removeEventListener":"detachEvent",c=s?"":"on",u=function(o){"readystatechange"==o.type&&"complete"!=r.readyState||(("load"==o.type?e:r)[l](c+o.type,u,!1),!n&&(n=!0)&&t.call(e,o.type||o))},d=function(){try{i.doScroll("left")}catch(e){return void setTimeout(d,50)}u("poll")};if("complete"==r.readyState)t.call(e,"lazy");else{if(!s&&i.doScroll){try{o=!e.frameElement}catch(h){}o&&d()}r[a](c+"DOMContentLoaded",u,!1),r[a](c+"readystatechange",u,!1),e[a](c+"load",u,!1)}},m.secCheck={isHttpUrl:function(e){if("string"!=typeof e)return!1;return!1!==/^https?:\/\/.+/.test(e)||(m.log("Invalid URL"),!1)},removeScriptProtocol:function(e){if("string"!=typeof e)return"";for(var t=/^\s*javascript/i;t.test(e);)e=e.replace(t,"");return e}},m.addEvent=function(){function e(t){return t&&(t.preventDefault=e.preventDefault,t.stopPropagation=e.stopPropagation,t._getPath=e._getPath),t}e._getPath=function(){var e=this;return this.path||this.composedPath&&this.composedPath()||function(){try{var t=e.target,n=[t];if(null===t||null===t.parentElement)return[];for(;null!==t.parentElement;)t=t.parentElement,n.unshift(t);return n}catch(o){return[]}}()},e.preventDefault=function(){this.returnValue=!1},e.stopPropagation=function(){this.cancelBubble=!0};(function(t,n,o){if(t&&t.addEventListener)t.addEventListener(n,function(t){t._getPath=e._getPath,o.call(this,t)},!0);else{var r="on"+n,i=t[r];t[r]=function(t,n,o){return function(r){if(!(r=r||e(window.event)))return undefined;r.target=r.srcElement;var i,s,a=!0;return"function"==typeof o&&(i=o(r)),s=n.call(t,r),!1!==i&&!1!==s||(a=!1),a}}(t,o,i)}}).apply(null,arguments)},m.addSinglePageEvent=function(e){var t=location.href,n=window.history.pushState,o=window.history.replaceState;window.history.pushState=function(){n.apply(window.history,arguments),e(t),t=location.href},window.history.replaceState=function(){o.apply(window.history,arguments),e(t),t=location.href};var r=n?"popstate":"hashchange";m.addEvent(window,r,function(){e(t),t=location.href})},m.trim=function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},m.checkUrlIsMatch=function(e,t){var n,o,r=m.URL(e);if("STRICT"===t)return location.href===r.href;if("FUZZY"===t){try{n=m.URL(location.href)}catch(i){return m.log("url \u89e3\u6790\u5931\u8d25",i),!1}try{o=m.URL(e)}catch(i){return m.log("control_url \u89e3\u6790\u5931\u8d25",i),!1}return n.host===o.host&&n.pathname===o.pathname}return m.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",t),!1},m.checkUrlIsRegexp=function(e,t){var n;try{n=m.URL(location.href)}catch(i){return m.log("url \u89e3\u6790\u5931\u8d25",i),!1}try{var o=(t?new RegExp(e,t):new RegExp(e)).exec(n.href),r=!0;return!!o&&(m.each(o,function(e){e||(r=!1)}),r)}catch(i){return m.log("control_link\u5b57\u6bb5\u5f02\u5e38",i),!1}},m.log=function(){if("object"==typeof console&&console.log){m.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}},m.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(e){console.error(arguments[0])}},m.storage={isSupport:function(){var e=!0;try{var t="__sensorsdatasupport__",n="testIsSupportStorage";window.localStorage.setItem(t,n),window.localStorage.getItem(t)!==n&&(e=!1),window.localStorage.removeItem(t)}catch(o){e=!1}return e},set:function(e,t){this.isSupport()&&window.localStorage.setItem(t,e)},get:function(e){var t=null;return this.isSupport()&&(t=window.localStorage.getItem(e)),t}},m.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())},m.isDate=function(e){return"[object Date]"==Object.prototype.toString.call(e)};class x{constructor(e){this.bridge=e.bridge,this.domEditor=e.domEditor;for(let e in a)m.isFunction(this[e])&&this.bridge.on(a[e],this[e].bind(this))}updateElementSnapshot(e,t){let n=t.payload,o=this.domEditor.getOriginDataBySelector(n.selector),r=o.ele;if(this.domEditor.updataServerData(n.selector,n),r){R(o),this.domEditor.editEleProps(n,o);let t=P(r);this.domEditor.setSelectElePostion(t),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}setMode(e,t){let n=t.payload.type,o=!0;this.domEditor.setMode(n),_()||(o=!1,this.domEditor.mode_type="VIEW"),e.reply({status:"SUCCESS",check_url:o})}resetElementSnapshot(e,t){let n=this,o=t.payload,r=[];this.domEditor.saveServerData(o),this.domEditor.restoreElements(),m.each(o,function(e){let t=n.domEditor.getOriginDataBySelector(e.selector);t.ele?n.domEditor.editEleProps(e,t):r.push(e)}),this.domEditor.resetSelectDivPostion(),this.domEditor.resetHoverDivPostion(),e.reply({status:"SUCCESS",no_found_list:r})}markElement(e,t){let n=t.payload,o=this.domEditor.getOriginDataBySelector(n.selector).ele;if(o){let t=P(o);this.domEditor.setHoverElePostion(t),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}selectElement(e,t){let n=t.payload,o=this.domEditor.getOriginDataBySelector(n.selector).ele;if(o){let t=P(o);this.domEditor.setSelectElePostion(t),M(o),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}addElementSnapshot(e,t){this.updateElementSnapshot(e,t)}deleteElementSnapshot(e,t){this.updateElementSnapshot(e,t)}getHtml(e){let t=document.getElementsByTagName("html")[0].outerHTML;t=t.replace(/class="sa-vabtest-mark"/g,'class="sa-vabtest-mark-hidden"'),e.reply({status:"SUCCESS",visual_dom:t,origin_url:location.href,dom_width:Math.max(document.body.scrollWidth,document.body.offsetWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth),dom_height:Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)})}cancelSelectElement(e){this.domEditor.resetSelectDivPostion(),e.reply({status:"SUCCESS"})}cancelMarkElement(e){this.domEditor.resetHoverDivPostion(),e.reply({status:"SUCCESS"})}checkUrl(e){let t=!0;_()||(t=!1,this.domEditor.mode_type="VIEW"),e.reply({status:t?"SUCCESS":"ERROR"})}}class k{constructor(e){this.bridge=e.bridge,this.domEditor=e.domEditor,this.tagNames=h}init(e){this.config=e,this.addLisenter()}addLisenter(){let e=this.config.action;var t;e.KEY_DOWN&&m.addEvent(document.body,"keydown",this.keydownHandler.bind(this)),e.MOUSE_UP&&m.addEvent(document.body,"mouseup",this.mouseupHandler.bind(this)),e.WHEEL_EVENT&&m.addEvent(document.body,"wheel",this.wheelHandler.bind(this)),m.addEvent(document,"mousemove",this.moveHandler.bind(this)),m.addEvent(document,"click",this.clickHandler.bind(this),!0),m.addSinglePageEvent(this.singlePage.bind(this)),t=this.mutationObserver.bind(this),new(0,window.MutationObserver)(t).observe(document.body,{childList:!0,subtree:!0})}elementFilter(e){if(e){let t=e.tagName.toLowerCase();if(this.tagNames.indexOf(t)>-1){if("a"===t||"img"===t)return e;return this.domEditor.getOriginDataByElement(e).eleInfo.originProps.text?e:null}}return null}getMouseElement(e){let t=null;return m.each(e,function(e){!t&&m.isString(e.className)&&-1===e.className.indexOf("sa-vabtest-mark")&&(t=e)}),t}moveHandler(e){let t=this.config.action;if(t.MOUSE_MOVE&&t.MOUSE_MOVE&&t.MOUSE_MOVE.eventValues&&m.isArray(t.MOUSE_MOVE.eventValues)){let n={};m.each(t.MOUSE_MOVE.eventValues,function(t){n[t]=e[t]}),this.bridge.emit(a.mousemoveEvent,n)}if("EDIT"!==this.domEditor.mode_type)return;let n=document.elementsFromPoint(e.clientX,e.clientY),o=this.getMouseElement(n),r=this.elementFilter(o);if(r){let e=P(r);this.domEditor.setHoverElePostion(e)}else this.domEditor.resetHoverDivPostion()}clickHandler(e){if("EDIT"!==this.domEditor.mode_type)return;e.stopPropagation(),e.preventDefault();let t=document.elementsFromPoint(e.clientX,e.clientY),n=this.getMouseElement(t),o=this.elementFilter(n);if(o){let e=this.domEditor.getOriginDataByElement(o).eleInfo,t=e.selector,n=this.domEditor.getServerDataBySelector(t),r=m.extend(n||{isModify:!1},e),i=P(o);this.domEditor.setSelectElePostion(i),this.bridge.emit(a.selectElement,r)}else this.domEditor.resetSelectDivPostion(),this.bridge.emit(a.cancelSelectElement,{status:!0})}keydownHandler(e){let t={},n=this.config.action,o=(e.ctrlKey||e.metaKey?"cmd+":"")+e.key;"cmd+-"!==o&&"cmd+="!==o&&"Escape"!==o||(!0===n.KEY_DOWN.preventDefault&&e.preventDefault(),n.KEY_DOWN.eventValues&&m.isArray(n.KEY_DOWN.eventValues)&&m.each(n.KEY_DOWN.eventValues,function(n){t[n]=e[n]}),this.bridge.emit(a.keydownEvent,t))}mouseupHandler(e){let t={},n=this.config.action;n.MOUSE_UP&&(!0===n.MOUSE_UP.preventDefault&&e.preventDefault(),n.MOUSE_UP.eventValues&&m.isArray(n.MOUSE_UP.eventValues)&&m.each(n.MOUSE_UP.eventValues,function(n){t[n]=e[n]}),this.bridge.emit(a.mouseupEvent,t))}wheelHandler(e){let t={},n=this.config.action;n.WHEEL_EVENT&&(!0===n.WHEEL_EVENT.preventDefault&&e.preventDefault(),n.WHEEL_EVENT.eventValues&&m.isArray(n.WHEEL_EVENT.eventValues)&&m.each(n.WHEEL_EVENT.eventValues,function(n){t[n]=e[n]}),this.bridge.emit(a.wheelEvent,t))}singlePage(e){if(e===location.href)return!1;let t=!0;_()||(t=!1,this.domEditor.mode_type="VIEW"),this.bridge.emit(a.checkUrl,{status:t?"SUCCESS":"ERROR"})}mutationObserver(){let e=this;m.each(e.domEditor.serverData,function(t){let n=e.domEditor.getOriginDataBySelector(t.selector);n.ele&&e.domEditor.editEleProps(t,n)})}}class A{constructor(e){this.config=e.config,this.hoverDiv=null,this.selectDiv=null,this.maskDiv=null,this.mode_type="EDIT",this.serverData=[],this.originData=[],this.buildMarkDom()}setDomPostion(e,t){m.each(["width","height","left","top"],function(n){e.style[n]=t[n]+"px"})}setHoverElePostion(e){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.hoverDiv,e)}setSelectElePostion(e){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.selectDiv,e)}restoreElements(){m.each(this.originData,function(e){R(e)}),this.originData=[]}editEleProps(e,t){let n=t.eleInfo;T(t.ele,e,n)}setMode(e){var t;this.mode_type=e,"VIEW"===e&&((t=this.maskDiv)&&t.parentNode.removeChild(t),this.hoverDiv=null,this.selectDiv=null,this.maskDiv=null)}resetMarkDom(e){e&&this.setDomPostion(e,{width:0,height:0,top:0,left:0})}resetSelectDivPostion(){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.selectDiv,{width:0,height:0,top:0,left:0})}resetHoverDivPostion(){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.hoverDiv,{width:0,height:0,top:0,left:0})}buildMarkDom(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),o=document.createElement("style");e.className="sa-vabtest-mark",t.className="sa-vabtest-hover",n.className="sa-vabtest-clickable";var r=e.attachShadow({mode:"open"});o.innerText=".sa-vabtest-clickable { background: rgba(44, 123, 242, 0.2) !important; outline: 2px solid #2C7BF2 !important; outline-offset: -2px !important; width: 0;height: 0;position: absolute; top: 0; left: 0;}.sa-vabtest-hover { outline: 2px solid #2C7BF2 !important; outline-offset: -2px !important;  width: 0;height: 0;position: absolute; top: 0; left: 0;}",r.appendChild(o),r.appendChild(t),r.appendChild(n),document.body.appendChild(e),function(e){var t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e))}catch(n){t.styleSheet.cssText=e}document.getElementsByTagName("head")[0].appendChild(t)}(".sa-vabtest-mark { pointer-events: none;}.sa-vabtest-mark-hidden { display: none;}"),this.hoverDiv=t,this.selectDiv=n,this.maskDiv=e}saveServerData(e){this.serverData=e}updataServerData(e,t){let n=!1,o=this;m.each(this.serverData,function(r,i){r.selector===e&&(o.serverData[i]=t,n=!0)}),n||this.serverData.push(t)}getServerDataBySelector(e){let t=null;return m.each(this.serverData,function(n){n.selector===e&&(t=n)}),t}setOriginData(e,t){let n=!1,o=this;m.each(this.originData,function(t,r){e===t.selector&&(o.originData[r]=t,n=!0)}),n||this.originData.push(t)}getOriginDataBySelector(e){let t=null;if(m.each(this.originData,function(n){e===n.eleInfo.selector&&(t=n)}),!t){let n=N(e);n?(t=L(n,this.config.styles),this.setOriginData(t.eleInfo.selector,t)):t={}}return t}getOriginDataByElement(e){let t=null;return m.each(this.originData,function(n){e===n.ele&&(t=n)}),t||(t=L(e,this.config.styles),this.setOriginData(t.eleInfo.selector,t)),t}}class H{constructor(){this.plugin_name="VABTest",this.plugin_version="1.24.14",this.abTestingSDK=null,this.bridge=new d({source:"sa-web-abtesting-sdk",frameSource:"sa-fe-abtesting-mode",version:"abtest_version"})}init(e,t){this.abTestingSDK=t.SensorsABTest;let n=this;if(e&&this.abTestingSDK){m.log=e.log,this.bridge.emit(a.connect,{status:!0}).then(function(e){if("SUCCESS"===e.status){let t=e.payload.support;n.domEditor=new A({config:t}),n.sender=new k({bridge:n.bridge,domEditor:n.domEditor}),new x({bridge:n.bridge,domEditor:n.domEditor}),n.sender.init(t)}else m.log("ABTesting SDK \u53ef\u89c6\u5316\u7f16\u8f91\u72b6\u6001\u521d\u59cb\u5316\u5931\u8d25")})}else m.log("ABTesting SDK \u53ef\u89c6\u5316\u7f16\u8f91\u72b6\u6001\u521d\u59cb\u5316\u5931\u8d25")}}let I=new H;I.__constructor__=H,window.SensorsDataWebJSSDKPlugin&&"[object Object]"===Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.VABTest=window.SensorsDataWebJSSDKPlugin.VABTest||I:window.SensorsDataWebJSSDKPlugin={VABTest:I}});