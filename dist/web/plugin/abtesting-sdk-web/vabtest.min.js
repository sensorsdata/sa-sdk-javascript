!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}var t,i,n=function(){function e(){var e=this;this.eventPool=new Map,this.on=function(t,i){var n=e.eventPool,o=n.get(t);o?n.set(t,[].concat(o,[i])):n.set(t,[i])},this.remove=function(t,i){var n=e.eventPool,o=n.get(t);if(o)return i?n.set(t,o.filter(function(e){return i!==e})):n["delete"](t)}}var t=e.prototype;return t.emit=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var o=this.eventPool.get(e);o&&o.forEach(function(e){e.apply(void 0,i)})},t.get=function(){var e;return(e=this.eventPool).get.apply(e,arguments)},t.has=function(){var e;return(e=this.eventPool).has.apply(e,arguments)},t["delete"]=function(){var e;return(e=this.eventPool)["delete"].apply(e,arguments)},t.forEach=function(){var e;return(e=this.eventPool).forEach.apply(e,arguments)},t.keys=function(){return this.eventPool.keys()},t.set=function(){var e;return(e=this.eventPool).set.apply(e,arguments)},e}();!function(e){e[e.connect=0]="connect",e[e.dispose=1]="dispose"}(t||(t={})),function(e){e.SUCCESS="SUCCESS",e.PENDING="PENDING",e.ERROR="ERROR",e.TIMEOUT="TIMEOUT"}(i||(i={}));var o,s,r,a,l,d,c=(o=(new Date).getTime(),function(e){return Math.ceil((o=(9301*o+49297)%233280)/233280*e)}),u=function(e,t){return function(){if("function"==typeof Uint32Array){var e=null;if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof window.msCrypto&&(e=window.msCrypto),"object"==typeof e&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/Math.pow(2,32)}}return c(1e19)/1e19}()*(t-e)+e},h=function(){function t(o){var s=this;this.iframe=void 0,this.ENV="IFRAME",this.config={source:"",frameSource:""},this.context=void 0,this.messagePool=new n,this.debugInfo={},this.logMessage=function(t,i){var n=s||{},o=n.config,r=n.debugInfo,a=void 0===r?{}:r,l=n.ENV,d=void 0===l?"":l,c=(o||{}).debug,u=void 0!==c&&c;try{if(u){var h,m=i||{},f=m.$id,g=void 0===f?"":f,p=m.type,v=void 0===p?"":p,E=m.payload,y="emit"===t?g:v;a[y]||(a[y]={}),a[y]=e({},a[y],((h={action:t,logTime:(new Date).getTime(),role:d,messageId:g,messageType:v})[t]=JSON.stringify(E,null,2),h["ms-"+t]=i,h)),console.log("@FrameBridge-Message-"+t+"-"+v),console.table(a[y])}}catch(b){u&&console.error("@FrameBridge-Log-Message-Error",b)}},this.receiveMessageHandle=function(n){var o=t.MessageDecode(null==n?void 0:n.data);if(s.logMessage("receive",o),null!=o&&o.$id){var r=o.$id,a=void 0===r?"":r,l=o.type,d=void 0===l?"":l;if(o.source===s.config.frameSource){var c=s.messagePool.has(a),u=s.messagePool.has(d);c&&s.messagePool.emit(a,{status:i.SUCCESS,payload:o}),u&&s.messagePool.emit(d,e({},o,{status:i.SUCCESS}))}}},this.iframeLoadHandle=function(){var e;null==(e=s.iframe)||e.contentWindow},this.config=o,this.init()}t.MessageEncode=function(e,t){void 0===e&&(e={}),void 0===t&&(t=JSON.stringify({}));var i=t;try{i=encodeURIComponent(JSON.stringify(e))}catch(n){console.error("[@FrameBridge:error] MessageDecode error",n)}return i},t.MessageDecode=function(e,t){void 0===t&&(t=null);var i=t;try{i=JSON.parse(decodeURIComponent(e||""))}catch(n){i=t,console.warn("@FrameBridge MessageDecode error",n)}return i};var o=t.prototype;return o.emit=function(e,n,o){var s,r,a=this,l=(o||{}).timeout,d=void 0===l?51e3:l,c=this.config.source,h=function(e){return void 0===e&&(e=""),e+"@"+Date.now()+"@"+u(0,10)}(this.ENV),m={$id:h,type:e,status:i.PENDING,payload:n,source:c};"IFRAME"===this.ENV?this.context=null==(s=window)?void 0:s.parent:this.context=null==(r=this.iframe)?void 0:r.contentWindow;return this.context?new Promise(function(e){var n,o;a.messagePool.on(h,function(t){e(t),a.messagePool.remove(h)}),d&&setTimeout(function(){a.messagePool.has(h)&&a.messagePool.emit(h,{status:i.TIMEOUT})},d),a.logMessage("emit",m),null==(n=a.context)||n.postMessage(t.MessageEncode(m),(null==(o=a.config)?void 0:o.origin)||"*")}):Promise.resolve({status:i.ERROR,message:"No communication environment,Please check config!"})},o.on=function(e,t){var i=this;this.messagePool.on(e,function(e){var n=e.$id;return t({reply:function(e){i.emit(n,e)}},e,i.config)})},o.destroy=function(){var e;this.debugInfo={},window.removeEventListener("message",this.receiveMessageHandle),null==this||null==(e=this.iframe)||null==e.removeEventListener||e.removeEventListener("load",this.iframeLoadHandle)},o.init=function(){var e,t=this.config.container;if(t){this.ENV="CONTAINER";var i="string"===((e=t)===undefined?"undefined":null===e?"null":e.constructor.name.toLowerCase())?document.querySelector(t):t;if(this.iframe=i,!(i&&i instanceof HTMLIFrameElement))return console.error("[@FrameBridge:error]container is not IFRAME element!"),this;i.addEventListener("load",this.iframeLoadHandle)}else this.ENV="IFRAME";this.debugInfo={},window.addEventListener("message",this.receiveMessageHandle,!1)},t}();!function(e){e.address="address",e.article="article",e.aside="aside",e.footer="footer",e.header="header",e.h1="h1",e.h2="h2",e.h3="h3",e.h4="h4",e.h5="h5",e.h6="h6",e.main="main",e.nav="nav",e.section="section",e.blockquote="blockquote",e.dd="dd",e.div="div",e.dl="dl",e.dt="dt",e.figcaption="figcaption",e.figure="figure",e.hr="hr",e.li="li",e.ol="ol",e.p="p",e.pre="pre",e.ul="ul",e.a="a",e.abbr="abbr",e.b="b",e.bdi="bdi",e.bdo="bdo",e.br="br",e.cite="cite",e.code="code",e.data="data",e.dfn="dfn",e.em="em",e.i="i",e.kbd="kbd",e.mark="mark",e.q="q",e.rp="rp",e.rt="rt",e.ruby="ruby",e.s="s",e.samp="samp",e.small="small",e.span="span",e.strong="strong",e.sub="sub",e.sup="sup",e.time="time",e.u="u",e["var"]="var",e.wbr="wbr",e.img="img",e.area="area",e.audio="audio",e.base="base",e.body="body",e.button="button",e.canvas="canvas",e.caption="caption",e.col="col",e.colgroup="colgroup",e.datalist="datalist",e.del="del",e.details="details",e.dialog="dialog",e.embed="embed",e.fieldset="fieldset",e.form="form",e.head="head",e.hgroup="hgroup",e.html="html",e.iframe="iframe",e.input="input",e.ins="ins",e.label="label",e.legend="legend",e.link="link",e.map="map",e.math="math",e.menu="menu",e.menuitem="menuitem",e.meta="meta",e.meter="meter",e.noscript="noscript",e.object="object",e.optgroup="optgroup",e.option="option",e.output="output",e.param="param",e.picture="picture",e.progress="progress",e.rb="rb",e.rtc="rtc",e.script="script",e.select="select",e.slot="slot",e.source="source",e.style="style",e.summary="summary",e.svg="svg",e.table="table",e.tbody="tbody",e.td="td",e.template="template",e.textarea="textarea",e.tfoot="tfoot",e.th="th",e.thead="thead",e.title="title",e.tr="tr",e.track="track",e.video="video",e.font="font",e.circle="circle",e.ellipse="ellipse",e.line="line",e.linearGradient="linearGradient",e.polygon="polygon",e.polyline="polyline",e.radialGradient="radialGradient",e.rect="rect",e.stop="stop",e.g="g",e.text="text",e.tspan="tspan",e.defs="defs",e.use="use"}(r||(r={})),function(e){e.connect="CONNECT",e.dispose="DISPOSE",e.setDevice="SET_DEVICE",e.setMode="SET_MODE",e.markElement="MARK_ELEMENT",e.cancelMarkElement="CANCEL_MARK_ELEMENT",e.selectElement="SELECT_ELEMENT",e.cancelSelectElement="CANCEL_SELECT_ELEMENT",e.addElementSnapshot="ADD_ELEMENT_SNAPSHOT",e.resetElementSnapshot="RESET_ELEMENT_SNAPSHOT",e.deleteElementSnapshot="DELETE_ELEMENT_SNAPSHOT",e.updateElementSnapshot="UPDATE_ELEMENT_SNAPSHOT",e.getElementSnapshot="GET_ELEMENT_SNAPSHOT",e.keydownEvent="KEY_DOWN",e.mouseupEvent="MOUSE_UP",e.mousemoveEvent="MOUSE_MOVE",e.wheelEvent="WHEEL_EVENT",e.getHtml="GET_HTML",e.checkUrl="CHECK_URL",e.insertionInfo="INSERTION_INFO",e.searchElement="SEARCH_ELEMENT"}(a||(a={})),function(e){e.CHANGE="CHANGE",e.INSERTION="INSERTION",e.BEFORE_INSERTION="BEFORE_INSERTION",e.AFTER_INSERTION="AFTER_INSERTION"}(l||(l={})),function(e){e.VIEW="VIEW",e.EDIT="EDIT"}(d||(d={}));r.img,r.a,r.h1,r.h2,r.h3,r.h4,r.h5,r.h6,r.span,r.div,r.li,r.ol,r.p,r.pre,r.ul,r.dd,r.i,r.dt,r.dl,r.b,r.cite,r.em,r.mark,r.small,r.strong,r.sub,r.sup,r.u,r.button,r.td,r.title,r.label,r.code,r.blockquote,r.figcaption,r.figure,r.area,r.select,r.article,r.slot,r.aside,r.footer,r.header,r.main,r.nav,r.form,r.body,r.font;(s={})[a.keydownEvent]={eventValues:["key","keyCode","ctrlKey","metaKey"],preventDefault:!0},s[a.mouseupEvent]={eventValues:[]},s[a.wheelEvent]={eventValues:["ctrlKey","metaKey","deltaY"],preventDefault:!0},s[a.mousemoveEvent]={eventValues:["clientX","clientY"]};var m={};function f(e){this.SensorsABTest=e}function g(e){this.attr_name="sa-abtest-"+e,this.remove_timer=null,this.is_added=!1,this.is_abort=!1,this.is_timeout=!1,this.style_element=null,this.createMaskStyle()}function p(e){if(e)try{m.isString(e)&&(e=m.getDomBySelector(e)),e.parentNode&&e.parentNode.removeChild(e)}catch(t){m.logger.log("delete dom error:",t)}}function v(e,t){if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var i=e.nodeName.toLowerCase();return e&&"body"!==i&&1==e.nodeType?(t.unshift(function(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:function(e){if(!e.parentNode)return-1;for(var t=0,i=e.tagName,n=e.parentNode.children,o=0;o<n.length;o++)if(n[o].tagName===i){if(e===n[o])return t;t++}return-1}(e);return e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~t?":nth-of-type("+(t+1)+")":"")}(e)),e.getAttribute&&e.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(e.getAttribute("id"))?t.join(" > "):v(e.parentNode,t)):(t.unshift("body"),t.join(" > "))}function E(e){var t=e.getBoundingClientRect(),i=t.top+(document.body.scrollTop||document.documentElement.scrollTop),n=t.left+(document.body.scrollLeft||document.documentElement.scrollLeft),o=m.ry(e).getStyle("z-index")||0;return{width:t.width,height:t.height,top:i,left:n,zIndex:o}}function y(e){var t=e.childNodes,i="",n=!1;return m.each(t,function(e){if(!1===n&&3===e.nodeType){var t=e.textContent||e.innerText||e.nodeValue||"";t&&(i=m.trim(t),n=!0)}}),i}function b(e,t){var i=e.tagName;y(e)!==t&&(e.textContent?e.textContent=t:e.innerText?e.innerText=t:e.innerHTML=t,"input"!==i&&"INPUT"!==i||(e.value=t||""))}function S(e,t,i){e.setAttribute(t,i)}function _(e,t,i){i||(i=function(e,t){var i=t.originProps,n={attributes:{}},o=i.attributes;return m.each(o.style||{},function(t,i){n.attributes.style[i]=m.ry(e).getStyle(i)}),Object.hasOwnProperty.call(i,"text")&&(n.attributes.text=y(e)),m.each(["src","href"],function(t){Object.hasOwnProperty.call(o,t)&&(n.attributes[t]=e[t])}),Object.hasOwnProperty.call(o,"target")&&(n.attributes.target=e.getAttribute("target")),n}(e,t));var n=function(e,t){var i=e.originProps||{},n=t.originProps||{},o=i.attributes||{},s=n.attributes||{},r=!0;return i.text&&i.text!==n.text&&(r=!1),o&&m.each(["src","href","target","srcset"],function(e){o[e]&&o[e]!==s[e]&&(r=!1)}),r}(t,i);if(n){var o=t.props;m.isObject(o)&&function(e,t,i){if(Object.hasOwnProperty.call(t,"attributes")){var n=t.attributes;Object.hasOwnProperty.call(n,"style")&&function(e,t,i){var n=m.getUA(),o=n.ie&&n.ie<9,s="";m.each(t,function(e,t){var i;o&&e.indexOf("rgba")>-1&&(e=(i=e.match(/[\d.]+/g)).length>=3?"rgb("+i[0]+","+i[1]+","+i[2]+")":"");var n=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});s+=n+": "+e+" !important;"}),""!==s&&(w({attr_value:i=m.encodeSelector(i),text:s="[sensors_ab_ele_style_id="+i+"]{"+s+"}",attr_key:"sensors_ab_ele_style_id"}),e.setAttribute("sensors_ab_ele_style_id",i))}(e,n.style,i.selector),m.each(["href","target","src","srcset"],function(t){n[t]&&e.getAttribute(t)!==n[t]&&S(e,t,n[t])})}Object.hasOwnProperty.call(t,"text")&&"innerHtml"!==i.type&&b(e,t.text)}(e,o,t)}return n}function w(e){try{var t=document.createElement("style");t.innerHTML=e.text,t.setAttribute(e.attr_key,e.attr_value),document.getElementsByTagName("head")[0].append(t)}catch(i){window.sensorsABTestModifyListener&&window.sensorsABTestModifyListener(e,i.stack||i.message)}}function D(e){try{var t=document.createElement("script");t.setAttribute(e.attr_key,e.attr_value),t.innerHTML="try{"+e.text+"}catch(e){ window.sensorsABTestModifyListener && window.sensorsABTestModifyListener("+JSON.stringify(e)+", e.stack || e.message) }",document.body.append(t)}catch(i){window.sensorsABTestModifyListener&&window.sensorsABTestModifyListener(e,i.stack||i.message)}}function N(e){var t=e.getBoundingClientRect(),i=window.innerWidth?{w:window.innerWidth,h:window.innerHeight}:"BackCompat"==document.compatMode?{w:document.body.clientWidth,h:document.body.clientHeigth}:{w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},n=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft,s=t.width,r=t.height,a=t.left+i.w/2-s/2+o,l=t.top-i.h/2+r/2+n;window.scrollTo(a,l)}function T(e,t,i){var n=e.tagName.toLowerCase(),o=function(e,t){var i={};return m.each(t||[],function(t){var n=t.replace(/[A-Z]+/g,function(e){return"-"+e.toLowerCase()});i[t]=m.ry(e).getStyle(n)}),i}(e,t),s={selector:v(e),originProps:{attributes:{style:o},text:y(e),hasChildren:e.children.length>0},type:"text",tagName:n};"a"===n&&(s.originProps.attributes.href=e.href,e.getAttribute("target")&&(s.originProps.attributes.target=e.getAttribute("target")),s.type="link"),"img"===n&&(s.originProps.attributes.src=e.src,s.originProps.attributes.srcset=e.srcset,s.type="img"),e.hasAttribute("sensors_ab_widget")&&(s.type="innerHtml");var r=e.getAttribute("style");if(i)for(var a=0;a<i.length;a++){var l=i[a],d=e.getAttribute(l);s.originProps.attributes[l]||null===d||d===undefined||(s.originProps.attributes[l]=d)}return{originStyle:r,eleInfo:s,ele:e}}function O(e){var t=e.eleInfo,i=e.ele;if(i){var n=t.originProps;if(Object.hasOwnProperty.call(n,"attributes")){var o=n.attributes;C({attr_value:m.encodeSelector(t.selector),attr_key:"sensors_ab_ele_style_id",ele:i}),m.each(["href","target","src","srcset"],function(e){o[e]&&i.getAttribute(e)!==o[e]&&S(i,e,o[e])})}Object.hasOwnProperty.call(n,"text")&&"innerHtml"!==t.type&&b(i,n.text)}}function C(e){var t=e.attr_value,i=e.attr_key,n=e.ele,o=document.querySelectorAll("["+i+"]");o&&o.length&&m.each(o,function(e){var n=e.getAttribute(i);e.parentElement&&(t===n||!t)&&["style","script"].indexOf(e.tagName.toLowerCase())>-1&&e.parentElement.removeChild(e)}),n&&i&&n.removeAttribute(i)}function P(e){const t=e.hidden||"none"===e.style.display||"hidden"===e.style.visibility,i="0"===window.getComputedStyle(e).getPropertyValue("opacity");return t||i}function k(e){const t=e.split(">");for(;t.length>0;){if(P(document.querySelector(t.join(">"))))return!0;t.length-=1}return!1}function A(e,t,i){var n=null,o=null,s=m.getDomBySelector(e.selector)||document.querySelector&&document.querySelector(e.selector);if(s&&s.hasAttribute("sensors_ab_widget")){!function(e,t){var i=e.selector,n=e.props.text,o="text"===e.props.sensors_ab_widget;const s=document.querySelector(i);if(!s)throw"element not found:"+i;o?s.innerText=n:s.innerHTML=n,M(s,e,t)}(e,t);var r=E(document.querySelector(e.selector));i&&i.setSelectElePostion(r)}else{function a(){return n=function(e,t){var i=m.getDomBySelector(e.base),n=e.props.text,o=e.props.sensors_ab_widget,s=e.operation;if(!i)throw"VABTest: No base element";if(!i.parentNode)throw"base element parentNode not found";var r=document.createElement("font");if("text"===o&&(r.innerText=n),"html"===o&&(r.innerHTML=n),M(r,e,t),"BEFORE_INSERTION"===s)i.parentNode.insertBefore(r,i);else{if("AFTER_INSERTION"!==s)throw"operation not supported";i.nextSibling?i.parentNode.insertBefore(r,i.nextSibling):i.parentNode.appendChild(r)}return v(r)}(e,t)}i?o=i.getModifiedEleSelectorsWhen(a):a()}return{selector:e.selector,addedEleSelector:n,updatedSelectors:o}}function M(e,t,i){if(i&&i.length)for(var n=0;n<i.length;n++)"text"!==i[n]&&t.props[i[n]]!==undefined&&e.setAttribute(i[n],t.props[i[n]]);if(!0===i)for(var o in t.props)"text"!==o&&e.setAttribute(o,t.props[o])}function H(){if(!window.name)return!1;try{var e=JSON.parse(decodeURIComponent(window.name||"")),t=e.is_vabtesting,i=e.source_url,n=e.link_match_type;return!(!0!==t||!m.checkUrlIsMatch(i,n))||(m.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(o){return!1}}m.secCheck={isHttpUrl:function(e){if("string"!=typeof e)return!1;return!1!==/^https?:\/\/.+/.test(e)||(m.log("Invalid URL"),!1)},removeScriptProtocol:function(e){if("string"!=typeof e)return"";for(var t=/^\s*javascript/i;t.test(e);)e=e.replace(t,"");return e}},m.checkUrlIsMatch=function(e,t){var i,n,o=m.URL(e);if("STRICT"===t)return location.href===o.href;if("FUZZY"===t){try{i=m.URL(location.href)}catch(s){return m.log("url \u89e3\u6790\u5931\u8d25",s),!1}try{n=m.URL(e)}catch(s){return m.log("control_url \u89e3\u6790\u5931\u8d25",s),!1}return i.host===n.host&&i.pathname===n.pathname}return m.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",t),!1},m.checkUrlIsRegexp=function(e,t){var i;try{i=m.URL(location.href)}catch(n){return m.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{return!!(t?new RegExp(e,t):new RegExp(e)).exec(i.href)}catch(n){return m.log("control_link\u5b57\u6bb5\u5f02\u5e38",n),!1}},m.log=function(){if("object"==typeof console&&console.log){m.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}},m.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(e){console.error(arguments[0])}},m.encodeSelector=function(e){return m.base64Encode(e).replace(/[+\/=]/g,function(e){return"_"})},f.prototype={value_type_list:["Number","String","Object","Boolean"],regName:/^((?!^distinct_id$|^original_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_tag.*|^user_group.*)[a-zA-Z_][a-zA-Z\d_]*)$/i,valueType:function(e,t){switch(t){case"Number":if(m.isNumber(e))return!0;break;case"String":if(m.isString(e))return!0;break;case"Object":if(m.isObject(e))return!0;break;case"Boolean":if(!0===e||!1===e)return!0;break;default:return!1}return!1},para:function(e,t,i){var n=this,o={verify_success:!0,para:null};return m.each(i,function(i,s){if("essential"===i)switch(s){case"param_name":m.isString(t.param_name)&&t.param_name.length>0||(n.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",t.param_name),o.verify_success=!1);break;case"value_type":m.isString(t.value_type)&&-1!==m.indexOf(n.value_type_list,t.value_type)||(n.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",t.value_type),o.verify_success=!1);break;case"default_value":"undefined"==typeof t.default_value?(n.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),o.verify_success=!1):n.valueType(t.default_value,t.value_type)||(n.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",t.default_value,t.value_type),o.verify_success=!1);break;case"callback":m.isFunction(t.callback)||(n.SensorsABTest.log(e+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),o.verify_success=!1);break;default:o.verify_success=!1}else if("not_essential"===i)switch(s){case"timeout_milliseconds":t.timeout_milliseconds=t.timeout_milliseconds||n.SensorsABTest.para.timeout_milliseconds||n.SensorsABTest.default_para.timeout_milliseconds,(!m.isNumber(t.timeout_milliseconds)||m.isNumber(t.timeout_milliseconds)&&t.timeout_milliseconds<=0)&&(n.SensorsABTest.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",t.timeout_milliseconds),t.timeout_milliseconds=n.SensorsABTest.para.timeout_milliseconds),t.timeout_milliseconds<200&&(t.timeout_milliseconds=200);break;case"properties":t.properties=m.isObject(t.properties)?t.properties:{}}}),o.para=t,o},resolveCustomProperties:function(e){var t=this,i={verify_success:!0,para:null},n=e.custom_properties;if(!m.isObject(n)||m.isEmptyObject(n))return delete e.custom_properties,i.para=e,i;if(m.each(n,function(e,n){if((!m.isString(n)||!t.regName.test(n)||n.length>100)&&(t.SensorsABTest.log(" property name [ "+n+" ] is not invalid "),i.verify_success=!1),(m.isString(e)||m.isNumber(e)||m.isBoolean(e)||m.isArray(e)||m.isDate(e))&&!(m.isString(e)&&e.length>500)||(t.SensorsABTest.log("property [ "+n+" ] of value [ "+JSON.stringify(e)+" ] is not invalid"),i.verify_success=!1),m.isArray(e)){var o=!0;m.each(e,function(e){!1!==o&&(m.isString(e)||(o=!1))}),o||(t.SensorsABTest.log("property  value type can be array, but only allow string item. property [ "+n+" ] of value  "+JSON.stringify(e)+"  is not invalid"),i.verify_success=!1)}}),!0===i.verify_success){var o={};m.each(n,function(e,t){m.isDate(e)?o[t]=m.formatDate(e):m.isString(e)?o[t]=e:o[t]=JSON.stringify(e)}),e.custom_properties=o}return i.para=e,i}},m.VerifyStore=f,m.listenPageState=function(e){({visibleHandle:m.isFunction(e.visible)?e.visible:function(){},hiddenHandler:m.isFunction(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(e.visibilityChange,function(){document[e.hidden]?e.hiddenHandler():e.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}}).init()},m.listenPageState=function(e){({visibleHandle:m.isFunction(e.visible)?e.visible:function(){},hiddenHandler:m.isFunction(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;document.addEventListener(e.visibilityChange,function(){document[e.hidden]?e.hiddenHandler():e.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}}).init()},m.getStorageData=function(e,t){var i=m.localStorage.get(e);m.isString(i)&&(i=t.kit.userDecryptIfNeeded(i));try{i=JSON.parse(i)}catch(n){m.log(n)}return i},m.setStorageData=function(e,t,i){e=JSON.stringify(e),i&&(e=m.userEncrypt(e)),m.localStorage.set(t,e)},g.prototype={createMaskStyle:function(){var e="["+this.attr_name+"],["+this.attr_name+"] body{opacity:0 !important;-khtml-opacity:0 !important;-moz-opacity:0;filter:alpha(opacity=0);}",t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e))}catch(i){t.styleSheet.cssText=e}try{this.style_element=t,document.getElementsByTagName("head")[0].appendChild(t)}catch(i){m.log("error when create calls")}},show:function(e){try{var t=this;if(this.is_abort)return!1;var i=null;if(i=document.getElementsByTagName("html")[0],!m.isElement(i))return;i.setAttribute(this.attr_name,"1"),this.is_added=!0,m.isNumber(e)&&(this.remove_timer=setTimeout(function(){t.is_timeout=!0,t.remove()},e))}catch(n){m.log("error when show calls")}},remove:function(){try{if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var e=null;if(e=document.getElementsByTagName("html")[0],!m.isElement(e))return;e.removeAttribute(this.attr_name),this.style_element&&(document.getElementsByTagName("head")[0].removeChild(this.style_element),this.style_element=null)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null)}catch(t){m.log("error when remove calls")}}},m.Mask=g;class R{constructor(e){this.bridge=e.bridge,this.domEditor=e.domEditor,this.pageContentObserver=null,this.dynamicAddedElements=[];for(let e in a)m.isFunction(this[e])&&this.bridge.on(a[e],this[e].bind(this))}listenPageContentChange(){var e,t;this.pageContentObserver=(e=this.mutationObserver.bind(this),(t=new(0,window.MutationObserver)(e)).observe(document.body,{childList:!0,subtree:!0}),t)}unListenPageContentChange(){var e;(e=this.pageContentObserver)&&e.disconnect(),this.pageContentObserver=null}getElementSnapshot(e,t){t.payload.selector;let i=t.payload.selector,n=this.domEditor.getOriginDataBySelector(i);if(n.ele){let t=n.eleInfo,o=this.domEditor.getServerDataBySelector(i),s=m.extend(o||{isModify:!1},t);e.reply({status:"SUCCESS",element:s})}else e.reply({status:"ERROR",message:"\u672a\u627e\u5230\u8be5\u5143\u7d20"})}updateElementSnapshot(e,t){this.unListenPageContentChange();let i=t.payload;let n={};switch(i.type){case"img":case"link":case"text":let t=this.domEditor.getOriginDataBySelector(i.selector),l=t.ele;if(this.domEditor.updataServerData(i.selector,i),!l)return void e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"});{O(t),this.domEditor.editEleProps(i,t);let e=E(l);this.domEditor.setSelectElePostion(e)}break;case"globalScript":var o={attr_value:i.id,text:i.props.text,attr_key:"sensors_ab_script_id"};C(o),D(o);break;case"globalStyle":var s={attr_value:i.id,text:i.props.text,attr_key:"sensors_ab_style_id"};C(s),w(s);break;case"innerHtml":try{this.domEditor.updataServerData(i.selector,i);var r=A(i,this.domEditor.config.attributes,this.domEditor);r.addedEleSelector&&this.dynamicAddedElements.push(r.addedEleSelector);let e=this.domEditor.getOriginDataBySelector(i.selector);this.domEditor.editEleProps(i,e);let t=E(document.querySelector(i.selector));this.domEditor.setSelectElePostion(t),n={status:"SUCCESS",element:{selector:r.addedEleSelector},changedItems:r.updatedSelectors||[]}}catch(a){n.status="ERROR",m.logger.log(a)}}e.reply(n),this.listenPageContentChange()}setMode(e,t){let i=t.payload.type,n=!0;this.domEditor.setMode(i),H()||(n=!1,this.domEditor.mode_type="VIEW"),e.reply({status:"SUCCESS",check_url:n})}resetElementSnapshot(e,t){try{let o=this,s=t.payload,r=[];this.domEditor.saveServerData(s),this.domEditor.restoreElements(),m.each(this.dynamicAddedElements,function(e){p(e)}),this.dynamicAddedElements=[];var i=[];m.each(s,function(e){let t=e.type,n=o.domEditor.getOriginDataBySelector(e.selector),s=n.ele;if("innerHtml"===t){var a=A(e,o.domEditor.config.attributes,o.domEditor);a.addedEleSelector&&o.dynamicAddedElements.push(a.addedEleSelector),i=a.updatedSelectors,n=o.domEditor.getOriginDataBySelector(e.selector),o.domEditor.editEleProps(e,n)}else if(s)o.domEditor.editEleProps(e,n);else if("globalScript"===t){var l={attr_value:e.id,text:e.props.text,attr_key:"sensors_ab_script_id"};C(l),D(l)}else if("globalStyle"===t){var d={attr_value:e.id,text:e.props.text,attr_key:"sensors_ab_style_id"};C(d),w(d)}else r.push(e)}),this.domEditor.resetSelectDivPostion(),this.domEditor.resetHoverDivPostion(),e.reply({status:"SUCCESS",no_found_list:r,changedItems:i})}catch(n){e.reply({status:"ERROR",error:n})}}markElement(e,t){let i=t.payload,n=this.domEditor.getOriginDataBySelector(i.selector).ele;if(n){let t=E(n);this.domEditor.setHoverElePostion(t),e.reply({status:"SUCCESS"})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}selectElement(e,t){let i=t.payload,n=this.domEditor.getOriginDataBySelector(i.selector),o=n.ele;if(o){let t=E(o);this.domEditor.setSelectElePostion(t),N(o);let i=n.eleInfo,s=this.domEditor.getServerDataBySelector(i.selector),r=m.extend(s||{isModify:!1},i);e.reply({status:"SUCCESS",element:r})}else e.reply({status:"ERROR",message:"\u8be5\u5143\u7d20\u672a\u5728\u5f53\u524d\u9875\u9762\u51fa\u73b0\uff01",code:"4001"})}addElementSnapshot(e,t){this.updateElementSnapshot(e,t)}deleteElementSnapshot(e,t){var i=this,n="SUCCESS";try{var o=this.domEditor.getModifiedEleSelectorsWhen(function(){let e=t.payload.selector;return!!e&&(p(e),i.dynamicAddedElements=i.dynamicAddedElements.filter(t=>t!==e),!0)})}catch(s){n="ERROR"}e.reply({status:n,changedItems:o})}getHtml(e){let t=document.getElementsByTagName("html")[0].outerHTML;t=t.replace(/class="sa-vabtest-mark"/g,'class="sa-vabtest-mark-hidden"'),e.reply({status:"SUCCESS",visual_dom:t,origin_url:location.href,dom_width:Math.max(document.body.scrollWidth,document.body.offsetWidth,document.documentElement.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth),dom_height:Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)})}cancelSelectElement(e){this.domEditor.resetSelectDivPostion(),e.reply({status:"SUCCESS"})}cancelMarkElement(e){this.domEditor.resetHoverDivPostion(),e.reply({status:"SUCCESS"})}checkUrl(e){let t=!0;H()||(t=!1,this.domEditor.mode_type="VIEW"),e.reply({status:t?"SUCCESS":"ERROR"})}searchElement(e,t){var i=[],n="SUCCESS";try{let e=t.payload,s=e.selector,r=e.limit;s=s.split(">").filter(e=>e).join(">");let a=Array.from(document.querySelectorAll(s)).filter(e=>"sa-vabtest-mark"!==e.id).slice(0,r);i=m.map(a,function(e){let t=(e.tagName||"").toLowerCase(),i=v(e);return{selector:i,type:"a"===t?"link":"img"===t?"img":e.hasAttribute("sensors_ab_widget")?"innerHtml":"text",tagName:t,hidden:k(i)}})}catch(o){n="ERROR",m.logger.log("\u641c\u7d22\u5143\u7d20\u5f02\u5e38\uff0c"+o.message)}e.reply({result:i,status:n})}mutationObserver(){let e=this;this.unListenPageContentChange(),m.each(e.domEditor.serverData,function(t){let i=e.domEditor.getOriginDataBySelector(t.selector);i.ele&&(O(i),e.domEditor.editEleProps(t,i))}),this.listenPageContentChange()}}class I{constructor(e){this.bridge=e.bridge,this.domEditor=e.domEditor,this.tagNames=e.tagNames,this.sd=e.sd}init(e){this.config=e,this.addLisenter()}addLisenter(){let e=this.config.action;e.KEY_DOWN&&m.addEvent(document.body,"keydown",this.keydownHandler.bind(this)),e.MOUSE_UP&&m.addEvent(document.body,"mouseup",this.mouseupHandler.bind(this)),e.WHEEL_EVENT&&m.addEvent(document.body,"wheel",this.wheelHandler.bind(this)),m.addEvent(document,"mousemove",this.moveHandler.bind(this)),m.addEvent(document,"click",this.clickHandler.bind(this),!0),this.sd.ee.spa.on("switch",this.singlePage.bind(this)),this.addInsertionErrorListener()}addInsertionErrorListener(){var e=this;window.sensorsABTestModifyListener=function(t,i){var n={type:t.type,id:t.id,isSuccess:!i};i&&(n.errorMessage=i),e.bridge.emit(a.insertionInfo,n)}}elementFilter(e){if(e){let t=e.tagName.toLowerCase();if(this.tagNames.indexOf(t)>-1){let i=this.domEditor.getAddedHtmlRoot(e);return i||("a"===t||"img"===t||"button"===t?e:this.domEditor.getOriginDataByElement(e).eleInfo.originProps.text?e:null)}}return null}getMouseElement(e){let t=null;return m.each(e,function(e){!t&&m.isString(e.className)&&-1===e.className.indexOf("sa-vabtest-mark")&&(t=e)}),t}moveHandler(e){try{let i=this.config.action;if(i.MOUSE_MOVE&&i.MOUSE_MOVE&&i.MOUSE_MOVE.eventValues&&m.isArray(i.MOUSE_MOVE.eventValues)){let t={};m.each(i.MOUSE_MOVE.eventValues,function(i){t[i]=e[i]}),this.bridge.emit(a.mousemoveEvent,t)}if("EDIT"!==this.domEditor.mode_type)return;let n=document.elementsFromPoint(e.clientX,e.clientY),o=this.getMouseElement(n),s=this.elementFilter(o);if(s){let e=E(s);this.domEditor.setHoverElePostion(e)}else this.domEditor.resetHoverDivPostion()}catch(t){}}clickHandler(e){if("EDIT"!==this.domEditor.mode_type)return;e.stopPropagation(),e.preventDefault();let t=document.elementsFromPoint(e.clientX,e.clientY),i=this.getMouseElement(t),n=this.elementFilter(i);if(n){let e=this.domEditor.getOriginDataByElement(n).eleInfo,t=e.selector,i=this.domEditor.getServerDataBySelector(t),o=m.extend(i||{isModify:!1},e),s=E(n);this.domEditor.setSelectElePostion(s),this.bridge.emit(a.selectElement,o)}else this.domEditor.resetSelectDivPostion(),this.bridge.emit(a.cancelSelectElement,{status:!0})}keydownHandler(e){try{let i={},n=this.config.action,o=(e.ctrlKey||e.metaKey?"cmd+":"")+e.key;"cmd+-"!==o&&"cmd+="!==o&&"Escape"!==o||(!0===n.KEY_DOWN.preventDefault&&e.preventDefault(),n.KEY_DOWN.eventValues&&m.isArray(n.KEY_DOWN.eventValues)&&m.each(n.KEY_DOWN.eventValues,function(t){i[t]=e[t]}),this.bridge.emit(a.keydownEvent,i))}catch(t){}}mouseupHandler(e){try{let i={},n=this.config.action;n.MOUSE_UP&&(!0===n.MOUSE_UP.preventDefault&&e.preventDefault(),n.MOUSE_UP.eventValues&&m.isArray(n.MOUSE_UP.eventValues)&&m.each(n.MOUSE_UP.eventValues,function(t){i[t]=e[t]}),this.bridge.emit(a.mouseupEvent,i))}catch(t){}}wheelHandler(e){try{let t={},i=this.config.action;i.WHEEL_EVENT&&(!0===i.WHEEL_EVENT.preventDefault&&e.preventDefault(),i.WHEEL_EVENT.eventValues&&m.isArray(i.WHEEL_EVENT.eventValues)&&m.each(i.WHEEL_EVENT.eventValues,function(i){t[i]=e[i]}),this.bridge.emit(a.wheelEvent,t))}catch(e){}}singlePage(e){if(e===location.href)return!1;let t=!0;H()||(t=!1,this.domEditor.mode_type="VIEW"),this.bridge.emit(a.checkUrl,{status:t?"SUCCESS":"ERROR"})}}class L{constructor(e){this.config=e.config,this.hoverDiv=null,this.selectDiv=null,this.maskDiv=null,this.mode_type="EDIT",this.serverData=[],this.originData=[],this.buildMarkDom()}setDomPostion(e,t){m.each(["width","height","left","top"],function(i){e.style[i]=t[i]+"px"}),e.style.zIndex=t.zIndex&&"auto"!==t.zIndex?Number(t.zIndex)+10:5e3}setHoverElePostion(e){this.selectDiv&&this.hoverDiv&&document.getElementById("sa-vabtest-mark")||this.buildMarkDom(),this.setDomPostion(this.hoverDiv,e)}setSelectElePostion(e){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.selectDiv,e)}restoreElements(){m.each(this.originData,function(e){O(e)}),this.originData=[],C({attr_key:"sensors_ab_style_id"}),C({attr_key:"sensors_ab_script_id"})}editEleProps(e,t){let i=t.eleInfo;_(t.ele,e,i)}setMode(e){this.mode_type=e,"VIEW"===e&&(p(this.maskDiv),this.hoverDiv=null,this.selectDiv=null,this.maskDiv=null)}resetMarkDom(e){e&&this.setDomPostion(e,{width:0,height:0,top:0,left:0})}resetSelectDivPostion(){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.selectDiv,{width:0,height:0,top:0,left:0})}resetHoverDivPostion(){this.selectDiv&&this.hoverDiv||this.buildMarkDom(),this.setDomPostion(this.hoverDiv,{width:0,height:0,top:0,left:0})}buildMarkDom(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),n=document.createElement("style");e.className="sa-vabtest-mark",e.id="sa-vabtest-mark",t.className="sa-vabtest-hover",i.className="sa-vabtest-clickable";var o=e.attachShadow({mode:"open"});n.innerText=".sa-vabtest-clickable { background: rgba(49, 112, 235, 0.15) !important; outline: 2px solid #3170EB !important; outline-offset: -2px !important; width: 0;height: 0;position: absolute; top: 0; left: 0;}.sa-vabtest-hover { outline: 2px solid #3170EB !important; outline-offset: -2px !important;  width: 0;height: 0;position: absolute; top: 0; left: 0;}",o.appendChild(n),o.appendChild(t),o.appendChild(i),document.body.appendChild(e),m.setCssStyle(".sa-vabtest-mark { pointer-events: none;}.sa-vabtest-mark-hidden { display: none;}"),this.hoverDiv=t,this.selectDiv=i,this.maskDiv=e}saveServerData(e){this.serverData=e}updataServerData(e,t){let i=!1,n=this;m.each(this.serverData,function(o,s){o.selector===e&&(n.serverData[s]=t,i=!0)}),i||this.serverData.push(t)}getServerDataBySelector(e){let t=null;return m.each(this.serverData,function(i){i.selector===e&&(t=i)}),t}setOriginData(e,t){let i=!1,n=this;m.each(this.originData,function(t,o){e===t.selector&&(n.originData[o]=t,i=!0)}),i||this.originData.push(t)}getOriginDataBySelector(e){let t=null;if(m.each(this.originData,function(i){e===i.eleInfo.selector&&(t=i)}),!t){let i=m.getDomBySelector(e);i?(t=T(i,this.config.styles,this.config.attributes),this.setOriginData(t.eleInfo.selector,t)):t={}}return t}getOriginDataByElement(e){let t=null;return m.each(this.originData,function(i){e===i.ele&&(t=i)}),t||(t=T(e,this.config.styles,this.config.attributes)),t}getModifiedEleSelectorsWhen(e){var t=[],i=[];if(m.each(this.serverData,function(e){let t=document.querySelector(e.selector);i.push([t,e])}),m.each(this.originData,function(e){let t=document.querySelector(e.eleInfo.selector);i.push([t,e.eleInfo])}),e&&e()){var n=new Map;m.each(i,function(e){var i=e[0],o=e[1],s=o.selector,r=v(i);r&&r!==s&&(o.selector=r,n.has(s)||(n.set(s,1),t.push({selectorFrom:s,selectorTo:r})))})}return t}getAddedHtmlRoot(e){const t=v(e).split(">");for(;t.length>0;){const e=document.querySelector(t.join(">"));if(e.hasAttribute("sensors_ab_widget"))return e;t.length-=1}return!1}}class x{constructor(){this.plugin_name="VABTest",this.plugin_version="1.27.3",this.abTestingSDK=null,this.bridge=new h({source:"sa-web-abtesting-sdk",frameSource:"sa-fe-abtesting-mode",version:"abtest_version"})}init(e,t){this.abTestingSDK=t.SensorsABTest;let i=this;if(e&&this.abTestingSDK){!function(e){e._.extend(m,e._)}(e),this.bridge.emit(a.connect,{status:!0,lib_version:3}).then(function(t){if("SUCCESS"===t.status){let n=t.payload.support;i.domEditor=new L({config:n}),i.sender=new I({bridge:i.bridge,domEditor:i.domEditor,tagNames:n.tagNames,sd:e}),new R({bridge:i.bridge,domEditor:i.domEditor}),i.sender.init(n)}else m.log("ABTesting SDK \u53ef\u89c6\u5316\u7f16\u8f91\u72b6\u6001\u521d\u59cb\u5316\u5931\u8d25")})}else m.log("ABTesting SDK \u53ef\u89c6\u5316\u7f16\u8f91\u72b6\u6001\u521d\u59cb\u5316\u5931\u8d25")}}let B=new x;B.__constructor__=x,window.SensorsDataWebJSSDKPlugin&&"[object Object]"===Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.VABTest=window.SensorsDataWebJSSDKPlugin.VABTest||B:window.SensorsDataWebJSSDKPlugin={VABTest:B}});