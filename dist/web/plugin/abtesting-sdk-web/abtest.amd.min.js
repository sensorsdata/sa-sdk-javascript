define(function(){"use strict";function t(t){this.SensorsABTest=t}function e(t){this.attr_name="sa-abtest-"+t,this.remove_timer=null,this.is_added=!1,this.is_abort=!1,this.is_timeout=!1,this.style_element=null,this.createMaskStyle()}function s(t){t._.extend(U,t._)}function i(t){this.SensorsABTest=t,this.para=t.para}function r(t){this.SensorsABTest=t,this.para=t.para}function n(t){this.sd=t.sd,this.abTest=t,this.events=[],this.isStart=!1,this.pause_sdk_before_trigger=!1}function a(t){this.SensorsABTest=t,this.isFirst=!0,this.start_time=null,this.mask_instance=null,this.is_filtered_out=!1,this.para={timeout:500,use_mask:!0,pass_params:!0,control_link_search:"default",experiment_link_search:"default",pause_sdk_before_trigger:!1}}function o(){if(!window.name)return!1;try{var t=JSON.parse(decodeURIComponent(window.name||"")),e=t.is_vabtesting,s=t.source_url,i=t.link_match_type;return!(e!==!0||!U.checkUrlIsMatch(s,i))||(U.log("A/B Testing SDK \u9875\u9762\u5730\u5740\uff0c\u4e0e\u5f53\u524d\u5b9e\u9a8c URL \u4e0d\u5339\u914d\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1)}catch(r){return!1}}function c(t){if(t)try{U.isString(t)&&(t=U.getDomBySelector(t)),t.parentNode&&t.parentNode.removeChild(t)}catch(e){U.logger.log("delete dom error:",e)}}function l(t){if(!t.parentNode)return-1;for(var e=0,s=t.tagName,i=t.parentNode.children,r=0;r<i.length;r++)if(i[r].tagName===s){if(t===i[r])return e;e++}return-1}function u(t){var e=t.parentNode&&9==t.parentNode.nodeType?-1:l(t);return t.getAttribute&&t.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id"))?"#"+t.getAttribute("id"):t.tagName.toLowerCase()+(~e?":nth-of-type("+(e+1)+")":"")}function h(t,e){if(!t||!t.parentNode||!t.parentNode.children)return!1;e=e&&e.join?e:[];var s=t.nodeName.toLowerCase();return t&&"body"!==s&&1==t.nodeType?(e.unshift(u(t)),t.getAttribute&&t.getAttribute("id")&&/^[A-Za-z][-A-Za-z0-9_:.]*$/.test(t.getAttribute("id"))?e.join(" > "):h(t.parentNode,e)):(e.unshift("body"),e.join(" > "))}function p(t){var e=t.getBoundingClientRect(),s=e.top+(document.body.scrollTop||document.documentElement.scrollTop),i=e.left+(document.body.scrollLeft||document.documentElement.scrollLeft),r=U.ry(t).getStyle("z-index")||0;return{width:e.width,height:e.height,top:s,left:i,zIndex:r}}function d(t,e){var s={};return U.each(e||[],function(e){var i=e.replace(/[A-Z]+/g,function(t){return"-"+t.toLowerCase()});s[e]=U.ry(t).getStyle(i)}),s}function _(t){var e=t.childNodes,s="",i=!1;return U.each(e,function(t){if(i===!1&&3===t.nodeType){var e=t.textContent||t.innerText||t.nodeValue||"";e&&(s=U.trim(e),i=!0)}}),s}function g(t){var e=t.match(/[\d.]+/g);if(e.length>=3){var s,i,r;return s=e[0],i=e[1],r=e[2],"rgb("+s+","+i+","+r+")"}return""}function f(t,e,s){var i=U.getUA(),r=i.ie&&i.ie<9,n="";U.each(e,function(t,e){r&&t.indexOf("rgba")>-1&&(t=g(t));var s=e.replace(/[A-Z]+/g,function(t){return"-"+t.toLowerCase()});n+=s+": "+t+" !important;"}),""!==n&&(s=U.encodeSelector(s),n="[sensors_ab_ele_style_id="+s+"]{"+n+"}",A({attr_value:s,text:n,attr_key:"sensors_ab_ele_style_id"}),t.setAttribute("sensors_ab_ele_style_id",s))}function m(t,e){var s=t.tagName,i=_(t);i!==e&&(t.textContent?t.textContent=e:t.innerText?t.innerText=e:t.innerHTML=e,"input"!==s&&"INPUT"!==s||(t.value=e||""))}function v(t,e){var s=t.originProps||{},i=e.originProps||{},r=s.attributes||{},n=i.attributes||{},a=!0;return s.text&&s.text!==i.text&&(a=!1),r&&U.each(["src","href","target","srcset"],function(t){r[t]&&r[t]!==n[t]&&(a=!1)}),a}function b(t,e,s){t.setAttribute(e,s)}function y(t,e){var s=e.originProps,i={attributes:{}},r=s.attributes;return U.each(r.style||{},function(e,s){i.attributes.style[s]=U.ry(t).getStyle(s)}),Object.hasOwnProperty.call(s,"text")&&(i.attributes.text=_(t)),U.each(["src","href"],function(e){Object.hasOwnProperty.call(r,e)&&(i.attributes[e]=t[e])}),Object.hasOwnProperty.call(r,"target")&&(i.attributes.target=t.getAttribute("target")),i}function S(t,e,s){s||(s=y(t,e));var i=v(e,s);if(i){var r=e.props;U.isObject(r)&&T(t,r,e)}return i}function T(t,e,s){if(Object.hasOwnProperty.call(e,"attributes")){var i=e.attributes;Object.hasOwnProperty.call(i,"style")&&f(t,i.style,s.selector),U.each(["href","target","src","srcset"],function(e){i[e]&&t.getAttribute(e)!==i[e]&&b(t,e,i[e])})}Object.hasOwnProperty.call(e,"text")&&"innerHtml"!==s.type&&m(t,e.text)}function A(t){try{var e=document.createElement("style");e.innerHTML=t.text,e.setAttribute(t.attr_key,t.attr_value),document.getElementsByTagName("head")[0].append(e)}catch(s){window.sensorsABTestModifyListener&&window.sensorsABTestModifyListener(t,s.stack||s.message)}}function B(t){try{var e=document.createElement("script");e.setAttribute(t.attr_key,t.attr_value),e.innerHTML="try{"+t.text+"}catch(e){ window.sensorsABTestModifyListener && window.sensorsABTestModifyListener("+JSON.stringify(t)+", e.stack || e.message) }",document.body.append(e)}catch(s){window.sensorsABTestModifyListener&&window.sensorsABTestModifyListener(t,s.stack||s.message)}}function k(t,e){U.loadScript(U.extend({success:function(){},error:function(){},type:"js",url:t},e))}function x(t){var e={childList:!0,subtree:!0},s=window.MutationObserver,i=new s(t);return i.observe(document.body,e),i}function w(t){t&&t.disconnect()}function D(t,e,s){var i=t.tagName.toLowerCase(),r=d(t,e),n={selector:h(t),originProps:{attributes:{style:r},text:_(t),hasChildren:t.children.length>0},type:"text",tagName:i};"a"===i&&(n.originProps.attributes.href=t.href,t.getAttribute("target")&&(n.originProps.attributes.target=t.getAttribute("target")),n.type="link"),"img"===i&&(n.originProps.attributes.src=t.src,n.originProps.attributes.srcset=t.srcset,n.type="img"),t.hasAttribute("sensors_ab_widget")&&(n.type="innerHtml");var a=t.getAttribute("style");if(s)for(var o=0;o<s.length;o++){var c=s[o],l=t.getAttribute(c);n.originProps.attributes[c]||null===l||void 0===l||(n.originProps.attributes[c]=l)}return{originStyle:a,eleInfo:n,ele:t}}function E(t){var e=t.eleInfo,s=t.ele;if(s){var i=e.originProps;if(Object.hasOwnProperty.call(i,"attributes")){var r=i.attributes;O({attr_value:U.encodeSelector(e.selector),attr_key:"sensors_ab_ele_style_id",ele:s}),U.each(["href","target","src","srcset"],function(t){r[t]&&s.getAttribute(t)!==r[t]&&b(s,t,r[t])})}Object.hasOwnProperty.call(i,"text")&&"innerHtml"!==e.type&&m(s,i.text)}}function O(t){var e=t.attr_value,s=t.attr_key,i=t.ele,r=document.querySelectorAll("["+s+"]");r&&r.length&&U.each(r,function(t){var i=t.getAttribute(s);t.parentElement&&(e===i||!e)&&["style","script"].indexOf(t.tagName.toLowerCase())>-1&&t.parentElement.removeChild(t)}),i&&s&&i.removeAttribute(s)}function L(t,e){var s=U.getDomBySelector(t.base),i=t.props.text,r=t.props.sensors_ab_widget,n=t.operation;if(!s)throw"VABTest: No base element";if(!s.parentNode)throw"base element parentNode not found";var a=document.createElement("font");if("text"===r&&(a.innerText=i),"html"===r&&(a.innerHTML=i),P(a,t,e),"BEFORE_INSERTION"===n)s.parentNode.insertBefore(a,s);else{if("AFTER_INSERTION"!==n)throw"operation not supported";s.nextSibling?s.parentNode.insertBefore(a,s.nextSibling):s.parentNode.appendChild(a)}var o=h(a);return o}function j(t,e){var s=t.selector,i=t.props.text,r="text"===t.props.sensors_ab_widget;const n=document.querySelector(s);if(!n)throw"element not found:"+s;r?n.innerText=i:n.innerHTML=i,P(n,t,e)}function N(t,e,s){function i(){return r=L(t,e)}var r=null,n=null,a=U.getDomBySelector(t.selector)||document.querySelector&&document.querySelector(t.selector);if(a&&a.hasAttribute("sensors_ab_widget")){j(t,e);var o=p(document.querySelector(t.selector));s&&s.setSelectElePostion(o)}else s?n=s.getModifiedEleSelectorsWhen(i):i();return{selector:t.selector,addedEleSelector:r,updatedSelectors:n}}function P(t,e,s){if(s&&s.length)for(var i=0;i<s.length;i++)"text"!==s[i]&&void 0!==e.props[s[i]]&&t.setAttribute(s[i],e.props[s[i]]);if(s===!0)for(var r in e.props)"text"!==r&&t.setAttribute(r,e.props[r])}function C(t){this.SensorsABTest=t,this.enable_visualize=!1,this.vabtest_url=location.protocol+"//static.sensorsdata.cn/sdk/plugin/vabtest/"+this.SensorsABTest.lib_version+"/vabtest.min.js",this.timeout=500,this.is_editor=!1,this.use_mask=!0,this.originData=[],this.visualExp=null,this.isFirst=!0,this.start_time=null,this.is_have_observer=!1,this.imgLoadingList=[],this.isTrigger=!1,this.isDomReady=!1,this.loadedImages=[],this.dynamicAddedElements=[]}function R(){this.lib_version="1.27.3",this.plugin_version="1.27.3",this.plugin_name="SensorsABTest",this.para={},this.default_para={url:"",path:"",project_key:"",timeout_milliseconds:3e3,update_interval:6e5,collect_bridge_status:!0,encrypt_cookie:!1},this.state={platform:"",storage:{name:"sawebjssdkabtest",latest_name:"sawebjssdkabtestlatest"}},this.bridgeState="",this.codeExpData={},this.results=[],this.out_list=[],this.triggerList={},this.outTriggerList={},this.default_track_config={trigger_switch:!0,property_set_switch:!1,trigger_content_ext:["abtest_experiment_version","abtest_experiment_result_id"]},this.track_config={},this.updateTime=null,this.sd=null,this.link=new a(this),this.vabtest=new C(this),this.normalStore=new i(this),this.bridgeStore=new r(this),this.verifyStore=new U.VerifyStore(this)}function F(t,e){var s=[];U.isArray(t)&&U.each(t,function(e,s){U.isString(e)&&t.splice(s,1,{experiment_id:e})});var i=e.abtest_experiment_id;if(U.isString(i)){var r={experiment_id:i,group_id:e.abtest_experiment_group_id,result_id:e.abtest_experiment_result_id};if(t&&U.isArray(t)){var n=!1;U.each(t,function(e,s){e.experiment_id===i&&(t.splice(s,1,r),n=!0)}),n||t.push(r)}else t=[r];s=t}return s}function I(t){this.SensorsABTest=t}function H(t){this.SensorsABTest=t}function M(t,e){return t?(this.sd=t,s(t),U.isObject(e)?(U.localStorage.isSupport()||this.log("localstorage\u5f02\u5e38"),this.abtestingPara=e,this.fetchData=new I(this),this.store=new H(this),void this.initTest()):(this.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684\u521d\u59cb\u5316\u53c2\u6570!para:",e),!1)):(this.log("A/B Testing \u521d\u59cb\u5316\u5931\u8d25,Web JS SDK \u6ca1\u6709\u521d\u59cb\u5316\u5b8c\u6210"),!1)}var U={};U.secCheck={isHttpUrl:function(t){if("string"!=typeof t)return!1;var e=/^https?:\/\/.+/;return e.test(t)!==!1||(U.log("Invalid URL"),!1)},removeScriptProtocol:function(t){if("string"!=typeof t)return"";for(var e=/^\s*javascript/i;e.test(t);)t=t.replace(e,"");return t}},U.checkUrlIsMatch=function(t,e){var s,i,r=U.URL(t);if("STRICT"===e)return location.href===r.href;if("FUZZY"===e){try{s=U.URL(location.href)}catch(n){return U.log("url \u89e3\u6790\u5931\u8d25",n),!1}try{i=U.URL(t)}catch(n){return U.log("control_url \u89e3\u6790\u5931\u8d25",n),!1}return s.host===i.host&&s.pathname===i.pathname}return U.log("link_match_type\u5b57\u6bb5\u5f02\u5e38",e),!1},U.checkUrlIsRegexp=function(t,e){var s;try{s=U.URL(location.href)}catch(i){return U.log("url \u89e3\u6790\u5931\u8d25",i),!1}try{var r=e?new RegExp(t,e):new RegExp(t),n=r.exec(s.href);return!!n}catch(i){return U.log("control_link\u5b57\u6bb5\u5f02\u5e38",i),!1}},U.log=function(){if("object"==typeof console&&console.log){U.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]);try{return console.log.apply(console,arguments)}catch(t){console.log(arguments[0])}}},U.error=function(){if("object"==typeof console&&console.error)try{return console.error.apply(console,arguments)}catch(t){console.error(arguments[0])}},U.encodeSelector=function(t){return U.base64Encode(t).replace(/[+\/=]/g,function(t){return"_"})},t.prototype={value_type_list:["Number","String","Object","Boolean"],regName:/^((?!^distinct_id$|^original_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_tag.*|^user_group.*)[a-zA-Z_][a-zA-Z\d_]*)$/i,valueType:function(t,e){switch(e){case"Number":if(U.isNumber(t))return!0;break;case"String":if(U.isString(t))return!0;break;case"Object":if(U.isObject(t))return!0;break;case"Boolean":if(t===!0||t===!1)return!0;break;default:return!1}return!1},para:function(t,e,s){var i=this,r={verify_success:!0,para:null};return U.each(s,function(s,n){if("essential"===s)switch(n){case"param_name":U.isString(e.param_name)&&e.param_name.length>0||(i.SensorsABTest.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cparam_name\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e\uff01param_name:",e.param_name),r.verify_success=!1);break;case"value_type":U.isString(e.value_type)&&U.indexOf(i.value_type_list,e.value_type)!==-1||(i.SensorsABTest.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cvalue_type\u914d\u7f6e\u9519\u8bef",e.value_type),r.verify_success=!1);break;case"default_value":"undefined"==typeof e.default_value?(i.SensorsABTest.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u53c2\u6570\u672a\u914d\u7f6e"),r.verify_success=!1):i.valueType(e.default_value,e.value_type)||(i.SensorsABTest.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0cdefault_value\u7c7b\u578b\u5fc5\u987b\u4e0evalue_type\u4e00\u81f4\uff01",e.default_value,e.value_type),r.verify_success=!1);break;case"callback":U.isFunction(e.callback)||(i.SensorsABTest.log(t+"\u65b9\u6cd5\u8c03\u7528\u5931\u8d25\uff0ccallback\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),r.verify_success=!1);break;default:r.verify_success=!1}else if("not_essential"===s)switch(n){case"timeout_milliseconds":e.timeout_milliseconds=e.timeout_milliseconds||i.SensorsABTest.para.timeout_milliseconds||i.SensorsABTest.default_para.timeout_milliseconds,(!U.isNumber(e.timeout_milliseconds)||U.isNumber(e.timeout_milliseconds)&&e.timeout_milliseconds<=0)&&(i.SensorsABTest.log("timeout_milliseconds \u53c2\u6570\u9519\u8bef",e.timeout_milliseconds),e.timeout_milliseconds=i.SensorsABTest.para.timeout_milliseconds),e.timeout_milliseconds<200&&(e.timeout_milliseconds=200);break;case"properties":e.properties=U.isObject(e.properties)?e.properties:{}}}),r.para=e,r},resolveCustomProperties:function(t){var e=this,s={verify_success:!0,para:null},i=t.custom_properties;if(!U.isObject(i)||U.isEmptyObject(i))return delete t.custom_properties,s.para=t,s;if(U.each(i,function(t,i){if((!U.isString(i)||!e.regName.test(i)||i.length>100)&&(e.SensorsABTest.log(" property name [ "+i+" ] is not invalid "),s.verify_success=!1),(U.isString(t)||U.isNumber(t)||U.isBoolean(t)||U.isArray(t)||U.isDate(t))&&!(U.isString(t)&&t.length>500)||(e.SensorsABTest.log("property [ "+i+" ] of value [ "+JSON.stringify(t)+" ] is not invalid"),s.verify_success=!1),U.isArray(t)){var r=!0;U.each(t,function(t){r!==!1&&(U.isString(t)||(r=!1))}),r||(e.SensorsABTest.log("property  value type can be array, but only allow string item. property [ "+i+" ] of value  "+JSON.stringify(t)+"  is not invalid"),s.verify_success=!1)}}),s.verify_success===!0){var r={};U.each(i,function(t,e){U.isDate(t)?r[e]=U.formatDate(t):U.isString(t)?r[e]=t:r[e]=JSON.stringify(t)}),t.custom_properties=r}return s.para=t,s}},U.VerifyStore=t,U.listenPageState=function(t){var e={visibleHandle:U.isFunction(t.visible)?t.visible:function(){},hiddenHandler:U.isFunction(t.hidden)?t.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var t=this;document.addEventListener(t.visibilityChange,function(){document[t.hidden]?t.hiddenHandler():t.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}};e.init()},U.listenPageState=function(t){var e={visibleHandle:U.isFunction(t.visible)?t.visible:function(){},hiddenHandler:U.isFunction(t.hidden)?t.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return"undefined"!=typeof document[this.hidden]},init:function(){"undefined"!=typeof document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var t=this;document.addEventListener(t.visibilityChange,function(){document[t.hidden]?t.hiddenHandler():t.visibleHandle()},1)}else document.addEventListener?(window.addEventListener("focus",this.visibleHandle,1),window.addEventListener("blur",this.hiddenHandler,1)):(document.attachEvent("onfocusin",this.visibleHandle),document.attachEvent("onfocusout",this.hiddenHandler))}};e.init()},U.getStorageData=function(t,e){var s=U.localStorage.get(t);U.isString(s)&&(s=e.kit.userDecryptIfNeeded(s));try{s=JSON.parse(s)}catch(i){U.log(i)}return s},U.setStorageData=function(t,e,s){t=JSON.stringify(t),s&&(t=U.userEncrypt(t)),U.localStorage.set(e,t)},e.prototype={createMaskStyle:function(){var t="["+this.attr_name+"],["+this.attr_name+"] body{opacity:0 !important;-khtml-opacity:0 !important;-moz-opacity:0;filter:alpha(opacity=0);}",e=document.createElement("style");e.type="text/css";try{e.appendChild(document.createTextNode(t))}catch(s){e.styleSheet.cssText=t}try{this.style_element=e,document.getElementsByTagName("head")[0].appendChild(e)}catch(s){U.log("error when create calls")}},show:function(t){try{var e=this;if(this.is_abort)return!1;var s=null;if(s=document.getElementsByTagName("html")[0],!U.isElement(s))return;s.setAttribute(this.attr_name,"1"),this.is_added=!0,U.isNumber(t)&&(this.remove_timer=setTimeout(function(){e.is_timeout=!0,e.remove()},t))}catch(i){U.log("error when show calls")}},remove:function(){try{if(this.is_abort||(this.is_abort=!0),this.is_added){this.is_added=!1;var t=null;if(t=document.getElementsByTagName("html")[0],!U.isElement(t))return;t.removeAttribute(this.attr_name),this.style_element&&(document.getElementsByTagName("head")[0].removeChild(this.style_element),this.style_element=null)}this.remove_timer&&(clearTimeout(this.remove_timer),this.remove_timer=null)}catch(e){U.log("error when remove calls")}}},U.Mask=e,i.prototype={init:function(t){return!!this.setPara(t)&&(this.bridgeState="ab_no_host_bridge",/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?this.SensorsABTest.state.platform="H5":this.SensorsABTest.state.platform="Web",this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f\uff0c\u8bd5\u9a8c URL\uff1a",t.url),this.SensorsABTest.checkSADebug(),void this.SensorsABTest.store.init(this.getResultFromServer,this))},setPara:function(t){if(!U.isString(t.url)||"http"!==t.url.slice(0,4))return this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff01"),!1;if("https"===location.protocol.slice(0,5)&&"http:"===t.url.slice(0,5))return this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0chttps \u9875\u9762\u5fc5\u987b\u4f7f\u7528 https \u7684 URL"),!1;var e=U.getQueryParam(t.url,"project-key");if(!e)return this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f7f\u7528\u6b63\u786e\u7684 URL\uff08\u5fc5\u987b\u5305\u542b project-key\uff09\uff01"),!1;t.project_key=e;var s=this.SensorsABTest.verifyStore.para("A/B Testing SDK \u521d\u59cb\u5316",t,{timeout_milliseconds:"not_essential"});return this.SensorsABTest.para=U.extend({},this.SensorsABTest.default_para,s.para),U.isBoolean(this.SensorsABTest.para.collect_bridge_status)||(this.SensorsABTest.para.collect_bridge_status=!0),U.isNumber(this.SensorsABTest.para.update_interval)||(this.SensorsABTest.para.update_interval=6e5),this.SensorsABTest.sd.para.encrypt_cookie===!0&&(this.SensorsABTest.para.encrypt_cookie=!0),this.SensorsABTest.sd.para.sdk_id&&(this.SensorsABTest.state.storage.name+="_"+this.SensorsABTest.sd.para.sdk_id),!0},asyncFetch:function(t){var e=this;this.SensorsABTest.normalStore.getCodeExpResultFromServer({para:t,suc:function(s){if(U.isObject(s)&&"SUCCESS"===s.status){var i=e.SensorsABTest.getExpResult(t);t.callback(i)}else t.callback(t.default_value)},err:function(){t.callback(t.default_value)}})},creatRequestData:function(t){var e="";U.isEmptyObject(this.SensorsABTest.sd.store._state)||(e=this.SensorsABTest.sd.store._state._first_id||this.SensorsABTest.sd.store._state.first_id||this.SensorsABTest.sd.store._state._distinct_id||this.SensorsABTest.sd.store._state.distinct_id);var s={anonymous_id:e,platform:this.SensorsABTest.state.platform,abtest_lib_version:this.SensorsABTest.lib_version,properties:{$is_first_day:this.SensorsABTest.sd._.cookie.getNewUser()}};return U.isObject(t.properties)&&(s.properties=U.extend({},s.properties,t.properties)),U.isObject(t.custom_properties)&&(s.custom_properties=U.extend({},t.custom_properties),s.param_name=t.param_name),this.SensorsABTest.sd.store._state.first_id&&(s.login_id=this.SensorsABTest.sd.store.getDistinctId()),s},getCodeExpResultFromServer:function(t){this.getResultFromServer(t,!0)},getResultFromServer:function(t,e){function s(){var t=i.SensorsABTest.sd.store.getDistinctId();i.SensorsABTest.sd._.ajax({url:i.SensorsABTest.para.url,type:"POST",data:JSON.stringify(o),credentials:!1,contentType:"application/json",timeout:r.timeout_milliseconds||i.SensorsABTest.para.timeout_milliseconds,cors:!0,success:function(s){e?i.SensorsABTest.dealCodeExpResponseData(s,t):i.SensorsABTest.dealResponseData(s,t),n&&n(s),i.SensorsABTest.fetchData.setNextFetch()},error:function(t){i.SensorsABTest.log("\u670d\u52a1\u7aef\u8bf7\u6c42\u53d1\u9001\u5931\u8d25",t),a&&a(),i.SensorsABTest.fetchData.setNextFetch()}})}var i=this;t=U.isObject(t)?t:{};var r=t.para||{};e?r.custom_properties=U.extend({},this.SensorsABTest.abtestingPara.custom_properties,r.custom_properties):r.custom_properties=this.SensorsABTest.abtestingPara.custom_properties;var n=t.suc,a=t.err,o=this.creatRequestData(r);this.SensorsABTest.log("\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),s()}},i.prototype.methods={asyncFetchABTest:function(t){if(!U.isObject(t))return this.SensorsABTest.log("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=this.SensorsABTest.verifyStore.para("asyncFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var s=this.SensorsABTest.verifyStore.resolveCustomProperties(t);if(!s.verify_success)return void t.callback(t.default_value);t=s.para,this.SensorsABTest.normalStore.asyncFetch(t)}},fastFetchABTest:function(t){if(!U.isObject(t))return this.SensorsABTest.log("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=this.SensorsABTest.verifyStore.para("fastFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var s=this.SensorsABTest.searchLocalExp(t.param_name);if(U.isObject(s)){var i=this.SensorsABTest.getExpResult(t,s);return void t.callback(i)}var r=this.SensorsABTest.verifyStore.resolveCustomProperties(t);if(!r.verify_success)return void t.callback(t.default_value);t=r.para,this.SensorsABTest.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),this.SensorsABTest.normalStore.asyncFetch(t)}},fetchCacheABTest:function(t){if(!U.isObject(t))return void this.SensorsABTest.log("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var e=this.SensorsABTest.verifyStore.para("fetchCacheABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential"});if(e.verify_success)return this.SensorsABTest.getExpResult(e.para)}},r.prototype={init:function(t){var e=this;return this.SensorsABTest.state.storage.name="sawebjssdkabtest_bridge",!!this.setPara(t)&&(this.SensorsABTest.log("A/B Testing SDK \u521d\u59cb\u5316\u6210\u529f"),this.abBridge=new this.SensorsABTest.sd.JSBridge({type:"abtest",app_call_js:function(t){try{t=U.base64Decode(t)}catch(s){e.SensorsABTest.log("App\u6570\u636ebase64\u89e3\u7801\u5f02\u5e38",t)}try{t=JSON.parse(t),t.message_id&&this["double"](t)}catch(s){e.SensorsABTest.log("App\u6570\u636e\u89e3\u6790\u5f02\u5e38",t)}}}),U.isObject(window.SensorsData_iOS_JS_Bridge)&&window.SensorsData_iOS_JS_Bridge.sensorsdata_abtest_module&&this.abBridge.hasAppBridge()?this.SensorsABTest.bridgeState="ab_bridge_ok":U.isObject(window.SensorsData_APP_New_H5_Bridge)&&U.isFunction(window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module)&&window.SensorsData_APP_New_H5_Bridge.sensorsdata_abtest_module()&&this.abBridge.hasAppBridge()?this.SensorsABTest.bridgeState="ab_bridge_ok":this.SensorsABTest.bridgeState="ab_no_abtest_bridge",void this.SensorsABTest.store.init(this.getResultFromApp,this))},setPara:function(t){var e=this.SensorsABTest.verifyStore.para("\u6253\u901a\u521d\u59cb\u5316",t,{timeout_milliseconds:"not_essential"});return this.SensorsABTest.para=U.extend({},this.SensorsABTest.default_para,e.para),U.isBoolean(this.SensorsABTest.para.collect_bridge_status)||(this.SensorsABTest.para.collect_bridge_status=!0),U.isNumber(this.SensorsABTest.para.update_interval)||(this.SensorsABTest.para.update_interval=6e5),this.SensorsABTest.sd.para.encrypt_cookie===!0&&(this.SensorsABTest.para.encrypt_cookie=!0),this.SensorsABTest.sd.para.sdk_id&&(this.SensorsABTest.state.storage.name+="_"+this.SensorsABTest.sd.para.sdk_id),!0},getResultFromApp:function(t,e){function s(){"ab_bridge_ok"===i.SensorsABTest.bridgeState?i.abBridge.requestToApp({data:{properties:r.properties,timeout:o,request_body:c},callback:function(t){U.isObject(t)&&U.isObject(t.data)?(i.SensorsABTest.log("\u6210\u529f\u83b7\u53d6\u5230 App \u7aef\u8fd4\u56de\u7684\u8bd5\u9a8c\u6570\u636e","data:",t),i.SensorsABTest.dealResponseData(t.data),n&&n(t)):(i.SensorsABTest.log("App \u7aef\u8bf7\u6c42\u5931\u8d25"),a&&a()),i.SensorsABTest.fetchData.setNextFetch()},timeout:{time:o,callback:function(){i.SensorsABTest.log("\u83b7\u53d6App\u7aef\u6570\u636e\u5931\u8d25"),a&&a(),i.SensorsABTest.fetchData.setNextFetch()}}}):a&&(i.SensorsABTest.log("A/B Testing \u6253\u901a\u5931\u8d25\uff0c",i.SensorsABTest.bridgeState),a())}var i=this;t=U.isObject(t)?t:{};var r=t.para||{};e?r.custom_properties=U.extend({},this.SensorsABTest.abtestingPara.custom_properties,r.custom_properties):r.custom_properties=this.SensorsABTest.abtestingPara.custom_properties;var n=t.suc,a=t.err,o=r.timeout_milliseconds||this.SensorsABTest.para.timeout_milliseconds,c={origin_platform:"H5"};U.isObject(r.custom_properties)&&(c=U.extend(c,{custom_properties:r.custom_properties,param_name:r.param_name})),this.SensorsABTest.log("\u5411App\u53d1\u8d77\u8bd5\u9a8c\u8bf7\u6c42"),s()},asyncFetch:function(t){var e=this;this.SensorsABTest.bridgeStore.getResultFromApp({para:t,suc:function(s){if(U.isObject(s.properties)&&(t.properties=U.extend(s.properties,t.properties)),"SUCCESS"===s.data.status){var i=e.SensorsABTest.getExpResult(t);t.callback(i)}else t.callback(t.default_value)},err:function(){t.callback(t.default_value)}},!0)}},r.prototype.methods={asyncFetchABTest:function(t){if(!U.isObject(t))return this.SensorsABTest.log("asyncFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=this.SensorsABTest.verifyStore.para("asyncFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var s=this.SensorsABTest.verifyStore.resolveCustomProperties(t);return s.verify_success?(t=s.para,"ab_bridge_ok"!==this.SensorsABTest.bridgeState?void t.callback(t.default_value):void this.SensorsABTest.bridgeStore.asyncFetch(t)):void t.callback(t.default_value)}},fastFetchABTest:function(t){if(!U.isObject(t))return this.SensorsABTest.log("fastFetchABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e"),!1;var e=this.SensorsABTest.verifyStore.para("fastFetchABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential",callback:"essential",timeout_milliseconds:"not_essential",properties:"not_essential"});if(e.verify_success){t=e.para;var s=this.SensorsABTest.searchLocalExp(t.param_name);if(U.isObject(s)){var i=this.SensorsABTest.getExpResult(t,s);return void t.callback(i)}var r=this.SensorsABTest.verifyStore.resolveCustomProperties(t);if(!r.verify_success)return void t.callback(t.default_value);if(t=r.para,"ab_bridge_ok"!==this.SensorsABTest.bridgeState)return void t.callback(t.default_value);this.SensorsABTest.log("fastFetchABTest\u7f13\u5b58\u4e2d\u672a\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u53d1\u8d77\u8bf7\u6c42"),this.SensorsABTest.bridgeStore.asyncFetch(t)}},fetchCacheABTest:function(t){if(!U.isObject(t))return void this.SensorsABTest.log("fetchCacheABTest\u8c03\u7528\u5931\u8d25\uff0c\u53c2\u6570\u672a\u6b63\u786e\u914d\u7f6e");var e=this.SensorsABTest.verifyStore.para("fetchCacheABTest",t,{param_name:"essential",value_type:"essential",default_value:"essential"});if(e.verify_success)return this.SensorsABTest.getExpResult(e.para)}},n.prototype.init=function(t){if(this.pause_sdk_before_trigger=t.pause_sdk_before_trigger||!1,t.pause_sdk_before_trigger===!0){var e=this;this.sd.registerInterceptor("sendDataStage",{send:{priority:0,entry:function(t,s){e.sendInterceptor(t,s)}}})}},n.prototype.start=function(){this.pause_sdk_before_trigger!==!1&&(this.events=[],this.isStart=!0)},n.prototype.stop=function(){if(this.pause_sdk_before_trigger!==!1){this.isStart=!1;var t=this;U.each(this.events,function(e){e._flush_time=(new Date).getTime(),t.sd.kit.sendData(e)}),this.events=[]}},n.prototype.sendInterceptor=function(t,e){var s=t.data,i=s.event,r=s.type;return this.isStart===!0&&"track"===r&&["$ABTestTrigger","WebABTestTrigger"].indexOf(i)<0&&(this.events.push(s),e.cancellationToken.stop()),t},a.prototype.init=function(t){return this.initPara(t),this.para?(this.eventInterceptor=new n(this.SensorsABTest),this.eventInterceptor.init(this.para),this.eventInterceptor.start(),U.getQueryParam(location.href,"saSDKMultilink")?(this.is_filtered_out=!0,!1):(this.start_time=(new Date).getTime(),this.para.use_mask&&this.initMask(),void this.addSinglePageListener())):(this.SensorsABTest.log("multilink is closed"),!1)},a.prototype.addSinglePageListener=function(){var t=this;this.SensorsABTest.sd.ee.spa.prepend("switch",function(e){return e!==location.href&&(t.is_filtered_out=!1,t.isFirst=!0,t.mask_instance&&t.mask_instance.remove(),U.getQueryParam(location.href,"saSDKMultilink")?(t.is_filtered_out=!0,!1):(t.eventInterceptor&&t.eventInterceptor.start(),t.start_time=(new Date).getTime(),t.para.use_mask&&t.initMask(),void t.resolve()))})},a.prototype.initMask=function(){this.mask_instance=new U.Mask("link_"+this.SensorsABTest.sd.para.sdk_id),this.mask_instance.show(this.para.timeout)},a.prototype.initPara=function(t){if(U.isFunction(t))try{t=t()}catch(e){return this.SensorsABTest.log("link para error!"),void(this.para=!1)}t===!1?this.para=!1:U.isObject(t)&&(this.para.timeout=U.isNumber(t.timeout)&&t.timeout>=0?t.timeout:500,this.para.use_mask=U.isBoolean(t.use_mask)?t.use_mask:this.para.use_mask,this.para.control_link_search=U.isString(t.control_link_search)?t.control_link_search:"default",this.para.experiment_link_search=U.isString(t.experiment_link_search)?t.experiment_link_search:"default",this.para.pass_params=!U.isBoolean(t.pass_params)||t.pass_params,this.para.onRedirect=U.isFunction(t.onRedirect)?t.onRedirect:null,this.para.pause_sdk_before_trigger=!!U.isBoolean(t.pause_sdk_before_trigger)&&t.pause_sdk_before_trigger)},a.prototype.resolve=function(){var t=this.SensorsABTest.results,e=this;if(!this.para||!U.isArray(t)||this.is_filtered_out||!this.isFirst||0===this.para.timeout)return this.eventInterceptor&&this.eventInterceptor.stop(),!1;if((new Date).getTime()-this.start_time>this.para.timeout)return this.SensorsABTest.log("The multilink was stopped because the request timeout"),this.eventInterceptor&&this.eventInterceptor.stop(),!1;this.isFirst=!1;var s=!1;U.each(t,function(t){return!(!U.isObject(t)||s||"LINK"!==t.experiment_type)&&void(e.isTriggerLinkExp(t)&&(s=!0,e.SensorsABTest.trackOutTestTrigger("LINK"),e.redirectUrl(t)))}),!s&&this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),!s&&this.eventInterceptor&&this.eventInterceptor.stop()},a.prototype.stopTrigger=function(){this.isFirst!==!1&&(this.isFirst=!1,this.SensorsABTest.log("The multilink was stopped because the request failed"),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),this.eventInterceptor&&this.eventInterceptor.stop())},a.prototype.isTriggerLinkExp=function(t){return U.isString(t.control_link)&&U.isString(t.link_match_type)?"REGEXP"===t.link_match_type?!!U.checkUrlIsRegexp(t.control_link,t.regexp_flags)||(this.SensorsABTest.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):!!U.checkUrlIsMatch(t.control_link,t.link_match_type)||(this.SensorsABTest.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):(this.SensorsABTest.log("\u591a\u94fe\u63a5\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",t.abtest_experiment_id),!1)},a.prototype.redirectUrl=function(t){
function e(t){return U.secCheck.isHttpUrl(t)?U.secCheck.removeScriptProtocol(t):(this.SensorsABTest.log("\u975e\u6cd5URL"),!1)}if(!t.experiment_link||!U.isString(t.experiment_link))return this.SensorsABTest.log("\u9875\u9762\u8df3\u8f6c\u5931\u8d25\uff0cexperiment_link\u5b57\u6bb5\u5f02\u5e38",t.abtest_experiment_id),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),void(this.eventInterceptor&&this.eventInterceptor.stop());if(t.is_control_group===!0&&("STRICT"===t.link_match_type||"REGEXP"===t.link_match_type))return this.SensorsABTest.triggerHandle(t),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove(),void(this.eventInterceptor&&this.eventInterceptor.stop());var s=location.href,i=t.experiment_link,r=/\$\d+/;if("REGEXP"===t.link_match_type&&r.test(i)){var n=t.regexp_flags?new RegExp(t.control_link,t.regexp_flags):new RegExp(t.control_link);i=s.replace(n,i)}var a,o;if(this.para.pass_params?(o=this.getMergedUrl(t.is_control_group,i,s),a=e(o)):(o=this.getMergedUrl(t.is_control_group,i),a=e(o)),a){var c=this.SensorsABTest.triggerHandle(t),l=c?80:0;this.para.onRedirect?(this.para.onRedirect(a),this.para.use_mask&&this.mask_instance&&this.mask_instance.remove()):this.redirect(a,l),this.mask_instance&&this.mask_instance.remove_timer&&clearTimeout(this.mask_instance.remove_timer)}},a.prototype.redirect=function(t,e){setTimeout(function(){location.href=t},e)},a.prototype.getMergedUrl=function(t,e,s){function i(t){var e=/([^?#]+)(\?[^#]*)?(#.*)?/,s=e.exec(t);if(s){var i=s[1]||"",r=s[2]||"",n=s[3]||"";return{host:i,search:r,hash:n}}}function r(t){var e={hash:"",search:""};if(!U.isString(t))return e;var s=t.indexOf("?");return s>-1?(e.search=t.slice(s),e.hash=t.slice(0,s)):e.hash=t,e}var n="",a="",o="",c={parse_url:null,search:""},l={parse_url:null,search:"",hash:""};return s&&(c.parse_url=i(s),!c.parse_url)?void this.SensorsABTest.log("url \u89e3\u6790\u5931\u8d25",s):(l.parse_url=i(e),l.parse_url?(s&&("after_hash"===this.para.control_link_search?c.search=r(c.parse_url.hash).search:c.search=c.parse_url.search),t?"after_hash"===this.para.control_link_search?(l.search=r(l.parse_url.hash).search,l.hash=r(l.parse_url.hash).hash):l.search=l.parse_url.search:"after_hash"===this.para.experiment_link_search?(l.search=r(l.parse_url.hash).search,l.hash=r(l.parse_url.hash).hash):l.search=l.parse_url.search,a=s?this.getSearchStr(c.search,l.search):this.getSearchStr(l.search),t&&"after_hash"===this.para.control_link_search||!t&&"after_hash"===this.para.experiment_link_search?n=l.hash.length>0?l.parse_url.host+l.parse_url.search+l.hash+a:l.parse_url.search.length>0?l.parse_url.host+l.parse_url.search+"&"+a.substring(1):l.parse_url.host+a:(o="after_hash"===this.para.control_link_search?l.parse_url.hash:s?l.parse_url.hash||c.parse_url.hash:l.parse_url.hash,n=l.parse_url.host+a+o),n):void this.SensorsABTest.log("url \u89e3\u6790\u5931\u8d25",e))},a.prototype.getSearchStr=function(t,e){var s=U.getQueryParamsFromUrl(t),i=U.getQueryParamsFromUrl(e),r=U.extend(s,i),n="";if(U.isEmptyObject(r))return"?saSDKMultilink=true";var a=!0;for(var o in r)a?(n+="?",a=!1):n+="&",null!==r[o]?n=n+o+"="+r[o]:n+=o;return n+="&saSDKMultilink=true"},window.MutationObserver||(window.MutationObserver=function(t){function e(t){this._watched=[],this._listener=t}function s(t){!function s(){var i=t.takeRecords();i.length&&t._listener(i,t),t._timeout=setTimeout(s,e._period)}()}function i(e){var s={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null};for(var i in e)g(s,i)&&e[i]!==t&&(s[i]=e[i]);return s}function r(t,e){var s=l(t,e);return function(r){var n,a=r.length;e.charData&&3===t.nodeType&&t.nodeValue!==s.charData&&r.push(new i({type:"characterData",target:t,oldValue:s.charData})),e.attr&&s.attr&&o(r,t,s.attr,e.afilter),(e.kids||e.descendents)&&(n=c(r,t,s,e)),(n||r.length!==a)&&(s=l(t,e))}}function n(t,e){return e.value}function a(t,e){return"style"!==e.name?e.value:t.style.cssText}function o(t,e,s,r){for(var n,a,o={},c=e.attributes,l=c.length;l--;)n=c[l],a=n.name,r&&!g(r,a)||(v(e,n)!==s[a]&&t.push(i({type:"attributes",target:e,attributeName:a,oldValue:s[a],attributeNamespace:n.namespaceURI})),o[a]=!0);for(a in s)o[a]||t.push(i({target:e,type:"attributes",attributeName:a,oldValue:s[a]}))}function c(e,s,r,n){function a(t,s,r,a,l){for(var u,h,p,d=t.length-1,_=-~((d-l)/2);p=t.pop();)u=r[p.i],h=a[p.j],n.kids&&_&&Math.abs(p.i-p.j)>=d&&(e.push(i({type:"childList",target:s,addedNodes:[u],removedNodes:[u],nextSibling:u.nextSibling,previousSibling:u.previousSibling})),_--),n.attr&&h.attr&&o(e,u,h.attr,n.afilter),n.charData&&3===u.nodeType&&u.nodeValue!==h.charData&&e.push(i({type:"characterData",target:u,oldValue:h.charData})),n.descendents&&c(u,h)}function c(s,r){for(var p,d,g,f,m,v,b,y=s.childNodes,S=r.kids,T=y.length,A=S?S.length:0,B=0,k=0,x=0;k<T||x<A;)v=y[k],m=S[x],b=m&&m.node,v===b?(n.attr&&m.attr&&o(e,v,m.attr,n.afilter),n.charData&&m.charData!==t&&v.nodeValue!==m.charData&&e.push(i({type:"characterData",target:v,oldValue:m.charData})),d&&a(d,s,y,S,B),n.descendents&&(v.childNodes.length||m.kids&&m.kids.length)&&c(v,m),k++,x++):(l=!0,p||(p={},d=[]),v&&(p[g=h(v)]||(p[g]=!0,(f=u(S,v,x))===-1?n.kids&&(e.push(i({type:"childList",target:s,addedNodes:[v],nextSibling:v.nextSibling,previousSibling:v.previousSibling})),B++):d.push({i:k,j:f})),k++),b&&b!==y[k]&&(p[g=h(b)]||(p[g]=!0,(f=_(y,b,k))===-1?n.kids&&(e.push(i({type:"childList",target:r.node,removedNodes:[b],nextSibling:S[x+1],previousSibling:S[x-1]})),B--):d.push({i:f,j:x})),x++));d&&a(d,s,y,S,B)}var l;return c(s,r),l}function l(t,e){var s=!0;return function i(t){var r={node:t};return!e.charData||3!==t.nodeType&&8!==t.nodeType?(e.attr&&s&&1===t.nodeType&&(r.attr=d(t.attributes,function(s,i){return e.afilter&&!e.afilter[i.name]||(s[i.name]=v(t,i)),s},{})),s&&(e.kids||e.charData||e.attr&&e.descendents)&&(r.kids=p(t.childNodes,i)),s=e.descendents):r.charData=t.nodeValue,r}(t)}function u(t,e,s){return _(t,e,s,f("node"))}function h(t){try{return t.id||(t[y]=t[y]||b++)}catch(e){try{return t.nodeValue}catch(s){return b++}}}function p(t,e){for(var s=[],i=0;i<t.length;i++)s[i]=e(t[i],i,t);return s}function d(t,e,s){for(var i=0;i<t.length;i++)s=e(s,t[i],i,t);return s}function _(t,e,s,i){for(;s<t.length;s++)if((i?t[s][i]:t[s])===e)return s;return-1}function g(e,s){return e[s]!==t}function f(t){return t}e._period=30,e.prototype={observe:function(t,e){for(var i={attr:!!(e.attributes||e.attributeFilter||e.attributeOldValue),kids:!!e.childList,descendents:!!e.subtree,charData:!(!e.characterData&&!e.characterDataOldValue)},n=this._watched,a=0;a<n.length;a++)n[a].tar===t&&n.splice(a,1);e.attributeFilter&&(i.afilter=d(e.attributeFilter,function(t,e){return t[e]=!0,t},{})),n.push({tar:t,fn:r(t,i)}),this._timeout||s(this)},takeRecords:function(){for(var t=[],e=this._watched,s=0;s<e.length;s++)e[s].fn(t);return t},disconnect:function(){this._watched=[],clearTimeout(this._timeout),this._timeout=null}};var m=document.createElement("i");m.style.top=0,m="null"!=m.attributes.style.value;var v=m?n:a,b=1,y="mo_id";return e}(void 0)),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),s=this,i=function(){},r=function(){return s.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r}),C.prototype.init=function(t){var e=this;this.initPara(t),this.enable_visualize!==!1&&(window.self!==window.top&&o()?(this.is_editor=!0,this.SensorsABTest.link.mask_instance&&this.SensorsABTest.link.mask_instance.remove(),document.getElementById("sa-abtesting-vabtest-script")||k(this.vabtest_url,{id:"sa-abtesting-vabtest-script",success:function(){setTimeout(function(){e.SensorsABTest.sd.use("VABTest",{SensorsABTest:e.SensorsABTest})},0)}})):(this.start_time=(new Date).getTime(),this.use_mask&&this.initMask(),this.addSinglePageListener()))},C.prototype.initPara=function(t){if(U.isFunction(t))try{t=t()}catch(e){return this.SensorsABTest.log("ABTesting SDK  !"),void(this.para=!1)}if(!U.isObject(t))return void(this.para=!1);Object.prototype.hasOwnProperty.call(t,"enable_visualize")&&U.isBoolean(t.enable_visualize)?this.enable_visualize=t.enable_visualize:this.SensorsABTest.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 enable_visualize \u683c\u5f0f\u4e0d\u6b63\u786e\u3002 \u7c7b\u578b\u5e94\u4e3a Boolean"),this.use_mask=U.isBoolean(t.use_mask)?t.use_mask:this.use_mask,this.timeout=U.isNumber(t.timeout)&&t.timeout>=0?t.timeout:this.timeout;var s=U.isString(t.vabtest_url)?t.vabtest_url:"";s&&("https:"===location.protocol?"https:"===s.slice(0,6)?this.vabtest_url=s:this.SensorsABTest.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u534f\u8bae\u5934\u5e94\u8bbe\u7f6e\u4e3a https"):"http:"===s.slice(0,5)||"https:"===s.slice(0,6)?this.vabtest_url=s:this.SensorsABTest.log("ABTesting SDK \u521d\u59cb\u5316\u53c2\u6570 vabtest_url \u5e94\u8bbe\u7f6e\u4e3a\u6709\u6548 URL"))},C.prototype.resolve=function(){var t=this.SensorsABTest.results;if(this.enable_visualize!==!1&&this.is_editor!==!0&&this.isFirst!==!1){if((new Date).getTime()-this.start_time>this.timeout)return this.SensorsABTest.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),!1;var e=this;this.isFirst=!1;var s=!1;U.each(t,function(t){if(!U.isObject(t)||"VISUAL"!==t.experiment_type)return!1;if(s)return!1;var i=t.experiment_value;if(!U.isArray(i))try{i=JSON.parse(t.experiment_value),t.experiment_value=i}catch(r){return!1}e.isTriggerVisualExp(t)&&(s=!0,e.renderGlobalElement(t),e.prepareResource(t,e.render.bind(e)),e.visualExp=t,e.SensorsABTest.trackOutTestTrigger("VISUAL"))}),!s&&this.use_mask&&this.destroyMask()}},C.prototype.initMask=function(){this.mask_instance=new U.Mask("vabtest_"+this.SensorsABTest.sd.para.sdk_id),this.mask_instance.show(this.timeout)},C.prototype.destroyMask=function(){this.mask_instance&&this.mask_instance.remove()},C.prototype.prepareResource=function(t,e){var s=this,i=t.experiment_value;U.isArray(i)&&(U.each(i,function(i){function r(i,r){function n(){var r=s.imgLoadingList.indexOf(i);s.loadedImages.push(i),r>-1&&s.imgLoadingList.splice(r,1),0===s.imgLoadingList.length&&e(t)}if(s.imgLoadingList.push(i),s.loadedImages.indexOf(i)>-1){var a=s.imgLoadingList.indexOf(i);return a>-1&&s.imgLoadingList.splice(a,1),void(0===s.imgLoadingList.length&&e(t))}var o=document.createElement("img");o.width=1,o.height=1,o.onload=n,o.onerror=n,o.onabort=n,o[r]=i}var n=i.tagName,a=i.props;"img"===n&&a&&a.attributes&&(U.isString(a.attributes.srcset)?r(a.attributes.srcset,"srcset"):U.isString(a.attributes.src)&&r(a.attributes.src,"src"))}),0===this.imgLoadingList.length&&e(t))},C.prototype.render=function(t){this.removeDomChangeListener();var e=this,s=function(){if(e.isDomReady=!0,e.use_mask&&e.mask_instance&&e.mask_instance.is_timeout===!0)return void e.SensorsABTest.log("\u6e32\u67d3\u5b9e\u9a8c\u7ed3\u679c\u8d85\u65f6\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01");e.isTrigger||(e.SensorsABTest.triggerHandle(t),e.isTrigger=!0),U.isArray(e.originData)&&(U.each(e.originData,function(t){E(t)}),e.originData=[]),U.each(e.dynamicAddedElements,function(t){c(t)}),e.dynamicAddedElements=[];var s=t.experiment_value;U.isArray(s)&&U.each(s,function(t){var s=t.selector,i=t.type;if("innerHtml"===t.type){var r=N(t,!0,e.domEditor);r.addedEleSelector&&e.dynamicAddedElements.push(r.addedEleSele)}if("img"===i||"link"===i||"text"===i||"innerHtml"===i){var n=U.getDomBySelector(s);if(n)try{var a=D(n,[]),o=a.eleInfo,c=S(n,t,o);c&&e.originData.push(a)}catch(l){U.logger.log("render vabtest error")}}}),e.use_mask&&e.destroyMask(),e.addDomChangeListener()};this.isDomReady?s():U.bindReady(s)},C.prototype.restoreElements=function(){U.each(this.originData,function(t){E(t)}),U.each(this.dynamicAddedElements,function(t){c(t)}),this.dynamicAddedElements=[],this.visualExp=null,this.isFirst=!0,this.start_time=(new Date).getTime(),this.originData=[],this.isTrigger=!1,O({attr_key:"sensors_ab_style_id"}),O({attr_key:"sensors_ab_script_id"})},C.prototype.addDomChangeListener=function(){var t=this;U.bindReady(function(){t.isDomReady=!0,t.domChangeObserver=x(t.observerCallback.bind(t))})},C.prototype.removeDomChangeListener=function(){w(this.domChangeObserver),this.domChangeObserver=null},C.prototype.addSinglePageListener=function(){var t=this;this.SensorsABTest.sd.ee.spa.on("switch",function(e){return e!==location.href&&(t.mask_instance&&t.destroyMask(),t.start_time=(new Date).getTime(),t.use_mask&&t.initMask(),t.restoreElements(),void t.resolve())})},C.prototype.observerCallback=function(){this.visualExp&&this.prepareResource(this.visualExp,this.render.bind(this))},C.prototype.stopTrigger=function(){this.isFirst=!1,this.SensorsABTest.log("\u8bf7\u6c42\u5b9e\u9a8c\u7ed3\u679c\u5931\u8d25\uff0cA/B \u53ef\u89c6\u5316\u5b9e\u9a8c\u5931\u8d25\uff01"),this.use_mask&&this.destroyMask()},C.prototype.isTriggerVisualExp=function(t){return U.isString(t.control_link)&&U.isString(t.link_match_type)?!!U.checkUrlIsMatch(t.control_link,t.link_match_type)||(this.SensorsABTest.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u5339\u914d\u5931\u8d25",t.abtest_experiment_id),!1):(this.SensorsABTest.log("\u53ef\u89c6\u5316\u8bd5\u9a8c\u6570\u636e\u5f02\u5e38",t.abtest_experiment_id),!1)},C.prototype.renderGlobalElement=function(t){var e=t.experiment_value;U.isArray(e)&&U.each(e,function(t){var e=t.type;switch(e){case"globalScript":U.bindReady(function(){var e={attr_value:t.id,text:t.props.text,attr_key:"sensors_ab_script_id"};B(e)});break;case"globalStyle":var s={attr_value:t.id,text:t.props.text,attr_key:"sensors_ab_style_id"};A(s)}})},R.prototype.asyncFetchABTest=function(){U.error("asyncFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},R.prototype.fastFetchABTest=function(){U.error("fastFetchABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},R.prototype.fetchCacheABTest=function(){U.error("fetchCacheABTest\u8c03\u7528\u5931\u8d25,A/B Testing\u672a\u521d\u59cb\u5316")},R.prototype.setCustomProperties=function(t){U.isObject(t)&&!U.isEmptyObject(t)&&(this.abtestingPara.custom_properties=t,this.fetchData&&this.fetchData.fetchNow&&this.fetchData.fetchNow())},R.prototype.searchLocalExp=function(t){return this.codeExpData[t]?this.codeExpData[t]:null},R.prototype.getExpResult=function(t,e){var s=t.default_value,i=e?e:this.searchLocalExp(t.param_name);return U.isObject(i)?U.isObject(i.js_config)&&(i.js_config.type===t.value_type?(s=i.js_config.value,this.triggerHandle(i,t)):this.log("\u8bd5\u9a8c\u7ed3\u679c\u7c7b\u578b\u4e0e\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e0d\u4e00\u81f4\uff0cparam_name\uff1a"+t.param_name+"\uff0c\u5f53\u524d\u8fd4\u56de\u7c7b\u578b\u4e3a\uff1a"+i.js_config.type+"\uff0c\u4ee3\u7801\u671f\u671b\u7c7b\u578b\u4e3a\uff1a"+t.value_type)):this.log("localdata\u672a\u67e5\u8be2\u5230\u8bd5\u9a8c\u6570\u636e\uff0c\u8bd5\u9a8c\u53c2\u6570\u540d\u79f0\uff1a"+t.param_name),this.trackOutTestTrigger("CODE",t),s},R.prototype.resolveVariables=function(){this.codeExpData={};var t=this,e=this.results;U.each(e,function(e){U.isObject(e)&&e.variables&&U.isArray(e.variables)&&U.each(e.variables,function(s){U.isObject(s)&&!t.codeExpData[s.name]&&(t.codeExpData[s.name]=U.extend({},e),t.codeExpData[s.name].js_config=t.getRelativeValue(s.value,s.type))})})},R.prototype.getRelativeValue=function(t,e){var s=this,i={},r={INTEGER:function(t){var e=parseFloat(t);isNaN(e)?s.log("\u539f\u59cb\u6570\u636e INTEGER \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t):(i.value=e,i.type="Number")},STRING:function(t){U.isString(t)?(i.value=t,i.type="String"):s.log("\u539f\u59cb\u6570\u636e STRING \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},JSON:function(t){var e=JSON.parse(t);U.isObject(e)?(i.value=e,i.type="Object"):s.log("\u539f\u59cb\u6570\u636e JSON \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)},BOOLEAN:function(t){"true"===t?(i.value=!0,i.type="Boolean"):"false"===t?(i.value=!1,i.type="Boolean"):s.log("\u539f\u59cb\u6570\u636e BOOLEAN \u7c7b\u578b\u89e3\u6790\u5f02\u5e38",t)}};try{r[e]?r[e](t):s.log("\u8bd5\u9a8c\u6570\u636e\u7c7b\u578b\u89e3\u6790\u5931\u8d25",e,t)}catch(n){s.log(n,t,e)}return i},R.prototype.dealResponseData=function(t,e){U.isObject(t)?"SUCCESS"===t.status?U.isArray(t.results)&&(this.fetchData.updateExpsCache(t),this.updateLocalData(e)):"FAILED"===t.status&&this.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+t.error_type+",error\uff1a"+t.error):this.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",t)},R.prototype.dealCodeExpResponseData=function(t,e){U.isObject(t)?"SUCCESS"===t.status?U.isArray(t.results)&&(this.fetchData.updateExpsCache(t),this.updateCodeExpLocalData(e)):"FAILED"===t.status&&this.log("\u83b7\u53d6\u8bd5\u9a8c\u5931\u8d25\uff1aerror_type\uff1a"+t.error_type+",error\uff1a"+t.error):this.log("\u8bd5\u9a8c\u6570\u636e\u89e3\u6790\u5931\u8d25\uff0cresponse \uff1a",t)},R.prototype.updateCodeExpLocalData=function(t){this.analyzeCodeExpData(),this.updateStorage(t),this.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},R.prototype.analyzeCodeExpData=function(){var t=this.results;return U.isArray(t)?(this.resolveVariables(),void this.registerProperty()):(this.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",t),!1)},R.prototype.updateLocalData=function(t){this.analyzeData(),this.updateStorage(t),this.log("\u66f4\u65b0\u8bd5\u9a8c\u6570\u636e\u6210\u529f")},R.prototype.updateStorage=function(t){var e=(new Date).getTime(),s={results:this.results,updateTime:e,triggerList:this.triggerList,distinct_id:t||this.sd.store.getDistinctId(),outTriggerList:this.outTriggerList,out_list:this.out_list,track_config:this.track_config},i=this.state.storage.name,r=this.para.encrypt_cookie;U.setStorageData(s,i,r),this.updateTime=e},R.prototype.analyzeData=function(){var t=this.results;return U.isArray(t)?(this.link.resolve(),this.vabtest.resolve(),this.resolveVariables(),void this.registerProperty()):(this.log("\u89e3\u6790——\u6570\u636e\u683c\u5f0f\u9519\u8bef",t),!1)},R.prototype.trackOutTestTrigger=function(t,e){var s=this.out_list,i=this,r=!1,n={};if(U.isArray(s)&&s.length>0&&(U.each(s,function(s){U.isObject(s)&&!r&&("CODE"===t?U.isObject(s)&&s.variables&&U.isArray(s.variables)&&U.each(s.variables,function(t){var a=i.getRelativeValue(t.value,t.type);!r&&a&&U.isObject(t)&&e.param_name===t.name&&a.type===e.value_type&&(r=!0,n=s)}):"LINK"===t?U.isString(s.control_link)&&U.isString(s.link_match_type)&&("REGEXP"===s.link_match_type?U.checkUrlIsRegexp(s.control_link,s.regexp_flags)&&(r=!0,n=s):U.checkUrlIsMatch(s.control_link,s.link_match_type)&&(r=!0,n=s)):"VISUAL"===t&&U.isString(s.control_link)&&U.isString(s.link_match_type)&&U.checkUrlIsMatch(s.control_link,s.link_match_type)&&(r=!0,n=s))}),r)){var a=i.sd.store.getDistinctId();n.subject_id&&n.subject_name&&(a=n.subject_name+n.subject_id),i.sendTriggerEvent("outTriggerList",a,n,{})}},R.prototype.registerProperty=function(){var t=this.track_config.property_set_switch;if(t){var e=this.sd.store.getUnionId(),s=["USER"+(e.login_id||e.anonymous_id),"DEVICE"+e.anonymous_id],i=this.sd.bridge.is_verify_success?this.getLatestSubject():[],r=[],n=[];U.each(this.triggerList,function(t,e){s.indexOf(e)<0&&i.indexOf(e)<0||U.isArray(t)&&U.each(t,function(t){t.result_id&&r.push(t.result_id)})}),U.isArray(this.results)&&U.each(this.results,function(t){t.abtest_experiment_result_id&&n.push(t.abtest_experiment_result_id)}),r.length>0&&this.sd.registerPage({abtest_result:r}),n.length>0&&this.sd.registerPage({abtest_dispatch_result:n})}else this.sd.clearPageRegister(["abtest_result","abtest_dispatch_result"])},R.prototype.saveLatestSubject=function(t){var e=this.getLatestSubject()||[];e.indexOf(t)<0&&e.push(t);var s=this.state.storage.latest_name,i=this.para.encrypt_cookie;U.setStorageData(e,s,i)},R.prototype.getLatestSubject=function(){var t=this.state.storage.latest_name;return U.getStorageData(t,this.sd)||[]},R.prototype.triggerHandle=function(t,e){var s=this.sd.store.getDistinctId();t.subject_id&&t.subject_name&&(s=t.subject_name+t.subject_id),this.sd.bridge.is_verify_success&&this.saveLatestSubject(s);var i=this.trackTestTrigger(s,t,e);return i},R.prototype.getTriggerProps=function(t,e){var s={},i=U.isObject(e)&&U.isObject(e.properties)?e.properties:{};if("{}"!==JSON.stringify(this.triggerList)){var r="web_abtesting:"+this.lib_version;s.$lib_plugin_version=[r]}this.para.collect_bridge_status&&(s.$sdk_bridge_status=this.bridgeState);var n={$abtest_experiment_id:t.abtest_experiment_id,$abtest_experiment_group_id:t.abtest_experiment_group_id},a=this.track_config.trigger_content_ext;return U.each(a,function(e){void 0!==t[e]&&(s["$"+e]=t[e])}),s=U.extend(n,s,i)},R.prototype.sendTriggerEvent=function(t,e,s,i){var r=this.track_config.trigger_switch,n=!0,a=this[t];a&&U.isObject(a)&&a[e]&&U.each(a[e],function(t){t.experiment_id===s.abtest_experiment_id&&t.group_id===s.abtest_experiment_group_id&&t.result_id===s.abtest_experiment_result_id&&(n=!1)}),this[t][e]=F(a[e],s),this.updateStorage(),this.registerProperty();var o=this.getTriggerProps(s,i);return n&&r&&this.sd.track("$ABTestTrigger",o),n},R.prototype.trackTestTrigger=function(t,e,s){if(e.is_white_list)return!1;var i=this.sendTriggerEvent("triggerList",t,e,s),r=this.getTriggerProps(e,s);return this.sd.track("WebABTestTrigger",r),i},R.prototype.checkSADebug=function(){var t=this,e=U.getQueryParam(location.href,"sensors_abtest_url"),s=U.getQueryParam(location.href,"feature_code"),i=+U.getQueryParam(location.href,"account_id");if(e.length&&s.length&&U.isNumber(i)&&0!==i){var r={distinct_id:this.sd.store.getDistinctId(),feature_code:s,account_id:i};this.sd._.ajax({url:e,type:"POST",data:JSON.stringify(r),credentials:!1,contentType:"application/json",timeout:this.para.timeout_milliseconds,cors:!0,success:function(){},error:function(e){t.log("distinct_id\u53d1\u9001\u5931\u8d25,err:",e)}})}},R.prototype.initMethods=function(t){var e=this,s=["asyncFetchABTest","fastFetchABTest","fetchCacheABTest"];U.each(s,function(s){e[s]=t.methods[s].bind(t)})},I.prototype={timer:null,method:null,context:null,init:function(t,e){this.method=t,this.context=e,this.start(!0)},getServerData:function(t){var e=this;t?this.method.call(this.context,{suc:function(s){t&&("ab_bridge_ok"===e.SensorsABTest.bridgeState&&(s=s.data),U.isObject(s)&&"SUCCESS"===s.status&&U.isArray(s.results)||(e.SensorsABTest.link.stopTrigger(),e.SensorsABTest.vabtest.stopTrigger()))},err:function(){t&&(e.SensorsABTest.link.stopTrigger(),e.SensorsABTest.vabtest.stopTrigger())}}):this.method.call(this.context)},setNextFetch:function(t){var e=this,s=t||this.SensorsABTest.para.update_interval;this.clearFetchTimer(this.timer),this.timer=setTimeout(function(){e.getServerData()},s)},fetchNow:function(){this.clearFetchTimer(this.timer),this.getServerData()},updateExpsCache:function(t){this.SensorsABTest.results=t.results||t.data||[];var e=t.triggerList,s=t.out_list,i=t.outTriggerList;U.isArray(s)&&(this.SensorsABTest.out_list=s),U.isObject(e)&&(this.SensorsABTest.triggerList=t.triggerList),U.isObject(i)&&(this.SensorsABTest.outTriggerList=i),U.isObject(t.track_config)?this.SensorsABTest.track_config=t.track_config:this.SensorsABTest.track_config=this.SensorsABTest.default_track_config},clearExpsCache:function(){this.SensorsABTest.codeExpData={},this.SensorsABTest.results=[],this.SensorsABTest.out_list=[],this.SensorsABTest.track_config=this.SensorsABTest.default_track_config},start:function(t){var e=null,s=(new Date).getTime(),i=U.getStorageData(this.SensorsABTest.state.storage.name,this.SensorsABTest.sd),r=this.SensorsABTest.sd.store.getDistinctId();if(i&&U.isObject(i)&&i.distinct_id===r)if(e=i.updateTime,t&&this.updateExpsCache(i),e&&U.isNumber(e)&&s-e>0&&s-e<this.SensorsABTest.para.update_interval){t&&this.SensorsABTest.analyzeData(),this.SensorsABTest.log("\u6570\u636e\u4e0d\u66f4\u65b0",e,s);var n=s-e,a=this.SensorsABTest.para.update_interval-n;this.setNextFetch(a)}else this.SensorsABTest.log("\u7f13\u5b58\u6570\u636e\u8d85\u65f6",e,s),this.getServerData(t);else e=this.SensorsABTest.updateTime,e&&U.isNumber(e)&&s-e>0&&s-e<this.SensorsABTest.para.update_interval?this.SensorsABTest.log("\u6570\u636e\u4e0d\u66f4\u65b0",e,s):this.getServerData(t)},stop:function(){this.SensorsABTest.log("\u6e05\u7a7a\u62c9\u53d6\u5b9a\u65f6\u5668"),this.clearFetchTimer()},clearFetchTimer:function(){clearTimeout(this.timer),this.timer=null}},H.prototype={init:function(t,e){var s=this;this.SensorsABTest.fetchData.init(t,e),this.SensorsABTest.initMethods(e),U.listenPageState({visible:function(){s.SensorsABTest.log("\u9875\u9762\u663e\u793a"),s.SensorsABTest.fetchData.start()},hidden:function(){s.SensorsABTest.fetchData.stop()}}),this.SensorsABTest.sd.events.on("changeDistinctId",function(){s.SensorsABTest.abtestingPara.custom_properties={},s.SensorsABTest.fetchData.clearExpsCache(),s.SensorsABTest.vabtest.restoreElements(),s.SensorsABTest.updateStorage(),s.SensorsABTest.fetchData.getServerData()}),this.SensorsABTest.sd.events.isReady()}},R.prototype.init=function(t,e){if(this.sd)return this.log("A/B Testing SDK \u91cd\u590d\u521d\u59cb\u5316\uff01\u53ea\u6709\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u6709\u6548\uff01"),!1;if(t.readyState&&t.readyState.state>=3||!t.on)M.call(this,t,e);else{var s=this;t.on("sdkReady",function(){M.call(s,t,e)})}},R.prototype.initTest=function(){this.link.init(this.abtestingPara.multilink),this.vabtest.init(this.abtestingPara.visualize),this.sd.bridge.is_verify_success?this.bridgeStore.init(this.abtestingPara):this.normalStore.init(this.abtestingPara),this.registerProperty()},R.prototype.log=function(){return U.isString(arguments[0])&&(arguments[0]="sensorsabtest————"+arguments[0]),this.sd&&this.sd.log.apply(this,arguments)};var V=new R;return V.__constructor__=R,window.SensorsDataWebJSSDKPlugin&&"[object Object]"==Object.prototype.toString.call(window.SensorsDataWebJSSDKPlugin)?window.SensorsDataWebJSSDKPlugin.SensorsABTest=window.SensorsDataWebJSSDKPlugin.SensorsABTest||V:window.SensorsDataWebJSSDKPlugin={SensorsABTest:V},R});